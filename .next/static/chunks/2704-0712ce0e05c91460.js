"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2704],{7220:(e,t,r)=>{r.d(t,{Hr:()=>f,Ht:()=>g,SQ:()=>d,_2:()=>u,hO:()=>m,lp:()=>p,mB:()=>h,rI:()=>i,ty:()=>c});var a=r(95155);r(12115);var o=r(47971),n=r(5917),s=r(99051),l=r(25016);function i(e){let{...t}=e;return(0,a.jsx)(o.bL,{"data-slot":"dropdown-menu",...t})}function c(e){let{...t}=e;return(0,a.jsx)(o.l9,{"data-slot":"dropdown-menu-trigger",...t})}function d(e){let{className:t,sideOffset:r=4,...n}=e;return(0,a.jsx)(o.ZL,{children:(0,a.jsx)(o.UC,{"data-slot":"dropdown-menu-content",sideOffset:r,className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...n})})}function u(e){let{className:t,inset:r,variant:n="default",...s}=e;return(0,a.jsx)(o.q7,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":n,className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function m(e){let{className:t,children:r,checked:s,...i}=e;return(0,a.jsxs)(o.H_,{"data-slot":"dropdown-menu-checkbox-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),checked:s,...i,children:[(0,a.jsx)("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(o.VF,{children:(0,a.jsx)(n.A,{className:"size-4"})})}),r]})}function f(e){let{...t}=e;return(0,a.jsx)(o.z6,{"data-slot":"dropdown-menu-radio-group",...t})}function g(e){let{className:t,children:r,...n}=e;return(0,a.jsxs)(o.hN,{"data-slot":"dropdown-menu-radio-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[(0,a.jsx)("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(o.VF,{children:(0,a.jsx)(s.A,{className:"size-2 fill-current"})})}),r]})}function p(e){let{className:t,inset:r,...n}=e;return(0,a.jsx)(o.JU,{"data-slot":"dropdown-menu-label","data-inset":r,className:(0,l.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...n})}function h(e){let{className:t,...r}=e;return(0,a.jsx)(o.wv,{"data-slot":"dropdown-menu-separator",className:(0,l.cn)("bg-border -mx-1 my-1 h-px",t),...r})}},31856:(e,t,r)=>{r.d(t,{CG:()=>d,Fm:()=>p,XW:()=>h,cj:()=>c,h:()=>g,qp:()=>x});var a=r(95155),o=r(12115),n=r(89511),s=r(83101),l=r(65229),i=r(25016);let c=n.bL,d=n.l9;n.bm;let u=n.ZL,m=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...o,ref:t})});m.displayName=n.hJ.displayName;let f=(0,s.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),g=o.forwardRef((e,t)=>{let{side:r="right",className:o,children:s,...c}=e;return(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(n.UC,{ref:t,className:(0,i.cn)(f({side:r}),o),...c,children:[s,(0,a.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});g.displayName=n.UC.displayName;let p=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...r})};p.displayName="SheetHeader";let h=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};h.displayName="SheetFooter";let x=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold text-foreground",r),...o})});x.displayName=n.hE.displayName,o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...o})}).displayName=n.VY.displayName},68209:(e,t,r)=>{r.d(t,{N4:()=>c,Xb:()=>i,co:()=>d,y1:()=>m});let a="https://api.gajkesaristeels.in",o="".concat(a,"/user/token"),n="".concat(a,"/user/logout"),s="".concat(a,"/user/manage/get"),l="".concat(a,"/user/manage/current-user"),i=e=>e?e.trim().replace(/\s+/g," ").toUpperCase():null,c=e=>{let t=i(e);return"MANAGER"===t||"ROLE MANAGER"===t||"ROLE_MANAGER"===t||"OFFICE MANAGER"===t||"OFFICE_MANAGER"===t||"ROLE OFFICE MANAGER"===t||"ROLE_OFFICE MANAGER"===t||"ROLE_OFFICE_MANAGER"===t},d=(e,t)=>{var r;return!!c(e)||(null!=(r=null==t?void 0:t.authorities)?r:[]).some(e=>c(e.authority))},u={getToken:()=>localStorage.getItem("authToken"),setToken:e=>{{localStorage.setItem("authToken",e);let t="localhost"===window.location.hostname?"authToken=".concat(e,"; path=/; max-age=86400; samesite=strict"):"authToken=".concat(e,"; path=/; max-age=86400; secure; samesite=strict");document.cookie=t}},removeToken:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("currentUser"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getAuthHeader:()=>{let e=u.getToken();return e?"Bearer ".concat(e):null},setUserRole:e=>{localStorage.setItem("userRole",e.roles),localStorage.setItem("userData",JSON.stringify(e))},getUserRole:()=>localStorage.getItem("userRole"),getUserData:()=>{{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}},setCurrentUser:e=>{localStorage.setItem("currentUser",JSON.stringify(e))},getCurrentUser:()=>{{let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}}},m={login:async e=>{try{let t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Login failed: ".concat(t.status," ").concat(e))}let r=await t.text(),{role:a,token:n}=(e=>{let t=e.trim();if(!t)throw Error("Empty response received from login endpoint");try{let e=JSON.parse(t);if("string"==typeof e.token){var r;return{token:e.token.trim(),role:null!=(r=e.role)?r:"USER"}}}catch(e){}let a=t.split(/\s+/);if(a.length<2)throw Error('Unexpected login response: "'.concat(t,'"'));let o=a[0],n=a[a.length-1];if("bearer"===n.toLowerCase()&&a.length>=3&&(n=a[a.length-1]),!(n=n.replace(/^"(.*)"$/,"$1")).includes("."))throw Error('Parsed token looks invalid: "'.concat(n,'"'));return{token:n,role:o||"USER"}})(r);u.setToken(n);try{console.log("Fetching role for username:",e.username),console.log("Raw token response:",r),console.log("Token being used:",n);let t=await fetch("".concat(s,"?username=").concat(e.username),{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();u.setUserRole(e),console.log("User role data stored:",e)}else{console.warn("Failed to fetch user role data:",t.status,t.statusText);let e=await t.text();console.warn("Error response:",e)}}catch(e){console.warn("Error fetching user role data:",e)}try{let e=await fetch(l,{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();u.setCurrentUser(t),console.log("Current user data stored:",t)}else console.warn("Failed to fetch current user data:",e.status)}catch(e){console.warn("Error fetching current user data:",e)}return{token:n,role:a||"USER"}}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{let e=u.getToken();if(!e)return void u.removeToken();let t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});u.removeToken(),t.ok||console.warn("Logout request failed, but token was cleared locally")}catch(e){console.error("Logout error:",e),u.removeToken()}},isAuthenticated:()=>!!u.getToken(),getStoredToken:()=>u.getToken(),getUserRole:()=>u.getUserRole(),getUserData:()=>u.getUserData(),getCurrentUser:()=>u.getCurrentUser()}},82466:(e,t,r)=>{r.d(t,{A:()=>c,AuthProvider:()=>i});var a=r(95155),o=r(12115),n=r(68209),s=r(20063);let l=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)(null),[u,m]=(0,o.useState)(!0),[f,g]=(0,o.useState)(null),[p,h]=(0,o.useState)(null),[x,v]=(0,o.useState)(null),y=(0,o.useRef)(null),w=(0,s.useRouter)(),b=e=>{if(!e)return null;let t=e.split(".");if(t.length<2)return null;try{let e=t[1].replace(/-/g,"+").replace(/_/g,"/");if("function"!=typeof atob)return null;let r=atob(e),a=JSON.parse(r);if("number"==typeof a.exp)return a.exp;return null}catch(e){return null}};(0,o.useEffect)(()=>{let e=n.y1.getStoredToken(),t=n.y1.getUserRole(),r=n.y1.getUserData(),a=n.y1.getCurrentUser();if(e){let o=b(e),s=Math.floor(Date.now()/1e3);o&&o<=s?n.y1.logout().finally(()=>{d(null),i(!1),g(null),h(null),v(null),w.replace("/login")}):(d(e),i(!0),g(t),h(r),v(a))}m(!1)},[]);let k=async(e,t)=>{m(!0);try{let r=await n.y1.login({username:e,password:t});d(r.token),i(!0);let a=n.y1.getUserRole(),o=n.y1.getUserData(),s=n.y1.getCurrentUser();g(a),h(o),v(s)}catch(e){throw e}finally{m(!1)}},N=async()=>{try{await n.y1.logout(),d(null),i(!1),g(null),h(null),v(null),sessionStorage.removeItem("pricingModalDismissed"),w.replace("/login")}catch(e){throw d(null),i(!1),g(null),h(null),sessionStorage.removeItem("pricingModalDismissed"),e}};return(0,o.useEffect)(()=>{if(y.current&&(clearTimeout(y.current),y.current=null),!c)return;let e=b(c);if(!e)return;let t=1e3*e-Date.now();return t<=0?void N():(y.current=setTimeout(()=>{N()},t),()=>{y.current&&(clearTimeout(y.current),y.current=null)})},[c]),(0,a.jsx)(l.Provider,{value:{isAuthenticated:r,token:c,login:k,logout:N,isLoading:u,userRole:f,userData:p,currentUser:x},children:t})}function c(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);