(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9888],{31856:(e,s,t)=>{"use strict";t.d(s,{CG:()=>c,Fm:()=>p,XW:()=>g,cj:()=>d,h:()=>u,qp:()=>j});var a=t(95155),l=t(12115),i=t(89511),n=t(83101),r=t(65229),o=t(25016);let d=i.bL,c=i.l9;i.bm;let m=i.ZL,h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.hJ,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});h.displayName=i.hJ.displayName;let x=(0,n.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),u=l.forwardRef((e,s)=>{let{side:t="right",className:l,children:n,...d}=e;return(0,a.jsxs)(m,{children:[(0,a.jsx)(h,{}),(0,a.jsxs)(i.UC,{ref:s,className:(0,o.cn)(x({side:t}),l),...d,children:[n,(0,a.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(r.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=i.UC.displayName;let p=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};p.displayName="SheetHeader";let g=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};g.displayName="SheetFooter";let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.hE,{ref:s,className:(0,o.cn)("text-lg font-semibold text-foreground",t),...l})});j.displayName=i.hE.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.VY,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",t),...l})}).displayName=i.VY.displayName},58976:(e,s,t)=>{Promise.resolve().then(t.bind(t,88616))},88616:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>G});var a=t(95155),l=t(12115),i=t(71163),n=t(20063),r=t(56069),o=t(37621),d=t(1733),c=t(61927),m=t.n(c),h=t(63270),x=t.n(h),u=t(97003),p=t(67812),g=t(33789),j=t(90235),f=t(47507),y=t(98432),N=t(60028),v=t(54679),w=t(97450),b=t(90923),D=t(83209),C=t(7220),k=t(31856),S=t(26983),A=t(42348),I=t(42529),T=t(52056),P=t(46826),M=t(66955),E=t(16485),F=t(37772),O=t(71871),J=t(71360),B=t(20508),L=t(30814),z=t(90368),$=t(27937);let G=()=>{let[e,s]=(0,l.useState)([]),[t,c]=(0,l.useState)([]),[h,G]=(0,l.useState)({id:0,taskTitle:"",taskDesciption:"",dueDate:"",assignedToId:0,assignedToName:"",assignedById:86,status:"Assigned",priority:"low",category:"Complaint",storeId:0,storeName:"",storeCity:"",taskType:"complaint",imageCount:0}),R=(0,n.useRouter)(),q="complaints.filters.v1",[U,V]=(0,l.useState)(!1),[W,_]=(0,l.useState)("general"),[H,X]=(0,l.useState)(!1),[Y,Z]=(0,l.useState)(!1),[Q,K]=(0,l.useState)(!1),[ee,es]=(0,l.useState)(!1),[et,ea]=(0,l.useState)(!1),[el,ei]=(0,l.useState)(!1),[en,er]=(0,l.useState)(0),[eo,ed]=(0,l.useState)(10),[ec,em]=(0,l.useState)(0),[eh,ex]=(0,l.useState)(0),[eu,ep]=(0,l.useState)({employee:"",priority:"",status:"",search:"",startDate:(0,i.GP)(new Date,"yyyy-MM-dd"),endDate:(0,i.GP)(new Date,"yyyy-MM-dd")}),[eg,ej]=(0,l.useState)(!0),[ef,ey]=(0,l.useState)([]),[eN,ev]=(0,l.useState)([]),[ew,eb]=(0,l.useState)([]),[eD,eC]=(0,l.useState)(null),[ek,eS]=(0,l.useState)(null),[eA,eI]=(0,l.useState)(!1),[eT,eP]=(0,l.useState)(null),[eM,eE]=(0,l.useState)(!1),[eF,eO]=(0,l.useState)(""),[eJ,eB]=(0,l.useState)(null),[eL,ez]=(0,l.useState)(!1),[e$,eG]=(0,l.useState)([]),[eR,eq]=(0,l.useState)(0),[eU,eV]=(0,l.useState)(!1),[eW,e_]=(0,l.useState)(!1),[eH,eX]=(0,l.useState)(!1),[eY,eZ]=(0,l.useState)(null),[eQ,eK]=(0,l.useState)(!1),[e0,e2]=(0,l.useState)([]),[e1,e4]=(0,l.useState)([]),[e6,e8]=(0,l.useState)([]),[e5,e3]=(0,l.useState)([]),[e7,e9]=(0,l.useState)([]),{token:se,userRole:ss,userData:st,currentUser:sa}=(0,r.A)();(0,l.useEffect)(()=>{(()=>{var e;eK(!!("MANAGER"===ss||(null==sa||null==(e=sa.authorities)?void 0:e.some(e=>"ROLE_MANAGER"===e.authority))))})()},[ss,sa]),(0,l.useEffect)(()=>{let e=async()=>{if(eQ&&(null==st?void 0:st.employeeId))try{console.log("Loading team data for manager with employeeId:",st.employeeId);let e=await o.n.getTeamByEmployee(st.employeeId);if(e&&e.length>0){let s=e[0],t=s.id;eZ(t),console.log("Team ID loaded:",t);let a=s.fieldOfficers.map(e=>e.id);console.log("Team member IDs:",a);let l=ef.filter(e=>a.includes(e.id));e2(l),console.log("Team members loaded:",l.length)}else console.warn("No team data found for manager"),eC("No team data found for this manager")}catch(e){console.error("Failed to load team data:",e),eC("Failed to load team data")}};eQ&&(null==st?void 0:st.employeeId)&&ef.length>0&&e()},[eQ,null==st?void 0:st.employeeId,ef]),(0,l.useEffect)(()=>{if(eD){let e=setTimeout(()=>{eC(null)},2e4);return()=>clearTimeout(e)}},[eD]);let sl=e=>{if(!e)return"";let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(s,"-").concat(t,"-").concat(a)},si=(e,s)=>{ep({...eu,[e]:s})},sn=(0,l.useCallback)(async()=>{if(se){if(eQ&&!eY)return void console.log("⏳ Manager detected but no teamId yet - waiting for team data");console.log("Fetching tasks with:",{userRole:ss,userData:st,isManager:eQ,teamId:eY,token:se?"present":"missing"}),ej(!0);try{let e;if(eQ&&eY)e="https://api.gajkesaristeels.in/task/getByTeam?id=".concat(eY),console.log("Using MANAGER API:",e,"Team ID:",eY);else{let s=(0,i.GP)(new Date(eu.startDate),"yyyy-MM-dd"),t=(0,i.GP)(new Date(eu.endDate),"yyyy-MM-dd");e="https://api.gajkesaristeels.in/task/getByDate?start=".concat(s,"&end=").concat(t),console.log("Using ADMIN API:",e,"User Role:",ss)}let t=await fetch(e,{headers:{Authorization:"Bearer ".concat(se)}});if(!t.ok){let e=await t.text();throw console.error("API Error:",t.status,e),Error("API request failed: ".concat(t.status," ").concat(e))}let a=await t.json();console.log("API Response:",a);let l=(Array.isArray(a)?a:[]).filter(e=>"complaint"===e.taskType||"requirement"===e.taskType).map(e=>({id:Number(e.id)||0,taskTitle:String(e.taskTitle||""),taskDesciption:String(e.taskDesciption||""),dueDate:String(e.dueDate||""),assignedToId:Number(e.assignedToId)||0,assignedToName:String(e.assignedToName||"Unknown"),assignedById:Number(e.assignedById)||0,status:String(e.status||""),priority:String(e.priority||""),category:String(e.category||""),storeId:Number(e.storeId)||0,storeName:String(e.storeName||""),storeCity:String(e.storeCity||""),taskType:String(e.taskType||""),imageCount:Number(e.imageCount)||0})).sort((e,s)=>new Date(s.dueDate).getTime()-new Date(e.dueDate).getTime()),n=en*eo,r=n+eo,o=l.slice(n,r);s(o),em(Math.ceil(l.length/eo)),ex(l.length),ej(!1)}catch(e){console.error("Error fetching tasks:",e),ej(!1)}}},[eu,se,ss,st,eQ,eY,en,eo]),sr=(0,l.useCallback)(async()=>{if(se)try{let e=await fetch("https://api.gajkesaristeels.in/employee/getAll",{headers:{Authorization:"Bearer ".concat(se)}}),s=await e.json(),t=m()(s,e=>"".concat(e.firstName," ").concat(e.lastName));ey(t)}catch(e){console.error("Error fetching employees:",e)}},[se]),so=(0,l.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"storeName",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"asc";if(se&&e){eX(!0);try{let n="https://api.gajkesaristeels.in/store/getStoreNamesByEmployee?employeeId=".concat(e,"&searchTerm=").concat(s,"&page=").concat(t,"&size=").concat(a,"&sortBy=").concat(l,"&sortOrder=").concat(i),r=await fetch(n,{headers:{Authorization:"Bearer ".concat(se)}}),o=await r.json();eb(o.content||[])}catch(e){console.error("Error fetching stores:",e)}finally{eX(!1)}}},[se]);(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(q);if(e){let s=JSON.parse(e);(null==s?void 0:s.filters)&&ep(e=>({...e,...s.filters})),"number"==typeof(null==s?void 0:s.currentPage)&&er(s.currentPage),"number"==typeof(null==s?void 0:s.pageSize)&&ed(s.pageSize)}}catch(e){}V(!0)},[]),(0,l.useEffect)(()=>{if(U)try{sessionStorage.setItem(q,JSON.stringify({filters:eu,currentPage:en,pageSize:eo}))}catch(e){}},[eu,en,eo,U]),(0,l.useEffect)(()=>{U&&sn()},[sn,eY,U]),(0,l.useEffect)(()=>{er(0)},[eu]),(0,l.useEffect)(()=>{sr()},[sr]);let sd=eQ&&e0.length>0?e0:ef;(0,l.useEffect)(()=>{if(e.length>0){let s=x()(e.map(e=>({id:e.assignedToId,name:e.assignedToName})),"id");ev(m()(s,"name"))}},[e]),(0,l.useEffect)(()=>{sc()},[e,eu]),(0,l.useEffect)(()=>{e3((eQ&&e0.length>0?e0:ef).map(e=>({value:e.id.toString(),label:"".concat(e.firstName," ").concat(e.lastName)})).sort((e,s)=>e.label.localeCompare(s.label)))},[ef,e0,eQ]),(0,l.useEffect)(()=>{e9(ew.map(e=>({value:e.id.toString(),label:e.storeName})).sort((e,s)=>e.label.localeCompare(s.label)))},[ew]);let sc=()=>{let s=eu.search.toLowerCase();c(e.filter(e=>{var t,a,l,i;return("complaint"===e.taskType||"requirement"===e.taskType)&&(((null==(t=e.taskTitle)?void 0:t.toLowerCase())||"").includes(s)||((null==(a=e.taskDesciption)?void 0:a.toLowerCase())||"").includes(s)||((null==(l=e.storeName)?void 0:l.toLowerCase())||"").includes(s)||((null==(i=e.assignedToName)?void 0:i.toLowerCase())||"").includes(s))&&(""===eu.employee||"all"===eu.employee||e.assignedToId===parseInt(eu.employee))&&(""===eu.priority||"all"===eu.priority||e.priority===eu.priority)&&(""===eu.status||"all"===eu.status?"Complete"!==e.status:e.status===eu.status)&&(!!eQ||(""===eu.startDate||new Date(e.dueDate)>=new Date(eu.startDate))&&(""===eu.endDate||new Date(e.dueDate)<=new Date(eu.endDate)))}))},sm=async()=>{if(se)try{var e,t,a;let l={...h,taskDesciption:h.taskDesciption,taskType:"complaint"},i=await fetch("https://api.gajkesaristeels.in/task/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(se)},body:JSON.stringify(l)}),n=await i.json(),r={...h,id:n.id,assignedToName:(null==(e=sd.find(e=>e.id===h.assignedToId))?void 0:e.firstName)+" "+(null==(t=sd.find(e=>e.id===h.assignedToId))?void 0:t.lastName)||"Unknown",storeName:(null==(a=ew.find(e=>e.id===h.storeId))?void 0:a.storeName)||""};s(e=>[r,...e]),X(!1),sg()}catch(e){console.error("Error creating task:",e)}},sh=()=>{eE(!1),eB(null),eO(""),eP(null)},sx=async()=>{if(se&&null!==eJ){if(eT&&eF===eT.status)return void sh();try{(await fetch("https://api.gajkesaristeels.in/task/updateTask?taskId=".concat(eJ),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(se)},body:JSON.stringify({status:eF})})).ok?(s(e=>e.map(e=>e.id===eJ?{...e,status:eF}:e)),sh()):console.error("Failed to update task status")}catch(e){console.error("Error updating task status:",e)}}},su=async e=>{if(se)try{await fetch("https://api.gajkesaristeels.in/task/deleteById?taskId=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(se)}}),sn()}catch(e){console.error("Error deleting task:",e)}},sp=(e,s)=>{ep(t=>({...t,[e]:s})),sc()},sg=()=>{G({id:0,taskTitle:"",taskDesciption:"",dueDate:"",assignedToId:0,assignedToName:"",assignedById:86,status:"Assigned",priority:"low",category:"Complaint",storeId:0,storeName:"",storeCity:"",taskType:"complaint",imageCount:0}),e4([]),e8([]),eb([]),_("general")},sj=e=>{switch(e.toLowerCase()){case"assigned":return{icon:(0,a.jsx)(S.A,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-800"};case"work in progress":return{icon:(0,a.jsx)(A.A,{className:"w-4 h-4 animate-spin"}),color:"bg-blue-100 text-blue-800"};case"complete":return{icon:(0,a.jsx)(I.A,{className:"w-4 h-4"}),color:"bg-green-100 text-green-800"};default:return{icon:(0,a.jsx)(T.A,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-800"}}};return(0,a.jsxs)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[(0,a.jsxs)("div",{className:"flex-grow lg:flex-grow-0 lg:w-64 flex items-center gap-2",children:[(0,a.jsx)(g.p,{placeholder:"Search complaints",value:eu.search,onChange:e=>sp("search",e.target.value),className:"w-full"}),(0,a.jsxs)(u.$,{onClick:()=>X(!0),children:[(0,a.jsx)(P.A,{className:"w-4 h-4 mr-2"})," New"]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsxs)(u.$,{variant:"outline",size:"sm",className:"lg:hidden",onClick:()=>eI(!0),children:[(0,a.jsx)(M.A,{className:"w-4 h-4 mr-2"}),"Filters"]})}),(0,a.jsxs)("div",{className:"hidden lg:flex flex-wrap gap-4 items-center",children:[(0,a.jsxs)(f.l6,{value:eu.employee,onValueChange:e=>sp("employee",e),children:[(0,a.jsx)(f.bq,{className:"w-[200px]",children:(0,a.jsx)(f.yv,{placeholder:"Filter by employee"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Employees"}),eN.map(e=>(0,a.jsx)(f.eb,{value:e.id.toString(),children:e.name},e.id))]})]}),(0,a.jsxs)(f.l6,{value:eu.priority,onValueChange:e=>sp("priority",e),children:[(0,a.jsx)(f.bq,{className:"w-[200px]",children:(0,a.jsx)(f.yv,{placeholder:"Filter by priority"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Priorities"}),(0,a.jsx)(f.eb,{value:"low",children:"Low"}),(0,a.jsx)(f.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(f.eb,{value:"high",children:"High"})]})]}),(0,a.jsxs)(f.l6,{value:eu.status,onValueChange:e=>sp("status",e),children:[(0,a.jsx)(f.bq,{className:"w-[200px]",children:(0,a.jsx)(f.yv,{placeholder:"Filter by status"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Open Statuses"}),(0,a.jsx)(f.eb,{value:"Assigned",children:"Assigned"}),(0,a.jsx)(f.eb,{value:"Work In Progress",children:"Work In Progress"}),(0,a.jsx)(f.eb,{value:"Complete",children:"Complete"})]})]}),!eQ&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.J,{htmlFor:"startDate",children:"From:"}),(0,a.jsxs)(w.AM,{modal:!1,open:Q,onOpenChange:K,children:[(0,a.jsx)(w.Wv,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal ".concat(!eu.startDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eu.startDate?(0,i.GP)(new Date(eu.startDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick start date"})]})}),(0,a.jsx)(w.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(N.R,{mode:"single",selected:eu.startDate?new Date(eu.startDate):void 0,onSelect:e=>{si("startDate",sl(e)),K(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.J,{htmlFor:"endDate",children:"To:"}),(0,a.jsxs)(w.AM,{modal:!1,open:ee,onOpenChange:es,children:[(0,a.jsx)(w.Wv,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal ".concat(!eu.endDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eu.endDate?(0,i.GP)(new Date(eu.endDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick end date"})]})}),(0,a.jsx)(w.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(N.R,{mode:"single",selected:eu.endDate?new Date(eu.endDate):void 0,onSelect:e=>{si("endDate",sl(e)),es(!1)},initialFocus:!0})})]})]})]})]})]}),(0,a.jsx)(v.lG,{open:H,onOpenChange:e=>{X(e),e||sg()},children:(0,a.jsxs)(v.Cf,{children:[(0,a.jsxs)(v.c7,{children:[(0,a.jsx)(v.L3,{children:"Create New Complaint"}),(0,a.jsx)(v.rr,{children:"Fill in the details to create a new complaint."})]}),(0,a.jsxs)(b.tU,{value:W,className:"w-full",children:[(0,a.jsxs)(b.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(b.Xi,{value:"general",disabled:"details"===W,children:"General"}),(0,a.jsx)(b.Xi,{value:"details",disabled:"general"===W,children:"Details"})]}),(0,a.jsx)(b.av,{value:"general",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"taskTitle",children:"Complaint Title"}),(0,a.jsx)(g.p,{id:"taskTitle",placeholder:"Enter complaint title",value:h.taskTitle,onChange:e=>G({...h,taskTitle:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"taskDesciption",children:"Complaint Description"}),(0,a.jsx)(g.p,{id:"taskDesciption",placeholder:"Enter complaint description",value:h.taskDesciption,onChange:e=>G({...h,taskDesciption:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"category",children:"Category"}),(0,a.jsxs)(f.l6,{value:h.category,onValueChange:e=>G({...h,category:e}),children:[(0,a.jsx)(f.bq,{className:"w-[280px]",children:(0,a.jsx)(f.yv,{placeholder:"Select a category"})}),(0,a.jsx)(f.gC,{children:(0,a.jsx)(f.eb,{value:"Complaint",children:"Complaint"})})]})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>{X(!1),sg()},children:"Cancel"}),(0,a.jsx)(u.$,{onClick:()=>{e_(!0),setTimeout(()=>{_("details"),e_(!1)},500)},disabled:eW,children:eW?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading..."]}):"Next"})]})]})}),(0,a.jsx)(b.av,{value:"details",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsxs)(w.AM,{modal:!1,open:Y,onOpenChange:Z,children:[(0,a.jsx)(w.Wv,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"w-[280px] justify-start text-left font-normal ".concat(!h.dueDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),h.dueDate?(0,i.GP)(new Date(h.dueDate),"PPP"):(0,a.jsx)("span",{children:"Pick a date"})]})}),(0,a.jsx)(w.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(N.R,{mode:"single",selected:h.dueDate?new Date(h.dueDate):void 0,onSelect:e=>{if(e){let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),l="".concat(s,"-").concat(t,"-").concat(a);G({...h,dueDate:l})}else G({...h,dueDate:""});Z(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsxs)(j.J,{htmlFor:"assignedToId",children:["Assigned To ",eQ&&e0.length>0&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Team Members Only)"})]}),(0,a.jsx)(y.A,{options:e5,value:e1,onChange:e=>{if(e4(e),e.length>0){let s=sd.find(s=>s.id.toString()===e[0]);G({...h,assignedToId:parseInt(e[0]),assignedToName:s?"".concat(s.firstName," ").concat(s.lastName):"Unknown",storeId:0,storeName:""}),eb([]),e8([]),so(parseInt(e[0]))}else G({...h,assignedToId:0,assignedToName:"",storeId:0,storeName:""}),eb([]),e8([])},placeholder:eQ&&0===e0.length&&ef.length>0?"Loading team members...":"Select an employee",searchPlaceholder:"Search employees...",className:"w-[280px]"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"priority",children:"Priority"}),(0,a.jsxs)(f.l6,{value:h.priority,onValueChange:e=>G({...h,priority:e}),children:[(0,a.jsx)(f.bq,{className:"w-[280px]",children:(0,a.jsx)(f.yv,{placeholder:"Select a priority"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"low",children:"Low"}),(0,a.jsx)(f.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(f.eb,{value:"high",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(j.J,{htmlFor:"storeId",children:"Store"}),(0,a.jsx)(y.A,{options:e7,value:e6,onChange:e=>{if(e8(e),e.length>0){let s=ew.find(s=>s.id.toString()===e[0]);G({...h,storeId:parseInt(e[0]),storeName:s?s.storeName:"Unknown"})}else G({...h,storeId:0,storeName:""})},placeholder:eH?"Loading stores...":h.assignedToId?"Select a store":"Select employee first",searchPlaceholder:"Search stores...",className:"w-[280px]",disabled:eH||!h.assignedToId})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>{_("general")},children:"Back"}),(0,a.jsx)(u.$,{onClick:sm,children:"Create Complaint"})]})]})})]})]})}),eg?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(A.A,{className:"w-8 h-8 animate-spin text-primary"})}):0===eh?(0,a.jsxs)("div",{className:"text-center py-10",children:[(0,a.jsx)(T.A,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-xl font-semibold",children:"No complaints found."}),(0,a.jsx)("p",{className:"text-gray-500 mt-2",children:"Try adjusting your filters or create a new complaint."})]}):(0,a.jsx)("div",{className:"flex flex-wrap -mx-2",children:e.map((e,s)=>(0,a.jsx)(d.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*s},className:"w-full sm:w-1/2 lg:w-1/3 p-2",children:(0,a.jsxs)(D.Zp,{className:"relative h-full overflow-visible shadow-lg transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl",children:[(0,a.jsxs)(D.aR,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(p.E,{className:"".concat(sj(e.status).color," px-3 py-1 rounded-full font-semibold flex items-center space-x-2"),children:[sj(e.status).icon," ",(0,a.jsx)("span",{children:e.status})]}),(0,a.jsxs)(C.rI,{children:[(0,a.jsx)(C.ty,{asChild:!0,children:(0,a.jsx)(u.$,{variant:"ghost",size:"sm",children:(0,a.jsx)(F.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(C.SQ,{align:"end",children:[(0,a.jsxs)(C._2,{onClick:()=>(e=>{try{sessionStorage.setItem("nav.return.to",JSON.stringify({page:"complaints"}))}catch(e){}R.push("/dashboard/customers/".concat(e))})(e.storeId),children:[(0,a.jsx)(O.A,{className:"mr-2 h-4 w-4"})," View Store"]}),(0,a.jsx)(C.mB,{}),(0,a.jsxs)(C._2,{onClick:()=>(e=>{eP(e),eB(e.id),eO(e.status),eE(!0)})(e),children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"})," Change Status"]}),(0,a.jsx)(C.mB,{}),(0,a.jsxs)(C._2,{onClick:()=>su(e.id),className:"text-red-600",children:[(0,a.jsx)(J.A,{className:"mr-2 h-4 w-4"})," Delete Complaint"]})]})]})]}),(0,a.jsx)(D.ZB,{className:"text-xl mt-2",children:e.taskTitle||"Untitled Complaint"}),(0,a.jsxs)(D.BT,{className:"flex items-center mt-1 text-card-foreground",children:[(0,a.jsx)(O.A,{className:"w-4 h-4 mr-2 text-primary"}),e.storeName]})]}),(0,a.jsxs)(D.Wu,{children:[e.taskDesciption&&(0,a.jsxs)("div",{className:"relative group mb-4 pb-4 border-b border-border",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-card-foreground dark:text-white line-clamp-2",children:e.taskDesciption}),e.taskDesciption.length>80&&(0,a.jsx)("div",{className:"pointer-events-none absolute left-1/2 bottom-full z-50 mb-3 w-full max-w-md -translate-x-1/2 -translate-y-2 rounded-xl border border-primary/40 bg-black p-4 text-white shadow-2xl opacity-0 invisible transition-all duration-200 group-hover:visible group-hover:opacity-100 group-hover:translate-y-0",children:(0,a.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.taskDesciption})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(B.A,{className:"w-4 h-4 text-indigo-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-white",children:"Assigned to"}),(0,a.jsx)("p",{className:"font-medium",children:e.assignedToName})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4 text-purple-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-white",children:"Priority"}),(0,a.jsx)("p",{className:"font-medium capitalize",children:e.priority})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-white",children:[(0,a.jsx)(E.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Due: ",(0,i.GP)(new Date(e.dueDate),"MMM d, yyyy")]})]})]})]})},e.id))}),ec>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.J,{htmlFor:"pageSize",children:"Rows per page:"}),(0,a.jsxs)(f.l6,{value:eo.toString(),onValueChange:e=>ed(parseInt(e)),children:[(0,a.jsx)(f.bq,{className:"w-20",children:(0,a.jsx)(f.yv,{})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"10",children:"10"}),(0,a.jsx)(f.eb,{value:"25",children:"25"}),(0,a.jsx)(f.eb,{value:"50",children:"50"}),(0,a.jsx)(f.eb,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(u.$,{variant:"outline",size:"sm",onClick:()=>er(Math.max(0,en-1)),disabled:0===en,children:[(0,a.jsx)(z.A,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",en+1," of ",ec]}),(0,a.jsxs)(u.$,{variant:"outline",size:"sm",onClick:()=>er(Math.min(ec-1,en+1)),disabled:en>=ec-1,children:["Next",(0,a.jsx)($.A,{className:"h-4 w-4"})]})]})]}),eL&&(0,a.jsx)(v.lG,{open:eL,onOpenChange:ez,children:(0,a.jsxs)(v.Cf,{className:"max-w-3xl",children:[(0,a.jsx)(v.c7,{children:(0,a.jsx)(v.L3,{children:"Image Preview"})}),eU?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)(A.A,{className:"w-8 h-8 animate-spin text-primary"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading images..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e$[eR],alt:"Image ".concat(eR+1),className:"w-full h-auto"}),e$.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.$,{variant:"outline",size:"icon",className:"absolute left-2 top-1/2 transform -translate-y-1/2",onClick:()=>eq(e=>0===e?e$.length-1:e-1),children:(0,a.jsx)(z.A,{className:"h-4 w-4"})}),(0,a.jsx)(u.$,{variant:"outline",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2",onClick:()=>eq(e=>e===e$.length-1?0:e+1),children:(0,a.jsx)($.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("p",{className:"text-center mt-2",children:["Image ",eR+1," of ",e$.length]})]})]})}),(0,a.jsx)(v.lG,{open:eM,onOpenChange:e=>{e?eE(!0):sh()},children:(0,a.jsxs)(v.Cf,{className:"sm:max-w-lg",children:[(0,a.jsxs)(v.c7,{children:[(0,a.jsx)(v.L3,{children:"Change Status"}),(0,a.jsxs)(v.rr,{children:["Update the workflow state for"," ",(0,a.jsx)("strong",{children:(null==eT?void 0:eT.taskTitle)||"this complaint"}),"."]})]}),eT&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3 rounded-xl border border-border/60 bg-muted/30 p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Complaint"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-card-foreground",children:eT.taskTitle||"Untitled Complaint"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:eT.storeName})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Assigned To"}),(0,a.jsx)("p",{className:"font-semibold text-card-foreground",children:eT.assignedToName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Due Date"}),(0,a.jsx)("p",{className:"font-semibold text-card-foreground",children:eT.dueDate?(0,i.GP)(new Date(eT.dueDate),"MMM d, yyyy"):"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Current Status"}),(0,a.jsx)(p.E,{variant:"secondary",className:"text-xs",children:eT.status})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{htmlFor:"complaint-status",children:"New Status"}),(0,a.jsxs)(f.l6,{value:eF,onValueChange:eO,children:[(0,a.jsx)(f.bq,{id:"complaint-status",className:"w-full",children:(0,a.jsx)(f.yv,{placeholder:"Select new status"})}),(0,a.jsx)(f.gC,{children:["Assigned","Work In Progress","Complete"].map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:sh,children:"Cancel"}),(0,a.jsx)(u.$,{onClick:sx,disabled:!eF||eF===eT.status,children:"Update Status"})]})]})]})}),(0,a.jsx)(k.cj,{open:eA,onOpenChange:eI,children:(0,a.jsxs)(k.h,{side:"right",className:"w-[300px] sm:w-[400px]",children:[(0,a.jsx)(k.Fm,{children:(0,a.jsx)(k.qp,{children:"Filter Complaints"})}),(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{className:"text-sm font-medium",children:"Employee"}),(0,a.jsxs)(f.l6,{value:eu.employee,onValueChange:e=>sp("employee",e),children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Filter by employee"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Employees"}),eN.map(e=>(0,a.jsx)(f.eb,{value:e.id.toString(),children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{className:"text-sm font-medium",children:"Priority"}),(0,a.jsxs)(f.l6,{value:eu.priority,onValueChange:e=>sp("priority",e),children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Filter by priority"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Priorities"}),(0,a.jsx)(f.eb,{value:"low",children:"Low"}),(0,a.jsx)(f.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(f.eb,{value:"high",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{className:"text-sm font-medium",children:"Status"}),(0,a.jsxs)(f.l6,{value:eu.status,onValueChange:e=>sp("status",e),children:[(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Filter by status"})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"all",children:"All Open Statuses"}),(0,a.jsx)(f.eb,{value:"Assigned",children:"Assigned"}),(0,a.jsx)(f.eb,{value:"Work In Progress",children:"Work In Progress"}),(0,a.jsx)(f.eb,{value:"Complete",children:"Complete"})]})]})]}),!eQ&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{className:"text-sm font-medium",children:"Start Date"}),(0,a.jsxs)(w.AM,{modal:!1,open:et,onOpenChange:ea,children:[(0,a.jsx)(w.Wv,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!eu.startDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eu.startDate?(0,i.GP)(new Date(eu.startDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick start date"})]})}),(0,a.jsx)(w.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(N.R,{mode:"single",selected:eu.startDate?new Date(eu.startDate):void 0,onSelect:e=>{si("startDate",sl(e)),ea(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j.J,{className:"text-sm font-medium",children:"End Date"}),(0,a.jsxs)(w.AM,{modal:!1,open:el,onOpenChange:ei,children:[(0,a.jsx)(w.Wv,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!eu.endDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eu.endDate?(0,i.GP)(new Date(eu.endDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick end date"})]})}),(0,a.jsx)(w.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(N.R,{mode:"single",selected:eu.endDate?new Date(eu.endDate):void 0,onSelect:e=>{si("endDate",sl(e)),ei(!1)},initialFocus:!0})})]})]})]})]}),(0,a.jsxs)(k.XW,{className:"flex gap-2",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>{ep({search:"",employee:"all",priority:"all",status:"all",startDate:"",endDate:""})},children:"Clear All"}),(0,a.jsx)(u.$,{onClick:()=>eI(!1),children:"Apply Filters"})]})]})})]})}}},e=>{e.O(0,[9358,9,1052,1691,4627,2462,4806,924,9687,8237,2622,8441,1255,7358],()=>e(e.s=58976)),_N_E=e.O()}]);