(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9888],{31856:(e,s,t)=>{"use strict";t.d(s,{CG:()=>c,Fm:()=>p,XW:()=>g,cj:()=>d,h:()=>u,qp:()=>j});var a=t(95155),l=t(12115),i=t(89511),n=t(83101),r=t(65229),o=t(25016);let d=i.bL,c=i.l9;i.bm;let m=i.ZL,h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.hJ,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});h.displayName=i.hJ.displayName;let x=(0,n.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),u=l.forwardRef((e,s)=>{let{side:t="right",className:l,children:n,...d}=e;return(0,a.jsxs)(m,{children:[(0,a.jsx)(h,{}),(0,a.jsxs)(i.UC,{ref:s,className:(0,o.cn)(x({side:t}),l),...d,children:[n,(0,a.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(r.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=i.UC.displayName;let p=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};p.displayName="SheetHeader";let g=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};g.displayName="SheetFooter";let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.hE,{ref:s,className:(0,o.cn)("text-lg font-semibold text-foreground",t),...l})});j.displayName=i.hE.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.VY,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",t),...l})}).displayName=i.VY.displayName},58976:(e,s,t)=>{Promise.resolve().then(t.bind(t,88616))},88616:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>q});var a=t(95155),l=t(12115),i=t(71163),n=t(20063),r=t(82466),o=t(37621),d=t(68209),c=t(1733),m=t(61927),h=t.n(m),x=t(63270),u=t.n(x),p=t(97003),g=t(67812),j=t(33789),f=t(90235),y=t(47507),N=t(98432),v=t(60028),w=t(54679),b=t(97450),D=t(90923),C=t(83209),k=t(7220),S=t(31856),A=t(26983),I=t(42348),T=t(42529),P=t(52056),M=t(46826),F=t(66955),E=t(16485),O=t(37772),J=t(71871),B=t(71360),z=t(20508),L=t(30814),$=t(90368),G=t(27937);let q=()=>{let[e,s]=(0,l.useState)([]),[t,m]=(0,l.useState)([]),[x,q]=(0,l.useState)({id:0,taskTitle:"",taskDesciption:"",dueDate:"",assignedToId:0,assignedToName:"",assignedById:86,status:"Assigned",priority:"low",category:"Complaint",storeId:0,storeName:"",storeCity:"",taskType:"complaint",imageCount:0}),R=(0,n.useRouter)(),U="complaints.filters.v1",[V,W]=(0,l.useState)(!1),[_,H]=(0,l.useState)("general"),[X,Y]=(0,l.useState)(!1),[Z,Q]=(0,l.useState)(!1),[K,ee]=(0,l.useState)(!1),[es,et]=(0,l.useState)(!1),[ea,el]=(0,l.useState)(!1),[ei,en]=(0,l.useState)(!1),[er,eo]=(0,l.useState)(0),[ed,ec]=(0,l.useState)(10),[em,eh]=(0,l.useState)(0),[ex,eu]=(0,l.useState)(0),[ep,eg]=(0,l.useState)({employee:"",priority:"",status:"",search:"",startDate:(0,i.GP)(new Date,"yyyy-MM-dd"),endDate:(0,i.GP)(new Date,"yyyy-MM-dd")}),[ej,ef]=(0,l.useState)(!0),[ey,eN]=(0,l.useState)([]),[ev,ew]=(0,l.useState)([]),[eb,eD]=(0,l.useState)([]),[eC,ek]=(0,l.useState)(null),[eS,eA]=(0,l.useState)(null),[eI,eT]=(0,l.useState)(!1),[eP,eM]=(0,l.useState)(null),[eF,eE]=(0,l.useState)(!1),[eO,eJ]=(0,l.useState)(""),[eB,ez]=(0,l.useState)(null),[eL,e$]=(0,l.useState)(!1),[eG,eq]=(0,l.useState)([]),[eR,eU]=(0,l.useState)(0),[eV,eW]=(0,l.useState)(!1),[e_,eH]=(0,l.useState)(!1),[eX,eY]=(0,l.useState)(!1),[eZ,eQ]=(0,l.useState)(null),[eK,e0]=(0,l.useState)(!1),[e2,e1]=(0,l.useState)([]),[e4,e6]=(0,l.useState)([]),[e8,e5]=(0,l.useState)([]),[e3,e7]=(0,l.useState)([]),[e9,se]=(0,l.useState)([]),{token:ss,userRole:st,userData:sa,currentUser:sl}=(0,r.A)();(0,l.useEffect)(()=>{e0((0,d.co)(st,sl))},[st,sl]),(0,l.useEffect)(()=>{let e=async()=>{if(eK&&(null==sa?void 0:sa.employeeId))try{console.log("Loading team data for manager with employeeId:",sa.employeeId);let e=await o.n.getTeamByEmployee(sa.employeeId);if(e&&e.length>0){let s=e[0],t=s.id;eQ(t),console.log("Team ID loaded:",t);let a=s.fieldOfficers.map(e=>e.id);console.log("Team member IDs:",a);let l=ey.filter(e=>a.includes(e.id));e1(l),console.log("Team members loaded:",l.length)}else console.warn("No team data found for manager"),ek("No team data found for this manager")}catch(e){console.error("Failed to load team data:",e),ek("Failed to load team data")}};eK&&(null==sa?void 0:sa.employeeId)&&ey.length>0&&e()},[eK,null==sa?void 0:sa.employeeId,ey]),(0,l.useEffect)(()=>{if(eC){let e=setTimeout(()=>{ek(null)},2e4);return()=>clearTimeout(e)}},[eC]);let si=e=>{if(!e)return"";let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(s,"-").concat(t,"-").concat(a)},sn=(e,s)=>{eg({...ep,[e]:s})},sr=(0,l.useCallback)(async()=>{if(ss){if(eK&&!eZ)return void console.log("⏳ Manager detected but no teamId yet - waiting for team data");console.log("Fetching tasks with:",{userRole:st,userData:sa,isManager:eK,teamId:eZ,token:ss?"present":"missing"}),ef(!0);try{let e;if(eK&&eZ)e="https://api.gajkesaristeels.in/task/getByTeam?id=".concat(eZ),console.log("Using MANAGER API:",e,"Team ID:",eZ);else{let s=(0,i.GP)(new Date(ep.startDate),"yyyy-MM-dd"),t=(0,i.GP)(new Date(ep.endDate),"yyyy-MM-dd");e="https://api.gajkesaristeels.in/task/getByDate?start=".concat(s,"&end=").concat(t),console.log("Using ADMIN API:",e,"User Role:",st)}let t=await fetch(e,{headers:{Authorization:"Bearer ".concat(ss)}});if(!t.ok){let e=await t.text();throw console.error("API Error:",t.status,e),Error("API request failed: ".concat(t.status," ").concat(e))}let a=await t.json();console.log("API Response:",a);let l=(Array.isArray(a)?a:[]).filter(e=>"complaint"===e.taskType||"requirement"===e.taskType).map(e=>({id:Number(e.id)||0,taskTitle:String(e.taskTitle||""),taskDesciption:String(e.taskDesciption||""),dueDate:String(e.dueDate||""),assignedToId:Number(e.assignedToId)||0,assignedToName:String(e.assignedToName||"Unknown"),assignedById:Number(e.assignedById)||0,status:String(e.status||""),priority:String(e.priority||""),category:String(e.category||""),storeId:Number(e.storeId)||0,storeName:String(e.storeName||""),storeCity:String(e.storeCity||""),taskType:String(e.taskType||""),imageCount:Number(e.imageCount)||0})).sort((e,s)=>new Date(s.dueDate).getTime()-new Date(e.dueDate).getTime()),n=er*ed,r=n+ed,o=l.slice(n,r);s(o),eh(Math.ceil(l.length/ed)),eu(l.length),ef(!1)}catch(e){console.error("Error fetching tasks:",e),ef(!1)}}},[ep,ss,st,sa,eK,eZ,er,ed]),so=(0,l.useCallback)(async()=>{if(ss)try{let e=await fetch("https://api.gajkesaristeels.in/employee/getAll",{headers:{Authorization:"Bearer ".concat(ss)}}),s=await e.json(),t=h()(s,e=>"".concat(e.firstName," ").concat(e.lastName));eN(t)}catch(e){console.error("Error fetching employees:",e)}},[ss]),sd=(0,l.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"storeName",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"asc";if(ss&&e){eY(!0);try{let n="https://api.gajkesaristeels.in/store/getStoreNamesByEmployee?employeeId=".concat(e,"&searchTerm=").concat(s,"&page=").concat(t,"&size=").concat(a,"&sortBy=").concat(l,"&sortOrder=").concat(i),r=await fetch(n,{headers:{Authorization:"Bearer ".concat(ss)}}),o=await r.json();eD(o.content||[])}catch(e){console.error("Error fetching stores:",e)}finally{eY(!1)}}},[ss]);(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(U);if(e){let s=JSON.parse(e);(null==s?void 0:s.filters)&&eg(e=>({...e,...s.filters})),"number"==typeof(null==s?void 0:s.currentPage)&&eo(s.currentPage),"number"==typeof(null==s?void 0:s.pageSize)&&ec(s.pageSize)}}catch(e){}W(!0)},[]),(0,l.useEffect)(()=>{if(V)try{sessionStorage.setItem(U,JSON.stringify({filters:ep,currentPage:er,pageSize:ed}))}catch(e){}},[ep,er,ed,V]),(0,l.useEffect)(()=>{V&&sr()},[sr,eZ,V]),(0,l.useEffect)(()=>{eo(0)},[ep]),(0,l.useEffect)(()=>{so()},[so]);let sc=eK&&e2.length>0?e2:ey;(0,l.useEffect)(()=>{if(e.length>0){let s=u()(e.map(e=>({id:e.assignedToId,name:e.assignedToName})),"id");ew(h()(s,"name"))}},[e]),(0,l.useEffect)(()=>{sm()},[e,ep]),(0,l.useEffect)(()=>{e7((eK&&e2.length>0?e2:ey).map(e=>({value:e.id.toString(),label:"".concat(e.firstName," ").concat(e.lastName)})).sort((e,s)=>e.label.localeCompare(s.label)))},[ey,e2,eK]),(0,l.useEffect)(()=>{se(eb.map(e=>({value:e.id.toString(),label:e.storeName})).sort((e,s)=>e.label.localeCompare(s.label)))},[eb]);let sm=()=>{let s=ep.search.toLowerCase();m(e.filter(e=>{var t,a,l,i;return("complaint"===e.taskType||"requirement"===e.taskType)&&(((null==(t=e.taskTitle)?void 0:t.toLowerCase())||"").includes(s)||((null==(a=e.taskDesciption)?void 0:a.toLowerCase())||"").includes(s)||((null==(l=e.storeName)?void 0:l.toLowerCase())||"").includes(s)||((null==(i=e.assignedToName)?void 0:i.toLowerCase())||"").includes(s))&&(""===ep.employee||"all"===ep.employee||e.assignedToId===parseInt(ep.employee))&&(""===ep.priority||"all"===ep.priority||e.priority===ep.priority)&&(""===ep.status||"all"===ep.status?"Complete"!==e.status:e.status===ep.status)&&(!!eK||(""===ep.startDate||new Date(e.dueDate)>=new Date(ep.startDate))&&(""===ep.endDate||new Date(e.dueDate)<=new Date(ep.endDate)))}))},sh=async()=>{if(ss)try{var e,t,a;let l={...x,taskDesciption:x.taskDesciption,taskType:"complaint"},i=await fetch("https://api.gajkesaristeels.in/task/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(ss)},body:JSON.stringify(l)}),n=await i.json(),r={...x,id:n.id,assignedToName:(null==(e=sc.find(e=>e.id===x.assignedToId))?void 0:e.firstName)+" "+(null==(t=sc.find(e=>e.id===x.assignedToId))?void 0:t.lastName)||"Unknown",storeName:(null==(a=eb.find(e=>e.id===x.storeId))?void 0:a.storeName)||""};s(e=>[r,...e]),Y(!1),sj()}catch(e){console.error("Error creating task:",e)}},sx=()=>{eE(!1),ez(null),eJ(""),eM(null)},su=async()=>{if(ss&&null!==eB){if(eP&&eO===eP.status)return void sx();try{(await fetch("https://api.gajkesaristeels.in/task/updateTask?taskId=".concat(eB),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(ss)},body:JSON.stringify({status:eO})})).ok?(s(e=>e.map(e=>e.id===eB?{...e,status:eO}:e)),sx()):console.error("Failed to update task status")}catch(e){console.error("Error updating task status:",e)}}},sp=async e=>{if(ss)try{await fetch("https://api.gajkesaristeels.in/task/deleteById?taskId=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(ss)}}),sr()}catch(e){console.error("Error deleting task:",e)}},sg=(e,s)=>{eg(t=>({...t,[e]:s})),sm()},sj=()=>{q({id:0,taskTitle:"",taskDesciption:"",dueDate:"",assignedToId:0,assignedToName:"",assignedById:86,status:"Assigned",priority:"low",category:"Complaint",storeId:0,storeName:"",storeCity:"",taskType:"complaint",imageCount:0}),e6([]),e5([]),eD([]),H("general")},sf=e=>{switch(e.toLowerCase()){case"assigned":return{icon:(0,a.jsx)(A.A,{className:"w-4 h-4"}),color:"bg-purple-100 text-purple-800"};case"work in progress":return{icon:(0,a.jsx)(I.A,{className:"w-4 h-4 animate-spin"}),color:"bg-blue-100 text-blue-800"};case"complete":return{icon:(0,a.jsx)(T.A,{className:"w-4 h-4"}),color:"bg-green-100 text-green-800"};default:return{icon:(0,a.jsx)(P.A,{className:"w-4 h-4"}),color:"bg-gray-100 text-gray-800"}}};return(0,a.jsxs)("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[(0,a.jsxs)("div",{className:"flex-grow lg:flex-grow-0 lg:w-64 flex items-center gap-2",children:[(0,a.jsx)(j.p,{placeholder:"Search complaints",value:ep.search,onChange:e=>sg("search",e.target.value),className:"w-full"}),(0,a.jsxs)(p.$,{onClick:()=>Y(!0),children:[(0,a.jsx)(M.A,{className:"w-4 h-4 mr-2"})," New"]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsxs)(p.$,{variant:"outline",size:"sm",className:"lg:hidden",onClick:()=>eT(!0),children:[(0,a.jsx)(F.A,{className:"w-4 h-4 mr-2"}),"Filters"]})}),(0,a.jsxs)("div",{className:"hidden lg:flex flex-wrap gap-4 items-center",children:[(0,a.jsxs)(y.l6,{value:ep.employee,onValueChange:e=>sg("employee",e),children:[(0,a.jsx)(y.bq,{className:"w-[200px]",children:(0,a.jsx)(y.yv,{placeholder:"Filter by employee"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Employees"}),ev.map(e=>(0,a.jsx)(y.eb,{value:e.id.toString(),children:e.name},e.id))]})]}),(0,a.jsxs)(y.l6,{value:ep.priority,onValueChange:e=>sg("priority",e),children:[(0,a.jsx)(y.bq,{className:"w-[200px]",children:(0,a.jsx)(y.yv,{placeholder:"Filter by priority"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Priorities"}),(0,a.jsx)(y.eb,{value:"low",children:"Low"}),(0,a.jsx)(y.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(y.eb,{value:"high",children:"High"})]})]}),(0,a.jsxs)(y.l6,{value:ep.status,onValueChange:e=>sg("status",e),children:[(0,a.jsx)(y.bq,{className:"w-[200px]",children:(0,a.jsx)(y.yv,{placeholder:"Filter by status"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Open Statuses"}),(0,a.jsx)(y.eb,{value:"Assigned",children:"Assigned"}),(0,a.jsx)(y.eb,{value:"Work In Progress",children:"Work In Progress"}),(0,a.jsx)(y.eb,{value:"Complete",children:"Complete"})]})]}),!eK&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.J,{htmlFor:"startDate",children:"From:"}),(0,a.jsxs)(b.AM,{modal:!1,open:K,onOpenChange:ee,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal ".concat(!ep.startDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),ep.startDate?(0,i.GP)(new Date(ep.startDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick start date"})]})}),(0,a.jsx)(b.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(v.R,{mode:"single",selected:ep.startDate?new Date(ep.startDate):void 0,onSelect:e=>{sn("startDate",si(e)),ee(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.J,{htmlFor:"endDate",children:"To:"}),(0,a.jsxs)(b.AM,{modal:!1,open:es,onOpenChange:et,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal ".concat(!ep.endDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),ep.endDate?(0,i.GP)(new Date(ep.endDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick end date"})]})}),(0,a.jsx)(b.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(v.R,{mode:"single",selected:ep.endDate?new Date(ep.endDate):void 0,onSelect:e=>{sn("endDate",si(e)),et(!1)},initialFocus:!0})})]})]})]})]})]}),(0,a.jsx)(w.lG,{open:X,onOpenChange:e=>{Y(e),e||sj()},children:(0,a.jsxs)(w.Cf,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsx)(w.L3,{children:"Create New Complaint"}),(0,a.jsx)(w.rr,{children:"Fill in the details to create a new complaint."})]}),(0,a.jsxs)(D.tU,{value:_,className:"w-full",children:[(0,a.jsxs)(D.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(D.Xi,{value:"general",disabled:"details"===_,children:"General"}),(0,a.jsx)(D.Xi,{value:"details",disabled:"general"===_,children:"Details"})]}),(0,a.jsx)(D.av,{value:"general",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"taskTitle",children:"Complaint Title"}),(0,a.jsx)(j.p,{id:"taskTitle",placeholder:"Enter complaint title",value:x.taskTitle,onChange:e=>q({...x,taskTitle:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"taskDesciption",children:"Complaint Description"}),(0,a.jsx)(j.p,{id:"taskDesciption",placeholder:"Enter complaint description",value:x.taskDesciption,onChange:e=>q({...x,taskDesciption:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"category",children:"Category"}),(0,a.jsxs)(y.l6,{value:x.category,onValueChange:e=>q({...x,category:e}),children:[(0,a.jsx)(y.bq,{className:"w-[280px]",children:(0,a.jsx)(y.yv,{placeholder:"Select a category"})}),(0,a.jsx)(y.gC,{children:(0,a.jsx)(y.eb,{value:"Complaint",children:"Complaint"})})]})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,a.jsx)(p.$,{variant:"outline",onClick:()=>{Y(!1),sj()},children:"Cancel"}),(0,a.jsx)(p.$,{onClick:()=>{eH(!0),setTimeout(()=>{H("details"),eH(!1)},500)},disabled:e_,children:e_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading..."]}):"Next"})]})]})}),(0,a.jsx)(D.av,{value:"details",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsxs)(b.AM,{modal:!1,open:Z,onOpenChange:Q,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-[280px] justify-start text-left font-normal ".concat(!x.dueDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),x.dueDate?(0,i.GP)(new Date(x.dueDate),"PPP"):(0,a.jsx)("span",{children:"Pick a date"})]})}),(0,a.jsx)(b.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(v.R,{mode:"single",selected:x.dueDate?new Date(x.dueDate):void 0,onSelect:e=>{if(e){let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),l="".concat(s,"-").concat(t,"-").concat(a);q({...x,dueDate:l})}else q({...x,dueDate:""});Q(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsxs)(f.J,{htmlFor:"assignedToId",children:["Assigned To ",eK&&e2.length>0&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(Team Members Only)"})]}),(0,a.jsx)(N.A,{options:e3,value:e4,onChange:e=>{if(e6(e),e.length>0){let s=sc.find(s=>s.id.toString()===e[0]);q({...x,assignedToId:parseInt(e[0]),assignedToName:s?"".concat(s.firstName," ").concat(s.lastName):"Unknown",storeId:0,storeName:""}),eD([]),e5([]),sd(parseInt(e[0]))}else q({...x,assignedToId:0,assignedToName:"",storeId:0,storeName:""}),eD([]),e5([])},placeholder:eK&&0===e2.length&&ey.length>0?"Loading team members...":"Select an employee",searchPlaceholder:"Search employees...",className:"w-[280px]"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"priority",children:"Priority"}),(0,a.jsxs)(y.l6,{value:x.priority,onValueChange:e=>q({...x,priority:e}),children:[(0,a.jsx)(y.bq,{className:"w-[280px]",children:(0,a.jsx)(y.yv,{placeholder:"Select a priority"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"low",children:"Low"}),(0,a.jsx)(y.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(y.eb,{value:"high",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(f.J,{htmlFor:"storeId",children:"Store"}),(0,a.jsx)(N.A,{options:e9,value:e8,onChange:e=>{if(e5(e),e.length>0){let s=eb.find(s=>s.id.toString()===e[0]);q({...x,storeId:parseInt(e[0]),storeName:s?s.storeName:"Unknown"})}else q({...x,storeId:0,storeName:""})},placeholder:eX?"Loading stores...":x.assignedToId?"Select a store":"Select employee first",searchPlaceholder:"Search stores...",className:"w-[280px]",disabled:eX||!x.assignedToId})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,a.jsx)(p.$,{variant:"outline",onClick:()=>{H("general")},children:"Back"}),(0,a.jsx)(p.$,{onClick:sh,children:"Create Complaint"})]})]})})]})]})}),ej?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(I.A,{className:"w-8 h-8 animate-spin text-primary"})}):0===ex?(0,a.jsxs)("div",{className:"text-center py-10",children:[(0,a.jsx)(P.A,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-xl font-semibold",children:"No complaints found."}),(0,a.jsx)("p",{className:"text-gray-500 mt-2",children:"Try adjusting your filters or create a new complaint."})]}):(0,a.jsx)("div",{className:"flex flex-wrap -mx-2",children:e.map((e,s)=>(0,a.jsx)(c.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*s},className:"w-full sm:w-1/2 lg:w-1/3 p-2",children:(0,a.jsxs)(C.Zp,{className:"relative h-full overflow-visible shadow-lg transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl",children:[(0,a.jsxs)(C.aR,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(g.E,{className:"".concat(sf(e.status).color," px-3 py-1 rounded-full font-semibold flex items-center space-x-2"),children:[sf(e.status).icon," ",(0,a.jsx)("span",{children:e.status})]}),(0,a.jsxs)(k.rI,{children:[(0,a.jsx)(k.ty,{asChild:!0,children:(0,a.jsx)(p.$,{variant:"ghost",size:"sm",children:(0,a.jsx)(O.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(k.SQ,{align:"end",children:[(0,a.jsxs)(k._2,{onClick:()=>(e=>{try{sessionStorage.setItem("nav.return.to",JSON.stringify({page:"complaints"}))}catch(e){}R.push("/dashboard/customers/".concat(e))})(e.storeId),children:[(0,a.jsx)(J.A,{className:"mr-2 h-4 w-4"})," View Store"]}),(0,a.jsx)(k.mB,{}),(0,a.jsxs)(k._2,{onClick:()=>(e=>{eM(e),ez(e.id),eJ(e.status),eE(!0)})(e),children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Change Status"]}),(0,a.jsx)(k.mB,{}),(0,a.jsxs)(k._2,{onClick:()=>sp(e.id),className:"text-red-600",children:[(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4"})," Delete Complaint"]})]})]})]}),(0,a.jsx)(C.ZB,{className:"text-xl mt-2",children:e.taskTitle||"Untitled Complaint"}),(0,a.jsxs)(C.BT,{className:"flex items-center mt-1 text-card-foreground",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 mr-2 text-primary"}),e.storeName]})]}),(0,a.jsxs)(C.Wu,{children:[e.taskDesciption&&(0,a.jsxs)("div",{className:"relative group mb-4 pb-4 border-b border-border",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-card-foreground dark:text-white line-clamp-2",children:e.taskDesciption}),e.taskDesciption.length>80&&(0,a.jsx)("div",{className:"pointer-events-none absolute left-1/2 bottom-full z-50 mb-3 w-full max-w-md -translate-x-1/2 -translate-y-2 rounded-xl border border-primary/40 bg-black p-4 text-white shadow-2xl opacity-0 invisible transition-all duration-200 group-hover:visible group-hover:opacity-100 group-hover:translate-y-0",children:(0,a.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.taskDesciption})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(z.A,{className:"w-4 h-4 text-indigo-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-white",children:"Assigned to"}),(0,a.jsx)("p",{className:"font-medium",children:e.assignedToName})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4 text-purple-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-white",children:"Priority"}),(0,a.jsx)("p",{className:"font-medium capitalize",children:e.priority})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-white",children:[(0,a.jsx)(E.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Due: ",(0,i.GP)(new Date(e.dueDate),"MMM d, yyyy")]})]})]})]})},e.id))}),em>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.J,{htmlFor:"pageSize",children:"Rows per page:"}),(0,a.jsxs)(y.l6,{value:ed.toString(),onValueChange:e=>ec(parseInt(e)),children:[(0,a.jsx)(y.bq,{className:"w-20",children:(0,a.jsx)(y.yv,{})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"10",children:"10"}),(0,a.jsx)(y.eb,{value:"25",children:"25"}),(0,a.jsx)(y.eb,{value:"50",children:"50"}),(0,a.jsx)(y.eb,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>eo(Math.max(0,er-1)),disabled:0===er,children:[(0,a.jsx)($.A,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",er+1," of ",em]}),(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>eo(Math.min(em-1,er+1)),disabled:er>=em-1,children:["Next",(0,a.jsx)(G.A,{className:"h-4 w-4"})]})]})]}),eL&&(0,a.jsx)(w.lG,{open:eL,onOpenChange:e$,children:(0,a.jsxs)(w.Cf,{className:"max-w-3xl",children:[(0,a.jsx)(w.c7,{children:(0,a.jsx)(w.L3,{children:"Image Preview"})}),eV?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)(I.A,{className:"w-8 h-8 animate-spin text-primary"}),(0,a.jsx)("span",{className:"ml-2",children:"Loading images..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:eG[eR],alt:"Image ".concat(eR+1),className:"w-full h-auto"}),eG.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.$,{variant:"outline",size:"icon",className:"absolute left-2 top-1/2 transform -translate-y-1/2",onClick:()=>eU(e=>0===e?eG.length-1:e-1),children:(0,a.jsx)($.A,{className:"h-4 w-4"})}),(0,a.jsx)(p.$,{variant:"outline",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2",onClick:()=>eU(e=>e===eG.length-1?0:e+1),children:(0,a.jsx)(G.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("p",{className:"text-center mt-2",children:["Image ",eR+1," of ",eG.length]})]})]})}),(0,a.jsx)(w.lG,{open:eF,onOpenChange:e=>{e?eE(!0):sx()},children:(0,a.jsxs)(w.Cf,{className:"sm:max-w-lg",children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsx)(w.L3,{children:"Change Status"}),(0,a.jsxs)(w.rr,{children:["Update the workflow state for"," ",(0,a.jsx)("strong",{children:(null==eP?void 0:eP.taskTitle)||"this complaint"}),"."]})]}),eP&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3 rounded-xl border border-border/60 bg-muted/30 p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Complaint"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-card-foreground",children:eP.taskTitle||"Untitled Complaint"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:eP.storeName})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Assigned To"}),(0,a.jsx)("p",{className:"font-semibold text-card-foreground",children:eP.assignedToName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Due Date"}),(0,a.jsx)("p",{className:"font-semibold text-card-foreground",children:eP.dueDate?(0,i.GP)(new Date(eP.dueDate),"MMM d, yyyy"):"Not set"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase text-muted-foreground",children:"Current Status"}),(0,a.jsx)(g.E,{variant:"secondary",className:"text-xs",children:eP.status})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{htmlFor:"complaint-status",children:"New Status"}),(0,a.jsxs)(y.l6,{value:eO,onValueChange:eJ,children:[(0,a.jsx)(y.bq,{id:"complaint-status",className:"w-full",children:(0,a.jsx)(y.yv,{placeholder:"Select new status"})}),(0,a.jsx)(y.gC,{children:["Assigned","Work In Progress","Complete"].map(e=>(0,a.jsx)(y.eb,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)(p.$,{variant:"outline",onClick:sx,children:"Cancel"}),(0,a.jsx)(p.$,{onClick:su,disabled:!eO||eO===eP.status,children:"Update Status"})]})]})]})}),(0,a.jsx)(S.cj,{open:eI,onOpenChange:eT,children:(0,a.jsxs)(S.h,{side:"right",className:"w-[300px] sm:w-[400px]",children:[(0,a.jsx)(S.Fm,{children:(0,a.jsx)(S.qp,{children:"Filter Complaints"})}),(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{className:"text-sm font-medium",children:"Employee"}),(0,a.jsxs)(y.l6,{value:ep.employee,onValueChange:e=>sg("employee",e),children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by employee"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Employees"}),ev.map(e=>(0,a.jsx)(y.eb,{value:e.id.toString(),children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{className:"text-sm font-medium",children:"Priority"}),(0,a.jsxs)(y.l6,{value:ep.priority,onValueChange:e=>sg("priority",e),children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by priority"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Priorities"}),(0,a.jsx)(y.eb,{value:"low",children:"Low"}),(0,a.jsx)(y.eb,{value:"medium",children:"Medium"}),(0,a.jsx)(y.eb,{value:"high",children:"High"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{className:"text-sm font-medium",children:"Status"}),(0,a.jsxs)(y.l6,{value:ep.status,onValueChange:e=>sg("status",e),children:[(0,a.jsx)(y.bq,{children:(0,a.jsx)(y.yv,{placeholder:"Filter by status"})}),(0,a.jsxs)(y.gC,{children:[(0,a.jsx)(y.eb,{value:"all",children:"All Open Statuses"}),(0,a.jsx)(y.eb,{value:"Assigned",children:"Assigned"}),(0,a.jsx)(y.eb,{value:"Work In Progress",children:"Work In Progress"}),(0,a.jsx)(y.eb,{value:"Complete",children:"Complete"})]})]})]}),!eK&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{className:"text-sm font-medium",children:"Start Date"}),(0,a.jsxs)(b.AM,{modal:!1,open:ea,onOpenChange:el,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!ep.startDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),ep.startDate?(0,i.GP)(new Date(ep.startDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick start date"})]})}),(0,a.jsx)(b.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(v.R,{mode:"single",selected:ep.startDate?new Date(ep.startDate):void 0,onSelect:e=>{sn("startDate",si(e)),el(!1)},initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(f.J,{className:"text-sm font-medium",children:"End Date"}),(0,a.jsxs)(b.AM,{modal:!1,open:ei,onOpenChange:en,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!ep.endDate&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),ep.endDate?(0,i.GP)(new Date(ep.endDate),"MMM d, yyyy"):(0,a.jsx)("span",{children:"Pick end date"})]})}),(0,a.jsx)(b.hl,{className:"w-auto p-0",align:"start",side:"bottom",onInteractOutside:e=>e.preventDefault(),onPointerDownOutside:e=>e.preventDefault(),children:(0,a.jsx)(v.R,{mode:"single",selected:ep.endDate?new Date(ep.endDate):void 0,onSelect:e=>{sn("endDate",si(e)),en(!1)},initialFocus:!0})})]})]})]})]}),(0,a.jsxs)(S.XW,{className:"flex gap-2",children:[(0,a.jsx)(p.$,{variant:"outline",onClick:()=>{eg({search:"",employee:"all",priority:"all",status:"all",startDate:"",endDate:""})},children:"Clear All"}),(0,a.jsx)(p.$,{onClick:()=>eT(!1),children:"Apply Filters"})]})]})})]})}}},e=>{e.O(0,[9358,9,1052,1691,7715,7362,4806,6452,9687,9480,2622,8441,1255,7358],()=>e(e.s=58976)),_N_E=e.O()}]);