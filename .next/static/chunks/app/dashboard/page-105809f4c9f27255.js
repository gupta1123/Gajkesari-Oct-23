(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1150:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let a=s(95155),l=s(12115),n=s(24437);function r(e){return{default:e&&"default"in e?e.default:e}}s(36552);let i={loader:()=>Promise.resolve(r(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},s=(0,l.lazy)(()=>t.loader().then(r)),o=t.loading;function d(e){let r=o?(0,a.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?l.Suspense:l.Fragment,c=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(s,{...e})]}):(0,a.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(s,{...e})});return(0,a.jsx)(d,{...i?{fallback:r}:{},children:c})}return d.displayName="LoadableComponent",d}},8567:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=s(17828)},17828:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,s(64054).createAsyncLocalStorage)()},20508:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21873:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},24437:(e,t,s)=>{"use strict";function a(e){let{reason:t,children:s}=e;return s}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),s(24553)},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(95155);s(12115);var l=s(25016);function n(e){let{className:t,type:s,...n}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,l.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},35299:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},36552:(e,t,s)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),s(95155),s(47650),s(8567),s(77278)},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>m,eb:()=>x,gC:()=>u,l6:()=>d,yv:()=>c});var a=s(95155);s(12115);var l=s(98229),n=s(24033),r=s(5917),i=s(12108),o=s(25016);function d(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"select",...t})}function c(e){let{...t}=e;return(0,a.jsx)(l.WT,{"data-slot":"select-value",...t})}function m(e){let{className:t,size:s="default",children:r,...i}=e;return(0,a.jsxs)(l.l9,{"data-slot":"select-trigger","data-size":s,className:(0,o.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"size-4 opacity-50"})})]})}function u(e){let{className:t,children:s,position:n="popper",...r}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{"data-slot":"select-content",className:(0,o.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[(0,a.jsx)(h,{}),(0,a.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,a.jsx)(p,{})]})})}function x(e){let{className:t,children:s,...n}=e;return(0,a.jsxs)(l.q7,{"data-slot":"select-item",className:(0,o.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(r.A,{className:"size-4"})})}),(0,a.jsx)(l.p4,{children:s})]})}function h(e){let{className:t,...s}=e;return(0,a.jsx)(l.PP,{"data-slot":"select-scroll-up-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(i.A,{className:"size-4"})})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(l.wn,{"data-slot":"select-scroll-down-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(n.A,{className:"size-4"})})}},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>m,Es:()=>x,L3:()=>h,ZJ:()=>d,c7:()=>u,lG:()=>i,rr:()=>p,zM:()=>o});var a=s(95155);s(12115);var l=s(89511),n=s(65229),r=s(25016);function i(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,a.jsx)(l.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,a.jsx)(l.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...s}=e;return(0,a.jsx)(l.hJ,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function m(e){let{className:t,children:s,showCloseButton:i=!0,...o}=e;return(0,a.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(l.UC,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[s,i&&(0,a.jsxs)(l.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(n.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function x(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function h(e){let{className:t,...s}=e;return(0,a.jsx)(l.hE,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",t),...s})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(l.VY,{"data-slot":"dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}},59845:(e,t,s)=>{Promise.resolve().then(s.bind(s,66728))},60028:(e,t,s)=>{"use strict";s.d(t,{R:()=>p});var a=s(3648),l=s(95155),n=s(12115),r=s(90368),i=s(27937),o=s(24033),d=s(74854),c=s(45704),m=s(25016),u=s(97003);function x(){let e=(0,a._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return x=function(){return e},e}function h(){let e=(0,a._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return h=function(){return e},e}function p(e){let{className:t,classNames:s,showOutsideDays:a=!0,captionLayout:n="label",buttonVariant:p="ghost",formatters:f,components:y,...j}=e,v=(0,d.a)();return(0,l.jsx)(c.h,{showOutsideDays:a,className:(0,m.cn)("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(x()),String.raw(h()),t),captionLayout:n,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...f},classNames:{root:(0,m.cn)("w-fit",v.root),months:(0,m.cn)("flex gap-4 flex-col md:flex-row relative",v.months),month:(0,m.cn)("flex flex-col w-full gap-4",v.month),nav:(0,m.cn)("flex items-center gap-2 w-full absolute top-0 inset-x-0 justify-between",v.nav),button_previous:(0,m.cn)((0,u.r)({variant:p}),"size-7 aria-disabled:opacity-50 p-0 select-none",v.button_previous),button_next:(0,m.cn)((0,u.r)({variant:p}),"size-7 aria-disabled:opacity-50 p-0 select-none",v.button_next),month_caption:(0,m.cn)("flex items-center justify-center h-7 w-full px-7",v.month_caption),dropdowns:(0,m.cn)("w-full flex items-center text-sm font-medium justify-center h-7 gap-2",v.dropdowns),dropdown_root:(0,m.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",v.dropdown_root),dropdown:(0,m.cn)("absolute bg-popover inset-0 opacity-0",v.dropdown),caption_label:(0,m.cn)("select-none font-medium","label"===n?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",v.caption_label),table:"w-full border-collapse",weekdays:(0,m.cn)("flex",v.weekdays),weekday:(0,m.cn)("text-muted-foreground rounded-md flex-1 font-normal text-xs select-none py-1",v.weekday),week:(0,m.cn)("flex w-full mt-1",v.week),week_number_header:(0,m.cn)("select-none w-7",v.week_number_header),week_number:(0,m.cn)("text-sm select-none text-muted-foreground",v.week_number),day:(0,m.cn)("relative w-full h-full p-0.5 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",v.day),range_start:(0,m.cn)("rounded-l-md bg-accent",v.range_start),range_middle:(0,m.cn)("rounded-none",v.range_middle),range_end:(0,m.cn)("rounded-r-md bg-accent",v.range_end),today:(0,m.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",v.today),outside:(0,m.cn)("text-muted-foreground aria-selected:text-muted-foreground",v.outside),disabled:(0,m.cn)("text-muted-foreground opacity-50",v.disabled),hidden:(0,m.cn)("invisible",v.hidden),...s},components:{Root:e=>{let{className:t,rootRef:s,...a}=e;return(0,l.jsx)("div",{"data-slot":"calendar",ref:s,className:(0,m.cn)(t),...a})},Chevron:e=>{let{className:t,orientation:s,...a}=e;return"left"===s?(0,l.jsx)(r.A,{className:(0,m.cn)("size-4",t),...a}):"right"===s?(0,l.jsx)(i.A,{className:(0,m.cn)("size-4",t),...a}):(0,l.jsx)(o.A,{className:(0,m.cn)("size-4",t),...a})},DayButton:g,WeekNumber:e=>{let{children:t,...s}=e;return(0,l.jsx)("td",{...s,children:(0,l.jsx)("div",{className:"flex size-7 items-center justify-center text-center",children:t})})},...y},...j})}function g(e){let{className:t,day:s,modifiers:a,...r}=e,i=(0,d.a)(),o=n.useRef(null);return n.useEffect(()=>{var e;a.focused&&(null==(e=o.current)||e.focus())},[a.focused]),(0,l.jsx)(u.$,{ref:o,variant:"ghost",size:"icon","data-day":s.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:(0,m.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-7 flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70 h-7 w-7 m-0.5",i.day,t),...r})}},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{bindSnapshot:function(){return r},createAsyncLocalStorage:function(){return n},createSnapshot:function(){return i}});let s=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw s}getStore(){}run(){throw s}exit(){throw s}enterWith(){throw s}static bind(e){return e}}let l="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function n(){return l?new l:new a}function r(e){return l?l.bind(e):a.bind(e)}function i(){return l?l.snapshot():function(e,...t){return e(...t)}}},66728:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eo});var a=s(95155),l=s(12115),n=s(79956),r=s(82192),i=s(78674),o=s(71163),d=s(97003),c=s(83209),m=s(67812),u=s(47507),x=s(35626),h=s(16485),p=s(35299),g=s(91169),f=s(21873),y=s(71871),j=s(67909),v=s(73344);let b=(0,j.default)(()=>Promise.all([s.e(4804),s.e(1761),s.e(9564)]).then(s.bind(s,79564)),{loadableGenerated:{webpack:()=>[79564]},ssr:!1}),N=e=>"number"!=typeof e||Number.isNaN(e)?"string"!=typeof e||""===e.trim()||Number.isNaN(Number(e))?null:Number(e):e;function w(e){var t,s;let{kpis:l,states:n,onStateSelect:r,markers:i,highlightedEmployee:o,selectedEmployeeMarkers:u,onResetView:x,mapCenter:p,mapZoom:j,onMarkerClick:w,onEmployeeSelect:k,employeeList:S,showVisitLocations:E,onShowVisitLocations:M}=e,D=null==o?null:null!=(s=null!=(t=N(o.id))?t:N(o.listId))?s:N(o.employeeId),A=null!=D?i.filter(e=>{var t;return(null!=(t=N(e.employeeId))?t:N(e.id))===D}):i,C=[...A,...u],L=u.filter(e=>"visit"===e.type).length;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Total Visits"}),(0,a.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(v.DZ,{as:"p",size:"2xl",weight:"bold",children:l.totalVisits}),(0,a.jsx)(v.EY,{size:"xs",tone:"muted",children:"+12% from last period"})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Active Employees"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(v.DZ,{as:"p",size:"2xl",weight:"bold",children:l.activeEmployees}),(0,a.jsx)(v.EY,{size:"xs",tone:"muted",children:"+3% from last period"})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(v.DZ,{as:"p",size:"2xl",weight:"bold",children:l.liveLocations}),(0,a.jsx)(v.EY,{size:"xs",tone:"muted",children:"+8% from last period"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(v.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"State-wise Employee Distribution"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:n.map(e=>(0,a.jsxs)(c.Zp,{className:"cursor-pointer transition-shadow hover:shadow-md",onClick:()=>r(e),children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:e.name}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(v.DZ,{as:"p",size:"xl",weight:"bold",children:e.employeeCount}),(0,a.jsx)(v.EY,{size:"xs",tone:"muted",children:"Employees working"})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(v.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"Live Employee Locations"}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between gap-4 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsxs)(v.EY,{tone:"muted",children:["Click on an employee to zoom to their location",o&&(0,a.jsxs)("span",{className:"ml-2 text-sm font-medium text-primary",children:["• Showing ",A.length+u.length," locations",L>0&&(0,a.jsxs)("span",{className:"ml-1",children:["(",L," visits)"]})]})]})}),(0,a.jsx)(d.$,{variant:"outline",size:"sm",onClick:x,children:"Reset View"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(c.Zp,{className:"h-[600px] overflow-hidden rounded-xl",children:(0,a.jsx)(b,{center:p,zoom:j,highlightedEmployee:o,markers:(console.log("=== LEAFLET MAP MARKERS DEBUG ==="),console.log("Filtered main markers:",A),console.log("Selected employee markers:",u),console.log("Combined markers for map:",C),C),onMarkerClick:w})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(c.Zp,{className:"flex h-[600px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsx)(c.aR,{className:"border-b",children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsxs)(m.E,{variant:"secondary",className:"ml-auto",children:[S.length," online"]})]})}),(0,a.jsx)(c.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:S.map(e=>(0,a.jsxs)("button",{type:"button",className:"w-full p-4 text-left transition-colors ".concat((null==o?void 0:o.listId)===e.listId?"border-l-4 border-primary bg-accent":"hover:bg-accent/50"),onClick:()=>k(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-xl border-2 border-dashed bg-muted"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-card bg-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.DZ,{as:"p",size:"md",className:"text-foreground",children:String(e.name)}),(0,a.jsx)(v.EY,{size:"sm",tone:"muted",children:String(e.position)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:String(e.location).split(",")[0]})]}),(0,a.jsx)(v.EY,{as:"div",size:"xs",tone:"muted",className:"mt-1",children:String(e.formattedLastUpdated)})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.E,{variant:"secondary",className:"text-xs capitalize",children:String(e.status)}),(0,a.jsxs)(m.E,{variant:"outline",className:"text-xs",children:[String(e.visits)," visits"]})]}),(null==o?void 0:o.listId)===e.listId&&!E&&M&&(0,a.jsx)("span",{onClick:e=>{e.stopPropagation(),M()},className:"text-xs text-blue-600 hover:text-blue-800 font-medium cursor-pointer",children:"\uD83D\uDCCD Explore Journey"})]})]},String(e.listId)))})})]})})]})]})]})}var k=s(91585);function S(e){let{selectedState:t,stateEmployees:s,onEmployeeDetailSelect:l}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(v.DZ,{as:"h2",size:"2xl",weight:"bold",children:[t.name," - Employee Details"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>(0,a.jsx)(k.A,{employee:e,onClick:()=>l(e)},String(e.id)))})]})}var E=s(27937),M=s(12108),D=s(24033),A=s(90368),C=s(26265),L=s(24813),P=s(68425),_=s(47734),z=s(73697),I=s(99919),O=s(50892),T=s(37665),Z=s(26467),G=s(68122),R=s(20063),V=s(37621),W=s(97450),B=s(55725),F=s(90235);let U=e=>{let{title:t,value:s}=e;return(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(c.ZB,{className:"text-xs md:text-sm font-medium",children:t})}),(0,a.jsx)(c.Wu,{className:"pt-0",children:(0,a.jsx)("p",{className:"text-2xl md:text-4xl font-bold",children:s})})]})},J=e=>{let{data:t}=e;return(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsx)(c.ZB,{className:"text-base md:text-lg",children:"Visits by Purpose"})}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(C.u,{width:"100%",height:250,className:"md:hidden",children:(0,a.jsxs)(L.E,{data:t,children:[(0,a.jsx)(P.d,{strokeDasharray:"3 3"}),(0,a.jsx)(_.W,{dataKey:"purpose",tick:{fontSize:10}}),(0,a.jsx)(z.h,{tick:{fontSize:10}}),(0,a.jsx)(I.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none",fontSize:"12px"}}),(0,a.jsx)(O.y,{dataKey:"visits",fill:"#1a202c"})]})}),(0,a.jsx)(C.u,{width:"100%",height:300,className:"hidden md:block",children:(0,a.jsxs)(L.E,{data:t,children:[(0,a.jsx)(P.d,{strokeDasharray:"3 3"}),(0,a.jsx)(_.W,{dataKey:"purpose"}),(0,a.jsx)(z.h,{}),(0,a.jsx)(I.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none"}}),(0,a.jsx)(T.s,{}),(0,a.jsx)(O.y,{dataKey:"visits",fill:"#1a202c"})]})})]})]})},Y=e=>{let{visits:t,onViewDetails:s,currentPage:n,onPageChange:r}=e,[i,x]=(0,l.useState)("desc"),[h,p]=(0,l.useState)("date"),[g,y]=(0,l.useState)(null),[j,v]=(0,l.useState)(10),b=(0,l.useRef)(!1),N=e=>e.checkinTime&&e.checkoutTime?{emoji:"✅",status:"Completed"}:e.checkoutTime?{emoji:"⏱️",status:"Checked Out"}:e.checkinTime?{emoji:"\uD83D\uDD70️",status:"On Going"}:{emoji:"\uD83D\uDCC5",status:"Assigned"},w=e=>{e===h?x("asc"===i?"desc":"asc"):(p(e),x("desc")),y(e)},k=j>0?Math.ceil(t.length/j):0,S=0===k?1:k;(0,l.useEffect)(()=>{n>S&&S>0&&!b.current&&(b.current=!0,r(S)),n<=S&&(b.current=!1)},[n,S,r]);let C=[...t].sort((e,t)=>{let s=e[h],a=t[h];return null==s?1:null==a?-1:"string"==typeof s&&"string"==typeof a?"asc"===i?s.localeCompare(a):a.localeCompare(s):s<a?"asc"===i?-1:1:s>a?"asc"===i?1:-1:0}),L=(n-1)*j,P=L+j,_=C.slice(L,P);return(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsx)(c.ZB,{className:"text-base md:text-lg",children:"Recent Completed Visits"})}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsxs)("div",{className:"md:hidden space-y-3",children:[_.map(e=>{let{emoji:t,status:l}=N(e);return"Completed"!==l?null:(0,a.jsx)(c.Zp,{className:"border-l-4 border-l-primary",children:(0,a.jsxs)(c.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm truncate",children:e.customer}),(0,a.jsxs)(m.E,{variant:"outline",className:"text-xs",children:[t," ",l]})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,o.GP)((0,Z.H)(e.date),"dd MMM ''yy")," • ",e.purpose]})]}),(0,a.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id),children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"capitalize truncate max-w-[150px]",children:e.employeeState||"N/A"})]}),(0,a.jsx)(d.$,{variant:"link",className:"px-0 h-auto text-xs",onClick:()=>s(e.id),children:"View"})]})]})},e.id)}),0===_.filter(e=>"Completed"===N(e).status).length&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"No completed visits available"})]}),(0,a.jsx)("div",{className:"hidden md:block overflow-x-auto -mx-4 px-4 md:mx-0 md:px-0",children:(0,a.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("customer"),children:["Store","customer"===g&&("asc"===i?(0,a.jsx)(M.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("date"),children:["Date","date"===g&&("asc"===i?(0,a.jsx)(M.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("purpose"),children:["Purpose","purpose"===g&&("asc"===i?(0,a.jsx)(M.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("employeeState"),children:["City","employeeState"===g&&("asc"===i?(0,a.jsx)(M.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Status"}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[_.map(e=>{let{emoji:t,status:l}=N(e);return"Completed"!==l?null:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.customer}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm whitespace-nowrap",children:(0,o.GP)((0,Z.H)(e.date),"dd MMM ''yy")}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.purpose}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm capitalize",children:e.employeeState||"N/A"}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:(0,a.jsxs)(m.E,{variant:"outline",className:"text-xs whitespace-nowrap",children:[t," ",l]})}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2",children:(0,a.jsx)("button",{className:"text-blue-500 hover:text-blue-700 text-xs md:text-sm",onClick:()=>s(e.id),children:"View"})})]},e.id)}),0===_.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm text-center",colSpan:6,children:"No visits available"})})]})]})})]}),t.length>0&&(0,a.jsxs)("div",{className:"mt-4 border-t pt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(F.J,{htmlFor:"employee-detail-rows",className:"text-muted-foreground",children:"Rows per page:"}),(0,a.jsxs)(u.l6,{value:j.toString(),onValueChange:e=>{v(Number(e)),r(1)},children:[(0,a.jsx)(u.bq,{id:"employee-detail-rows",className:"w-[90px]",children:(0,a.jsx)(u.yv,{})}),(0,a.jsxs)(u.gC,{children:[(0,a.jsx)(u.eb,{value:"10",children:"10"}),(0,a.jsx)(u.eb,{value:"25",children:"25"}),(0,a.jsx)(u.eb,{value:"50",children:"50"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>r(Math.max(1,n-1)),disabled:n<=1,children:[(0,a.jsx)(A.A,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",Math.min(n,S)," of ",S]}),(0,a.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>r(Math.min(S,n+1)),disabled:n>=S,children:["Next",(0,a.jsx)(E.A,{className:"h-4 w-4"})]})]})]})]})};function $(e){var t,s,n,r,i,m,x,h,p;let{employee:g,dateRange:f}=e,[y,j]=(0,l.useState)(null),[v,b]=(0,l.useState)(!0),[N,w]=(0,l.useState)(null),[k,S]=(0,l.useState)(1),E=(0,R.useRouter)(),M="dashboard.employeeDetail.state.v1",[D,A]=(0,l.useState)([]),[C,L]=(0,l.useState)(new Date),[P,_]=(0,l.useState)(new Date),[z,I]=(0,l.useState)(null),[O,T]=(0,l.useState)(new Date().getFullYear()),[Z,F]=(0,l.useState)(new Date().getMonth()+1),[$,K]=(0,l.useState)([]),[q,H]=(0,l.useState)(new Date),[X,Q]=(0,l.useState)(new Date),ee=localStorage.getItem("authToken");(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(M);if(!e)return;let t=JSON.parse(e);if((null==t?void 0:t.employeeId)!==g.id)return;let s=(0,o.GP)(f.start,"yyyy-MM-dd"),a=(0,o.GP)(f.end,"yyyy-MM-dd"),l="string"==typeof t.startKey?t.startKey:null,n="string"==typeof t.endKey?t.endKey:null,r="number"==typeof t.currentPage?t.currentPage:null;null!=r&&l===s&&n===a?k!==r&&S(r):1!==k&&S(1),t.expenseStartDate&&"string"==typeof t.expenseStartDate&&L(new Date(t.expenseStartDate)),t.expenseEndDate&&"string"==typeof t.expenseEndDate&&_(new Date(t.expenseEndDate)),"number"==typeof t.selectedYear&&T(t.selectedYear),"number"==typeof t.selectedMonth&&F(t.selectedMonth),t.pricingStartDate&&"string"==typeof t.pricingStartDate&&H(new Date(t.pricingStartDate)),t.pricingEndDate&&"string"==typeof t.pricingEndDate&&Q(new Date(t.pricingEndDate))}catch(e){}},[g.id,f.start,f.end,k]),(0,l.useEffect)(()=>{try{sessionStorage.setItem(M,JSON.stringify({employeeId:g.id,currentPage:k,startKey:(0,o.GP)(f.start,"yyyy-MM-dd"),endKey:(0,o.GP)(f.end,"yyyy-MM-dd"),expenseStartDate:C,expenseEndDate:P,selectedYear:O,selectedMonth:Z,pricingStartDate:q,pricingEndDate:X}))}catch(e){}},[g.id,k,f.start,f.end,C,P,O,Z,q,X]),(0,l.useEffect)(()=>{(async()=>{b(!0),w(null);try{let e=(0,o.GP)(f.start,"yyyy-MM-dd"),t=(0,o.GP)(f.end,"yyyy-MM-dd"),s=await V.n.getEmployeeStatsWithVisits(g.id,e,t);j(s)}catch(e){w((null==e?void 0:e.message)||"Failed to load employee details")}finally{b(!1)}})()},[g.id,f.start,f.end]),(0,l.useEffect)(()=>{(async()=>{if(ee)try{let e=C?(0,o.GP)(C,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=P?(0,o.GP)(P,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/expense/getByEmployeeAndDate?start=".concat(e,"&end=").concat(t,"&id=").concat(g.id),{headers:{Authorization:"Bearer ".concat(ee)}}),a=await s.json();A(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching expenses:",e)}})()},[ee,g.id,C,P]),(0,l.useEffect)(()=>{(async()=>{if(ee)try{let e="".concat(O,"-").concat(String(Z).padStart(2,"0"),"-01"),t=await fetch("https://api.gajkesaristeels.in/attendance-log/monthlyVisits?date=".concat(e,"&employeeId=").concat(g.id),{headers:{Authorization:"Bearer ".concat(ee)}}),s=await t.json();I(s)}catch(e){console.error("Error fetching attendance stats:",e)}})()},[ee,g.id,O,Z]),(0,l.useEffect)(()=>{(async()=>{if(ee)try{let e=q?(0,o.GP)(q,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=X?(0,o.GP)(X,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/brand/getByDateRangeForEmployee?start=".concat(e,"&end=").concat(t,"&id=").concat(g.id),{headers:{Authorization:"Bearer ".concat(ee)}}),a=await s.json();K(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching daily pricing:",e)}})()},[ee,g.id,q,X]);let et=(0,l.useMemo)(()=>y&&y.visitDto?Object.entries(y.visitDto.filter(e=>e.checkinTime&&e.checkoutTime).reduce((e,t)=>{let s=t.purpose?t.purpose.trim().toLowerCase():"unknown";return e[s]||(e[s]=0),e[s]++,e},{})).map(e=>{let[t,s]=e;return{purpose:t.charAt(0).toUpperCase()+t.slice(1),visits:Number(s)}}):[],[y]);if(N)return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded p-3",children:N})});if(v)return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(G.E,{className:"h-8 w-48"}),(0,a.jsx)(G.E,{className:"h-4 w-32 mt-2"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(G.E,{className:"h-4 w-28"})}),(0,a.jsx)(c.Wu,{className:"pt-0",children:(0,a.jsx)(G.E,{className:"h-8 w-16"})})]},t))}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsx)(G.E,{className:"h-6 w-56"})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 p-3 border rounded",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)(G.E,{className:"h-4 w-40"}),(0,a.jsx)(G.E,{className:"h-3 w-56 mt-2"})]}),(0,a.jsx)(G.E,{className:"h-5 w-16"})]},t))})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsx)(G.E,{className:"h-6 w-40"})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)(G.E,{className:"h-64 w-full"})})]})]});let es=((null==y?void 0:y.visitDto)||[]).map(e=>({id:e.id,date:e.visit_date,customer:e.storeName,purpose:e.purpose||"—",status:"completed",duration:"-",checkinTime:e.checkinTime,checkoutTime:e.checkoutTime,employeeState:e.state})),ea=es.filter(e=>e.checkinTime&&e.checkoutTime).length;return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold capitalize",children:g.name}),(0,a.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:g.position})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6 md:mb-8",children:[(0,a.jsx)(U,{title:"Total Completed Visits",value:ea}),(0,a.jsx)(U,{title:"Full Days",value:(null==y||null==(t=y.statsDto)?void 0:t.fullDays)||0}),(0,a.jsx)(U,{title:"Half Days",value:(null==y||null==(s=y.statsDto)?void 0:s.halfDays)||0}),(0,a.jsx)(U,{title:"Absences",value:(null==y||null==(n=y.statsDto)?void 0:n.absences)||0})]}),(0,a.jsx)(Y,{visits:es,onViewDetails:e=>{try{sessionStorage.setItem("dashboard.view.state.v1",JSON.stringify({view:"employeeDetail",selectedEmployee:{id:g.id,name:g.name,position:g.position,avatar:g.avatar,location:g.location}}))}catch(e){}E.push("/dashboard/visits/".concat(e))},currentPage:k,onPageChange:S}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(J,{data:et})}),(0,a.jsxs)("div",{className:"mt-6 md:mt-8 space-y-3 md:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 md:gap-4",children:[(0,a.jsxs)(u.l6,{value:O.toString(),onValueChange:e=>T(parseInt(e)),children:[(0,a.jsx)(u.bq,{className:"w-full sm:w-[120px] text-xs md:text-sm",children:(0,a.jsx)(u.yv,{placeholder:"Year"})}),(0,a.jsx)(u.gC,{children:Array.from({length:5},(e,t)=>new Date().getFullYear()-t).map(e=>(0,a.jsx)(u.eb,{value:e.toString(),className:"text-xs md:text-sm",children:e},e))})]}),(0,a.jsxs)(u.l6,{value:Z.toString(),onValueChange:e=>F(parseInt(e)),children:[(0,a.jsx)(u.bq,{className:"w-full sm:w-[140px] text-xs md:text-sm",children:(0,a.jsx)(u.yv,{placeholder:"Month"})}),(0,a.jsx)(u.gC,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,a.jsx)(u.eb,{value:(t+1).toString(),className:"text-xs md:text-sm",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 md:gap-4",children:[(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Full Day"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(x=null==z||null==(r=z.statsDto)?void 0:r.fullDays)?x:0})]})}),(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Half Day"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(h=null==z||null==(i=z.statsDto)?void 0:i.halfDays)?h:0})]})}),(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Absent"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(p=null==z||null==(m=z.statsDto)?void 0:m.absences)?p:0})]})})]})]}),(0,a.jsxs)("div",{className:"mt-6 md:mt-8 space-y-3 md:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 md:gap-4",children:[(0,a.jsxs)(W.AM,{children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-full sm:w-auto text-xs md:text-sm justify-start",children:["Start: ",C?(0,o.GP)(C,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:C,onSelect:L})})]}),(0,a.jsxs)(W.AM,{children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-full sm:w-auto text-xs md:text-sm justify-start",children:["End: ",P?(0,o.GP)(P,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:P,onSelect:_})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:D.map((e,t)=>(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm font-medium",children:String(e.type||"N/A")}),(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:String(e.employeeName||"N/A")}),(0,a.jsxs)("div",{className:"mt-2 text-sm md:text-base",children:["Amount: ₹",Number(e.amount||0).toFixed(2)]}),(0,a.jsx)("div",{className:"text-xs md:text-sm",children:String(e.approvalStatus||"N/A")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.expenseDate&&"string"==typeof e.expenseDate?(0,o.GP)(new Date(e.expenseDate),"MMM d, yyyy"):""})]})},String(e.id)||t))})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(W.AM,{children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",children:["Start: ",q?(0,o.GP)(q,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:q,onSelect:H})})]}),(0,a.jsxs)(W.AM,{children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",children:["End: ",X?(0,o.GP)(X,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:X,onSelect:Q})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:$.map((e,t)=>(0,a.jsx)(c.Zp,{children:(0,a.jsxs)(c.Wu,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-medium",children:String(e.brandName||"N/A")}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:String(e.city||"N/A")})]}),(0,a.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:["₹",Number(e.price||0).toFixed(2)]})]})},String(e.id)||t))})]})]})}function K(e){let{employee:t,dateRange:s}=e;return(0,a.jsx)($,{employee:t,dateRange:s})}var q=s(82466),H=s(54679),X=s(33789);let Q={brandName:"Gajkesari",price:"",city:""},ee=e=>{let{open:t,onOpenChange:s,onCreateSuccess:n}=e,{token:r,userData:i}=(0,q.A)(),[o,c]=(0,l.useState)(Q),[m,u]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t||c(Q)},[t]);let x=(0,l.useMemo)(()=>{var e;return null!=(e=null==i?void 0:i.employeeId)?e:86},[null==i?void 0:i.employeeId]),h=async()=>{if(r){u(!0);try{let e=Number(o.price);if(Number.isNaN(e))return void u(!1);let t={brandName:o.brandName.trim(),price:e,city:o.city.trim(),state:"",district:"",subDistrict:"",employeeDto:{id:x}};if(!(await fetch("https://api.gajkesaristeels.in/brand/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(t)})).ok)throw Error("API Error");null==n||n(),s(!1)}catch(e){console.error("Error creating pricing:",e)}finally{u(!1)}}};return(0,a.jsx)(H.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(H.Cf,{className:"sm:max-w-[425px] p-6",children:[(0,a.jsxs)(H.c7,{children:[(0,a.jsx)(H.L3,{children:"Set Today's Pricing"}),(0,a.jsx)(H.rr,{children:"No Gajkesari pricing was found for today. Please enter the latest details."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F.J,{htmlFor:"brandName",children:"Name"}),(0,a.jsx)(X.p,{id:"brandName",value:o.brandName,onChange:e=>c(t=>({...t,brandName:e.target.value})),className:"col-span-3",placeholder:"Enter brand name"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F.J,{htmlFor:"price",children:"Pricing"}),(0,a.jsx)(X.p,{id:"price",type:"number",value:o.price,onChange:e=>c(t=>({...t,price:e.target.value})),className:"col-span-3",placeholder:"Enter price"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(F.J,{htmlFor:"city",children:"City"}),(0,a.jsx)(X.p,{id:"city",value:o.city,onChange:e=>c(t=>({...t,city:e.target.value})),className:"col-span-3",placeholder:"Enter city"})]})]}),(0,a.jsxs)(H.Es,{className:"gap-2",children:[(0,a.jsx)(d.$,{variant:"outline",type:"button",onClick:()=>{s(!1)},children:"Close"}),(0,a.jsx)(d.$,{onClick:h,disabled:m||!o.brandName.trim()||!o.price.trim()||Number.isNaN(Number(o.price))||!o.city.trim(),type:"button",children:m?"Creating...":"Create"})]})]})})};var et=s(60028),es=s(68209);let ea=[22.5726,88.3639],el={Mumbai:[19.076,72.8777],Bangalore:[12.9716,77.5946],Chennai:[13.0827,80.2707],Hyderabad:[17.385,78.4867],Kolkata:[22.5726,88.3639],Delhi:[28.6139,77.209]},en=e=>{let t=Object.entries(el).find(t=>{let[s]=t;return e.includes(s)});return t?t[1]:ea},er=["bg-blue-500","bg-green-500","bg-yellow-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500"],ei=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"thisWeek",label:"This Week"},{value:"thisMonth",label:"This Month"},{value:"custom",label:"Custom Range"}];function eo(){let{userRole:e,userData:t,currentUser:s,token:j}=(0,q.A)(),[b,N]=(0,l.useState)("today"),[k,E]=(0,l.useState)(void 0),[M,D]=(0,l.useState)(void 0),[A,C]=(0,l.useState)(!1),[L,P]=(0,l.useState)(!1),[_,z]=(0,l.useState)(!1),[I,O]=(0,l.useState)("dashboard"),[T,Z]=(0,l.useState)(null),[R,B]=(0,l.useState)(null),[F,U]=(0,l.useState)(ea),[J,Y]=(0,l.useState)(5),[$,H]=(0,l.useState)(null),[X,Q]=(0,l.useState)([]),[el,eo]=(0,l.useState)([]),[ed,ec]=(0,l.useState)([]),[em,eu]=(0,l.useState)({totalVisits:0,activeEmployees:0,liveLocations:0}),[ex,eh]=(0,l.useState)(new Map),[ep,eg]=(0,l.useState)([]),[ef,ey]=(0,l.useState)([]),[ej,ev]=(0,l.useState)(null),[eb,eN]=(0,l.useState)(!1),[ew,ek]=(0,l.useState)(!1),[eS,eE]=(0,l.useState)(null),[eM,eD]=(0,l.useState)(!0),[eA,eC]=(0,l.useState)(!1),[eL,eP]=(0,l.useState)(!1),[e_,ez]=(0,l.useState)(!1),[eI,eO]=(0,l.useState)(!1),[eT,eZ]=(0,l.useState)(!1),eG="dashboard.view.state.v1",eR="pricingModalDismissed";(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(eG);if(e){let t=JSON.parse(e);(null==t?void 0:t.selectedState)&&Z(t.selectedState),(null==t?void 0:t.view)==="employeeDetail"&&(null==t?void 0:t.selectedEmployee)?(B(t.selectedEmployee),O("employeeDetail")):(null==t?void 0:t.view)==="state"&&(null==t?void 0:t.selectedState)&&O("state")}}catch(e){}(async()=>{if(j)try{let e=await fetch("https://api.gajkesaristeels.in/user/manage/current-user",{headers:{Authorization:"Bearer ".concat(j),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("Dashboard - Current user data:",t);let s=t.authorities||[],a=s.length>0?s[0].authority:null,l=(0,es.N4)(a);eN(l),eE(a),console.log("Dashboard - Role from API:",a),console.log("Dashboard - isManager:",l),console.log("Dashboard - currentUserRole set to:",a),ek(!0)}else console.error("Dashboard - Failed to fetch current user data"),eE(null),ek(!0)}catch(e){console.error("Dashboard - Error fetching current user:",e),eE(null),ek(!0)}})()},[j]),(0,l.useEffect)(()=>{eZ("true"===sessionStorage.getItem(eR))},[]);let eV=(0,l.useCallback)(()=>{ez(!1),eT||(eZ(!0),sessionStorage.setItem(eR,"true"))},[eT]);(0,l.useEffect)(()=>{if(console.log("Pricing check useEffect triggered:",{token:j?"present":"missing",isPricingDismissed:eT,hasCheckedPricing:eI,isRoleDetermined:ew,currentUserRole:eS}),!j||eT||eI||!ew)return;let e=(null!=eS?eS:"").toUpperCase(),t=e.includes("ADMIN");if(console.log("User role check:",{normalizedRole:e,isAdmin:t}),!t){console.log("User is not admin, skipping pricing check"),eO(!0);return}(async()=>{try{let e=new Date().toISOString().split("T")[0];console.log("Checking pricing for today:",e);let t=await fetch("https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(j)}});if(!t.ok){console.log("Pricing API response not ok:",t.status,t.statusText),eO(!0);return}let s=await t.json();console.log("Pricing API response data:",s);let a=s.some(e=>"string"==typeof e.brandName&&"gajkesari"===e.brandName.toLowerCase());console.log("Has Gajkesari pricing:",a),a?console.log("Gajkesari pricing found, not showing modal"):(console.log("No Gajkesari pricing found, showing modal"),ez(!0)),eO(!0)}catch(e){console.error("Dashboard - Error checking Gajkesari pricing:",e),eO(!0)}})()},[j,eS,eT,eI,ew]),(0,l.useEffect)(()=>{try{sessionStorage.setItem(eG,JSON.stringify({view:I,selectedState:T,selectedEmployee:R}))}catch(e){}},[I,T,R]),(0,l.useEffect)(()=>{let e=async()=>{if(eb&&(null==t?void 0:t.employeeId))try{let e=(await V.n.getTeamByEmployee(t.employeeId)).flatMap(e=>e.fieldOfficers.map(e=>e.id)),s=X.filter(t=>e.includes(t.id));eo(s)}catch(e){console.error("Failed to load team members:",e),ev("Failed to load team members")}};eb&&X.length>0&&e()},[eb,null==t?void 0:t.employeeId,X]),(0,l.useEffect)(()=>{(async()=>{if(ew)try{eD(!0);let e=(await V.n.getAllEmployees()||[]).map(e=>({id:e.id,name:[e.firstName,e.lastName].filter(Boolean).join(" ")||String(e.id),position:e.role||"Employee",avatar:"/placeholder.svg?height=40&width=40",lastUpdated:new Date().toISOString(),status:"active",location:[e.city,e.state].filter(Boolean).join(", ")}));Q(e)}catch(e){ev((null==e?void 0:e.message)||"Failed to load employees")}finally{eD(!1)}})()},[ew]);let eW=(0,l.useMemo)(()=>eb&&el.length>0?el:X,[eb,el,X]),eB=(0,l.useMemo)(()=>{let e=new Date;if("custom"===b&&k&&M)return{start:k,end:M};switch(b){case"today":default:return{start:e,end:e};case"yesterday":{let t=(0,n.e)(e,1);return{start:t,end:t}}case"thisWeek":return{start:(0,r.k)(e),end:e};case"thisMonth":return{start:(0,i.w)(e),end:e}}},[b,k,M]);(0,l.useEffect)(()=>{(async()=>{if(ew)try{eC(!0);let e=(0,o.GP)(eB.start,"yyyy-MM-dd"),t=(0,o.GP)(eB.end,"yyyy-MM-dd"),s=await V.n.getReportCounts(e,t),a=eb?s.filter(e=>eW.some(t=>t.id===e.employeeId)):s,l=(a||[]).reduce((e,t)=>{var s,a;return e+(null!=(a=null==(s=t.statsDto)?void 0:s.visitCount)?a:0)},0),n=(a||[]).filter(e=>{var t,s;return(null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)>0}).length,r=new Map;a.forEach(e=>{var t,s;return r.set(e.employeeId,null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)}),eh(r),eu(e=>({...e,totalVisits:l,activeEmployees:n}))}catch(e){console.error("Error fetching KPIs:",e)}finally{eC(!1)}})()},[eB.start,eB.end,eb,eW,ew]),(0,l.useEffect)(()=>{let e=!1;return(async()=>{if(ew)try{let t=await V.n.getAllEmployeeLocations(),s=[];t.forEach(e=>{if(null!=e.latitude&&null!=e.longitude&&0!==e.latitude&&0!==e.longitude&&0!==e.latitude&&0!==e.longitude){let t=!0;if(eb&&(t=el.some(t=>t.id===e.empId)),!t)return void console.log("Skipping employee ".concat(e.empName," (ID: ").concat(e.empId,") - not in team"));let a=String(e.updatedTime).split(".")[0],l=new Date("".concat(e.updatedAt,"T").concat(a)),n=l.toISOString().split("T")[0],r=eB.start.toISOString().split("T")[0],i=eB.end.toISOString().split("T")[0];console.log("Location date check for ".concat(e.empName,":"),{locationDate:n,startDateStr:r,endDateStr:i,inRange:n>=r&&n<=i}),n>=r&&n<=i&&s.push({id:e.empId,name:e.empName,lat:e.latitude,lng:e.longitude,subtitle:"".concat((0,o.GP)(l,"dd MMM ''yy")," ").concat(a).trim(),type:"live",employeeId:e.empId,tooltipLines:["Employee: ".concat(e.empName),"Last updated: ".concat((0,o.GP)(l,"dd MMM ''yy, hh:mm a"))]})}}),e||(s.sort((e,t)=>(e.name||"").localeCompare(t.name||"")),eg(s))}catch(t){e||eg([])}})(),()=>{e=!0}},[eb,el,ew,eB.start,eB.end]),(0,l.useEffect)(()=>{eu(e=>({...e,liveLocations:ep.length}))},[ep.length]),(0,l.useEffect)(()=>{if(!X.length)return;let e=new Map;X.forEach(t=>{var s;let a=null!=(s=ex.get(t.id))?s:0,l=t.location.split(", ")[1]||"Unknown";a>0&&e.set(l,(e.get(l)||0)+1)}),ec(Array.from(e.entries()).map((e,t)=>{let[s,a]=e;return{id:t+1,name:s,employeeCount:a,color:er[t%er.length]}}))},[X,ex]);let eF=(0,l.useMemo)(()=>{let e=new Map;ep.forEach(t=>{e.set(Number(t.id),{lat:t.lat,lng:t.lng,subtitle:t.subtitle})});let t=eW.filter(t=>e.has(t.id)).map(t=>{var s,a;return{...t,listId:String(t.id),visits:null!=(a=ex.get(t.id))?a:0,formattedLastUpdated:(null==(s=e.get(t.id))?void 0:s.subtitle)||""}});return t.sort((e,t)=>e.name.localeCompare(t.name)),t},[eW,ex,ep]),eU=(0,l.useMemo)(()=>T?eW.filter(e=>{var t;return e.location.includes(T.name)&&(null!=(t=ex.get(e.id))?t:0)>0}):[],[T,eW,ex]),eJ=(0,l.useCallback)(()=>{if("employeeDetail"===I){O("state"),B(null);return}"state"===I&&(O("dashboard"),Z(null),H(null),U(ea),Y(5))},[I]),eY=(0,l.useCallback)(e=>{e&&(Z({id:e.id,name:e.name,employeeCount:e.employeeCount,color:e.color||er[0]}),O("state"))},[]),e$=(0,l.useCallback)(async e=>{console.log("=== EMPLOYEE SELECTION DEBUG ==="),console.log("Selected employee:",e);let t=ep.find(t=>Number(t.id)===e.id);console.log("Live marker found:",t),ey([]),H(e),eP(!1);try{console.log("Fetching employee details for ID:",e.id);let s=await V.n.getEmployeeById(e.id);console.log("Employee detail response:",s);let a=[];if(!s||null==s.houseLatitude||null==s.houseLongitude||isNaN(Number(s.houseLatitude))||isNaN(Number(s.houseLongitude)))console.log("No house location data available:",{hasDetail:!!s,houseLat:null==s?void 0:s.houseLatitude,houseLng:null==s?void 0:s.houseLongitude,isValidLat:(null==s?void 0:s.houseLatitude)!=null&&!isNaN(Number(s.houseLatitude)),isValidLng:(null==s?void 0:s.houseLongitude)!=null&&!isNaN(Number(s.houseLongitude))});else{let t=Number(s.houseLatitude),l=Number(s.houseLongitude);if(0!==t&&0!==l&&0!==t&&0!==l){let n=[s.city,s.state,s.country].filter(Boolean).join(", "),r={id:"house-".concat(s.id),name:"".concat(e.name,"'s Home"),lat:t,lng:l,subtitle:n,type:"house",employeeId:s.id,tooltipLines:[]};a.push(r),console.log("Added house marker:",r)}else console.log("House coordinates are invalid (0,0):",{houseLat:t,houseLng:l,employeeName:e.name})}if(t&&console.log("Live marker already exists in main markers array, not adding to selected markers"),console.log("Total markers to set:",a),ey(a),!(a.length>0||t)){console.log("No location data available for employee:",e.name);let t={id:"no-location-".concat(e.id),name:"".concat(e.name," - Location Data Unavailable"),lat:ea[0],lng:ea[1],subtitle:"Location information not available",type:"live",employeeId:e.id,tooltipLines:["Employee: ".concat(e.name),"Location data is not available","This could be due to:","• No recent location updates","• Location services disabled","• Data not yet synchronized"]};ey([t]),U(ea),Y(5);return}let l=[...a];if(l.length>0){let e=l.map(e=>e.lat),t=l.map(e=>e.lng),s=Math.min(...e),a=Math.max(...e),n=Math.min(...t),r=Math.max(...t);U([(s+a)/2,(n+r)/2]),Y(12)}else if(t)console.log("Centering on live marker:",t),U([t.lat,t.lng]),Y(15);else{let t=en(e.location);U(t),Y(10)}}catch(s){console.error("Failed to load employee details:",s),t?(U([t.lat,t.lng]),Y(13)):(U(en(e.location)),Y(10))}},[ep]),eK=(0,l.useCallback)(e=>{B(e),O("employeeDetail")},[]),eq=(0,l.useCallback)(async()=>{if($)try{var e;let t=(0,o.GP)(eB.start,"yyyy-MM-dd"),s=(0,o.GP)(eB.end,"yyyy-MM-dd");console.log("=== VISIT LOCATIONS DEBUG ==="),console.log("Fetching visit stats for employee:",$.id),console.log("Date range:",{start:t,end:s});let a=await V.n.getEmployeeStatsByDateRange($.id,t,s);console.log("Visit stats response:",a);let l=[],n=(e,t)=>{if(!e)return"Not available";let s=t?t.split(".")[0]:null,a=s&&8===s.length?s:s?"".concat(s):"00:00:00",l=new Date("".concat(e,"T").concat(null!=a?a:"00:00:00"));return Number.isNaN(l.getTime())?e:(0,o.GP)(l,"dd MMM yyyy, hh:mm a")},r=null!=(e=null==a?void 0:a.visitDto)?e:[];console.log("Processing visits:",r.length,"visits found"),r.forEach((e,t)=>{var s,a,r,i;let o=null!=(a=null!=(s=e.checkinLatitude)?s:e.visitLatitude)?a:e.storeLatitude,d=null!=(i=null!=(r=e.checkinLongitude)?r:e.visitLongitude)?i:e.storeLongitude;if(console.log("Visit ".concat(t+1,":"),{visitId:e.id,storeName:e.storeName,checkinLat:e.checkinLatitude,checkinLng:e.checkinLongitude,visitLat:e.visitLatitude,visitLng:e.visitLongitude,storeLat:e.storeLatitude,storeLng:e.storeLongitude,finalLat:o,finalLng:d}),null==o||null==d||0===o||0===d||0===o||0===d)return void console.log("Visit ".concat(t+1," skipped: No valid coordinates"),{lat:o,lng:d,storeName:e.storeName});let c=n(e.checkinDate,e.checkinTime),m=e.checkoutDate||e.checkoutTime?n(e.checkoutDate,e.checkoutTime):"Not recorded",u=[e.city,e.state,e.country].filter(Boolean).join(", "),x=["Store: ".concat(e.storeName||"N/A"),"Employee: ".concat(e.employeeName||$.name),"Check-in: ".concat(c),"Check-out: ".concat(m),e.purpose?"Purpose: ".concat(e.purpose):null,u?"Address: ".concat(u):null].filter(Boolean),h={id:"visit-".concat(e.id),name:e.storeName||"Visit",lat:Number(o),lng:Number(d),subtitle:"".concat(e.storeName||"Visit"," - ").concat(e.purpose||"Visit"),type:"visit",employeeId:e.employeeId,tooltipLines:x};l.push(h),console.log("Added visit marker ".concat(t+1,":"),h)}),console.log("Total visit markers created:",l.length);let i=[...ef,...l];console.log("Updated markers (existing + visits):",i),ey(i),eP(!0);let d=ep.find(e=>Number(e.id)===$.id),c=[...i];if(d&&c.push(d),c.length>0){let e=c.map(e=>e.lat),t=c.map(e=>e.lng),s=Math.min(...e),a=Math.max(...e),l=Math.min(...t),n=Math.max(...t),r=Math.max(a-s,n-l),i=11;i=r>1?8:r>.5?9:r>.1?10:12,U([(s+a)/2,(l+n)/2]),Y(i)}}catch(e){console.error("Failed to load visit locations:",e)}},[$,eB.start,eB.end,ep,ef]),eH=(0,l.useCallback)(async e=>{if("live"===e.type){let t=Number(e.id),s=eF.find(e=>e.id===t);s&&(H(s),U([e.lat,e.lng]),Y(13))}},[eF]);return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(v.DZ,{as:"h1",size:"3xl",weight:"bold",children:"dashboard"===I?"Dashboard":"state"===I&&T?T.name:"Employee Details"}),ew&&(0,a.jsx)(m.E,{variant:eb?"secondary":"default",className:"text-xs",children:eb?"Manager View":"Admin View"})]}),(0,a.jsx)(v.EY,{tone:"muted",children:"dashboard"===I?eb?"Overview of your team's activities and performance.":"Overview of sales and employee activities.":T?"Details for ".concat(T.name):"Deep dive into employee performance."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:["dashboard"!==I&&(0,a.jsxs)(d.$,{variant:"outline",onClick:eJ,className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),"Back"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(u.l6,{value:b,onValueChange:e=>{N(e),"custom"===e?C(!0):(C(!1),E(void 0),D(void 0))},children:[(0,a.jsx)(u.bq,{className:"w-[180px]",children:(0,a.jsx)(u.yv,{placeholder:"Select date range"})}),(0,a.jsx)(u.gC,{children:ei.map(e=>(0,a.jsx)(u.eb,{value:e.value,children:e.label},e.value))})]}),A&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(W.AM,{open:L,onOpenChange:P,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),k?(0,o.GP)(k,"MMM dd, yyyy"):"Start date"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(et.R,{mode:"single",selected:k,onSelect:e=>{E(e),P(!1)},disabled:e=>e>new Date||e<new Date("1900-01-01")||!!M&&e>M,initialFocus:!0})})]}),(0,a.jsxs)(W.AM,{open:_,onOpenChange:z,children:[(0,a.jsx)(W.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),M?(0,o.GP)(M,"MMM dd, yyyy"):"End date"]})}),(0,a.jsx)(W.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(et.R,{mode:"single",selected:M,onSelect:e=>{D(e),z(!1)},disabled:e=>e>new Date||e<new Date("1900-01-01")||!!k&&e<k,initialFocus:!0})})]}),(0,a.jsx)(d.$,{onClick:()=>{k&&M&&(C(!1),eC(!0))},disabled:!k||!M,size:"sm",children:"Apply"})]}),eA&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Loading..."})]})]})]})]}),!ew||eM?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Total Visits"}),(0,a.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(G.E,{className:"h-8 w-16"}),(0,a.jsx)(G.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Active Employees"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(G.E,{className:"h-8 w-16"}),(0,a.jsx)(G.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(c.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(G.E,{className:"h-8 w-16"}),(0,a.jsx)(G.E,{className:"h-4 w-24 mt-2"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(G.E,{className:"h-8 w-64"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(G.E,{className:"h-6 w-20"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsx)(G.E,{className:"h-8 w-12"}),(0,a.jsx)(G.E,{className:"h-4 w-32 mt-2"})]})]},t))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(G.E,{className:"h-8 w-64"}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(c.Zp,{className:"h-[600px] overflow-hidden rounded-xl",children:(0,a.jsx)(G.E,{className:"h-full w-full"})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(c.Zp,{className:"flex h-[600px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsx)(c.aR,{className:"border-b",children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsx)(G.E,{className:"h-6 w-12 ml-auto"})]})}),(0,a.jsx)(c.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"w-full p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(G.E,{className:"h-10 w-10 rounded-xl"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(G.E,{className:"h-4 w-24"}),(0,a.jsx)(G.E,{className:"h-3 w-16 mt-1"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)(G.E,{className:"h-3 w-16"}),(0,a.jsx)(G.E,{className:"h-3 w-20 mt-1"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)(G.E,{className:"h-5 w-16"}),(0,a.jsx)(G.E,{className:"h-5 w-20"})]})]},t))})})]})})]})]})]}):(0,a.jsxs)(a.Fragment,{children:["dashboard"===I&&(0,a.jsx)(w,{kpis:em,states:ed,onStateSelect:eY,markers:ep,highlightedEmployee:$,selectedEmployeeMarkers:ef,onResetView:()=>{U(ea),Y(5),H(null),ey([]),eP(!1)},mapCenter:F,mapZoom:J,onMarkerClick:eH,onEmployeeSelect:e$,employeeList:eF,showVisitLocations:eL,onShowVisitLocations:eq}),"state"===I&&T&&(0,a.jsx)(S,{selectedState:T,stateEmployees:eU,onEmployeeDetailSelect:eK}),"employeeDetail"===I&&R&&(0,a.jsx)(K,{employee:R,dateRange:eB})]}),(0,a.jsx)(ee,{open:e_,onOpenChange:e=>{e?ez(!0):eV()},onCreateSuccess:eV})]})}},67812:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var a=s(95155);s(12115);var l=s(32467),n=s(83101),r=s(25016);let i=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,asChild:n=!1,...o}=e,d=n?l.DX:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,r.cn)(i({variant:s}),t),...o})}},67909:(e,t,s)=>{"use strict";s.d(t,{default:()=>l.a});var a=s(86278),l=s.n(a)},68122:(e,t,s)=>{"use strict";s.d(t,{E:()=>n});var a=s(95155),l=s(25016);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,l.cn)("bg-accent animate-pulse rounded-md",t),...s})}},71871:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},86278:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let a=s(28140)._(s(1150));function l(e,t){var s;let l={};"function"==typeof e&&(l.loader=e);let n={...l,...t};return(0,a.default)({...n,modules:null==(s=n.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>r});var a=s(95155);s(12115);var l=s(10489),n=s(25016);function r(e){let{className:t,...s}=e;return(0,a.jsx)(l.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}},91169:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},91585:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var a=s(95155),l=s(83209),n=s(21873),r=s(26983),i=s(20508),o=s(71163);function d(e){let{employee:t,onClick:s}=e;return(0,a.jsx)(l.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:s,children:(0,a.jsxs)(l.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-10 h-10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.position})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:t.location})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(r.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Last updated: ",(0,o.GP)(new Date(t.lastUpdated),"h:mm a")]})]}),void 0!==t.totalVisits&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(i.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Visits: ",t.totalVisits]})]})]})]})})}},97450:(e,t,s)=>{"use strict";s.d(t,{AM:()=>r,Wv:()=>i,hl:()=>o});var a=s(95155);s(12115);var l=s(82286),n=s(25016);function r(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"popover",...t})}function i(e){let{...t}=e;return(0,a.jsx)(l.l9,{"data-slot":"popover-trigger",...t})}function o(e){let{className:t,align:s="center",sideOffset:r=4,...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsx)(l.UC,{"data-slot":"popover-content",align:s,sideOffset:r,className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...i})})}}},e=>{e.O(0,[9358,9,1052,1691,7715,9140,9687,8131,8441,1255,7358],()=>e(e.s=59845)),_N_E=e.O()}]);