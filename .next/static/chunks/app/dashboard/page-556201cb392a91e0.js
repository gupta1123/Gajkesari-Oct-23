(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105,9480],{1150:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let a=s(95155),r=s(12115),l=s(24437);function n(e){return{default:e&&"default"in e?e.default:e}}s(36552);let i={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},s=(0,r.lazy)(()=>t.loader().then(n)),o=t.loading;function c(e){let n=o?(0,a.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?r.Suspense:r.Fragment,d=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(s,{...e})]}):(0,a.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(s,{...e})});return(0,a.jsx)(c,{...i?{fallback:n}:{},children:d})}return c.displayName="LoadableComponent",c}},8567:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=s(17828)},17828:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,s(64054).createAsyncLocalStorage)()},20508:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21873:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},24437:(e,t,s)=>{"use strict";function a(e){let{reason:t,children:s}=e;return s}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),s(24553)},26983:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(95155);s(12115);var r=s(25016);function l(e){let{className:t,type:s,...l}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},35299:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},35626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},36552:(e,t,s)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),s(95155),s(47650),s(8567),s(77278)},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>h,gC:()=>m,l6:()=>c,yv:()=>d});var a=s(95155);s(12115);var r=s(98229),l=s(24033),n=s(5917),i=s(12108),o=s(25016);function c(e){let{...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"select",...t})}function d(e){let{...t}=e;return(0,a.jsx)(r.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:s="default",children:n,...i}=e;return(0,a.jsxs)(r.l9,{"data-slot":"select-trigger","data-size":s,className:(0,o.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[n,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(l.A,{className:"size-4 opacity-50"})})]})}function m(e){let{className:t,children:s,position:l="popper",...n}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{"data-slot":"select-content",className:(0,o.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,a.jsx)(p,{}),(0,a.jsx)(r.LM,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,a.jsx)(x,{})]})})}function h(e){let{className:t,children:s,...l}=e;return(0,a.jsxs)(r.q7,{"data-slot":"select-item",className:(0,o.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(n.A,{className:"size-4"})})}),(0,a.jsx)(r.p4,{children:s})]})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(r.PP,{"data-slot":"select-scroll-up-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(i.A,{className:"size-4"})})}function x(e){let{className:t,...s}=e;return(0,a.jsx)(r.wn,{"data-slot":"select-scroll-down-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(l.A,{className:"size-4"})})}},54679:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>h,L3:()=>p,ZJ:()=>c,c7:()=>m,lG:()=>i,rr:()=>x,zM:()=>o});var a=s(95155);s(12115);var r=s(89511),l=s(65229),n=s(25016);function i(e){let{...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,a.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function c(e){let{...t}=e;return(0,a.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function d(e){let{className:t,...s}=e;return(0,a.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function u(e){let{className:t,children:s,showCloseButton:i=!0,...o}=e;return(0,a.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,a.jsx)(d,{}),(0,a.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[s,i&&(0,a.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(l.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function h(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...s})}function x(e){let{className:t,...s}=e;return(0,a.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}},59845:(e,t,s)=>{Promise.resolve().then(s.bind(s,66728))},60028:(e,t,s)=>{"use strict";s.d(t,{R:()=>x});var a=s(3648),r=s(95155),l=s(12115),n=s(90368),i=s(27937),o=s(24033),c=s(74854),d=s(45704),u=s(25016),m=s(97003);function h(){let e=(0,a._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return h=function(){return e},e}function p(){let e=(0,a._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return p=function(){return e},e}function x(e){let{className:t,classNames:s,showOutsideDays:a=!0,captionLayout:l="label",buttonVariant:x="ghost",formatters:f,components:y,...j}=e,v=(0,c.a)();return(0,r.jsx)(d.h,{showOutsideDays:a,className:(0,u.cn)("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(h()),String.raw(p()),t),captionLayout:l,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...f},classNames:{root:(0,u.cn)("w-fit",v.root),months:(0,u.cn)("flex gap-4 flex-col md:flex-row relative",v.months),month:(0,u.cn)("flex flex-col w-full gap-4",v.month),nav:(0,u.cn)("flex items-center gap-2 w-full absolute top-0 inset-x-0 justify-between",v.nav),button_previous:(0,u.cn)((0,m.r)({variant:x}),"size-7 aria-disabled:opacity-50 p-0 select-none",v.button_previous),button_next:(0,u.cn)((0,m.r)({variant:x}),"size-7 aria-disabled:opacity-50 p-0 select-none",v.button_next),month_caption:(0,u.cn)("flex items-center justify-center h-7 w-full px-7",v.month_caption),dropdowns:(0,u.cn)("w-full flex items-center text-sm font-medium justify-center h-7 gap-2",v.dropdowns),dropdown_root:(0,u.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",v.dropdown_root),dropdown:(0,u.cn)("absolute bg-popover inset-0 opacity-0",v.dropdown),caption_label:(0,u.cn)("select-none font-medium","label"===l?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",v.caption_label),table:"w-full border-collapse",weekdays:(0,u.cn)("flex",v.weekdays),weekday:(0,u.cn)("text-muted-foreground rounded-md flex-1 font-normal text-xs select-none py-1",v.weekday),week:(0,u.cn)("flex w-full mt-1",v.week),week_number_header:(0,u.cn)("select-none w-7",v.week_number_header),week_number:(0,u.cn)("text-sm select-none text-muted-foreground",v.week_number),day:(0,u.cn)("relative w-full h-full p-0.5 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",v.day),range_start:(0,u.cn)("rounded-l-md bg-accent",v.range_start),range_middle:(0,u.cn)("rounded-none",v.range_middle),range_end:(0,u.cn)("rounded-r-md bg-accent",v.range_end),today:(0,u.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",v.today),outside:(0,u.cn)("text-muted-foreground aria-selected:text-muted-foreground",v.outside),disabled:(0,u.cn)("text-muted-foreground opacity-50",v.disabled),hidden:(0,u.cn)("invisible",v.hidden),...s},components:{Root:e=>{let{className:t,rootRef:s,...a}=e;return(0,r.jsx)("div",{"data-slot":"calendar",ref:s,className:(0,u.cn)(t),...a})},Chevron:e=>{let{className:t,orientation:s,...a}=e;return"left"===s?(0,r.jsx)(n.A,{className:(0,u.cn)("size-4",t),...a}):"right"===s?(0,r.jsx)(i.A,{className:(0,u.cn)("size-4",t),...a}):(0,r.jsx)(o.A,{className:(0,u.cn)("size-4",t),...a})},DayButton:g,WeekNumber:e=>{let{children:t,...s}=e;return(0,r.jsx)("td",{...s,children:(0,r.jsx)("div",{className:"flex size-7 items-center justify-center text-center",children:t})})},...y},...j})}function g(e){let{className:t,day:s,modifiers:a,...n}=e,i=(0,c.a)(),o=l.useRef(null);return l.useEffect(()=>{var e;a.focused&&(null==(e=o.current)||e.focus())},[a.focused]),(0,r.jsx)(m.$,{ref:o,variant:"ghost",size:"icon","data-day":s.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:(0,u.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-7 flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70 h-7 w-7 m-0.5",i.day,t),...n})}},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{bindSnapshot:function(){return n},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return i}});let s=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw s}getStore(){}run(){throw s}exit(){throw s}enterWith(){throw s}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return r?new r:new a}function n(e){return r?r.bind(e):a.bind(e)}function i(){return r?r.snapshot():function(e,...t){return e(...t)}}},66728:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ei});var a=s(95155),r=s(12115),l=s(79956),n=s(82192),i=s(78674),o=s(71163),c=s(97003),d=s(83209),u=s(67812),m=s(47507),h=s(35626),p=s(16485),x=s(35299),g=s(91169),f=s(21873),y=s(71871),j=s(67909),v=s(33789),b=s(73344),N=s(86651);let w=(0,j.default)(()=>Promise.all([s.e(4804),s.e(1761),s.e(9564)]).then(s.bind(s,79564)),{loadableGenerated:{webpack:()=>[79564]},ssr:!1}),k=e=>"number"!=typeof e||Number.isNaN(e)?"string"!=typeof e||""===e.trim()||Number.isNaN(Number(e))?null:Number(e):e;function S(e){var t,s;let{kpis:l,states:n,onStateSelect:i,markers:o,highlightedEmployee:m,selectedEmployeeMarkers:h,onResetView:x,mapCenter:j,mapZoom:S,onMarkerClick:E,onEmployeeSelect:M,employeeList:A,showVisitLocations:D,onShowVisitLocations:C}=e,[T,L]=(0,r.useState)(""),_=(0,r.useMemo)(()=>{if(!T.trim())return A;let e=T.toLowerCase().trim();return A.filter(t=>{let s=String(t.name||"").toLowerCase(),a=String(t.location||"").toLowerCase(),r=String(t.position||"").toLowerCase();return s.includes(e)||a.includes(e)||r.includes(e)})},[A,T]),P=null==m?null:null!=(s=null!=(t=k(m.id))?t:k(m.listId))?s:k(m.employeeId),z=null!=P?o.filter(e=>{var t;return(null!=(t=k(e.employeeId))?t:k(e.id))===P}):o,I=[...z,...h],R=h.filter(e=>"visit"===e.type).length;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Total Visits"}),(0,a.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(b.DZ,{as:"p",size:"2xl",weight:"bold",children:l.totalVisits})})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Active Employees"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(b.DZ,{as:"p",size:"2xl",weight:"bold",children:l.activeEmployees})})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(b.DZ,{as:"p",size:"2xl",weight:"bold",children:l.liveLocations})})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(b.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"State-wise Employee Distribution"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:n.map(e=>(0,a.jsxs)(d.Zp,{className:"cursor-pointer transition-shadow hover:shadow-md",onClick:()=>i(e),children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:e.name}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(b.DZ,{as:"p",size:"xl",weight:"bold",children:e.employeeCount}),(0,a.jsx)(b.EY,{size:"xs",tone:"muted",children:"Employees working"})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(b.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"Live Employee Locations"}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between gap-4 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsxs)(b.EY,{tone:"muted",children:["Click on an employee to zoom to their location",m&&(0,a.jsxs)("span",{className:"ml-2 text-sm font-medium text-primary",children:["• Showing ",z.length+h.length," locations",R>0&&(0,a.jsxs)("span",{className:"ml-1",children:["(",R," visits)"]})]})]})}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:x,children:"Reset View"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(d.Zp,{className:"h-[750px] overflow-hidden rounded-xl",children:(0,a.jsx)(w,{center:j,zoom:S,highlightedEmployee:m,markers:(console.log("=== LEAFLET MAP MARKERS DEBUG ==="),console.log("Filtered main markers:",z),console.log("Selected employee markers:",h),console.log("Combined markers for map:",I),I),onMarkerClick:E})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(d.Zp,{className:"flex h-[750px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsxs)(d.aR,{className:"border-b space-y-3",children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsxs)(u.E,{variant:"secondary",className:"ml-auto",children:[A.length," online"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(v.p,{type:"search",placeholder:"Search employees...",value:T,onChange:e=>L(e.target.value),className:"pl-10"})]})]}),(0,a.jsx)(d.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:0===_.length?(0,a.jsx)("div",{className:"p-8 text-center",children:(0,a.jsxs)(b.EY,{tone:"muted",children:['No employees found matching "',T,'"']})}):_.map(e=>(0,a.jsxs)("button",{type:"button",className:"w-full p-4 text-left transition-colors ".concat((null==m?void 0:m.listId)===e.listId?"border-l-4 border-primary bg-accent":"hover:bg-accent/50"),onClick:()=>M(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-xl border-2 border-dashed bg-muted"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-card bg-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(b.DZ,{as:"p",size:"md",className:"text-foreground",children:String(e.name)}),(0,a.jsx)(b.EY,{size:"sm",tone:"muted",children:String(e.position)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:String(e.location).split(",")[0]})]}),(0,a.jsx)(b.EY,{as:"div",size:"xs",tone:"muted",className:"mt-1",children:String(e.formattedLastUpdated)})]})]}),(0,a.jsx)("div",{className:"mt-3 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.E,{variant:"secondary",className:"text-xs capitalize",children:String(e.status)}),(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[String(e.visits)," visits"]})]})})]},String(e.listId)))})})]})})]})]})]})}var E=s(91585);function M(e){let{selectedState:t,stateEmployees:s,onEmployeeDetailSelect:r}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(b.DZ,{as:"h2",size:"2xl",weight:"bold",children:[t.name," - Employee Details"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>(0,a.jsx)(E.A,{employee:e,onClick:()=>r(e)},String(e.id)))})]})}var A=s(27937),D=s(12108),C=s(24033),T=s(90368),L=s(26265),_=s(24813),P=s(68425),z=s(47734),I=s(73697),R=s(99919),O=s(37665),G=s(50892),Z=s(26467),U=s(68122),B=s(20063),F=s(37621),V=s(90235);let W=e=>{let{title:t,value:s}=e;return(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(d.ZB,{className:"text-xs md:text-sm font-medium",children:t})}),(0,a.jsx)(d.Wu,{className:"pt-0",children:(0,a.jsx)("p",{className:"text-2xl md:text-4xl font-bold",children:s})})]})},J=e=>{let{data:t}=e;return(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-base md:text-lg text-white",children:"Visits by Purpose"})}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(L.u,{width:"100%",height:250,className:"md:hidden",children:(0,a.jsxs)(_.E,{data:t,children:[(0,a.jsx)(P.d,{strokeDasharray:"3 3",stroke:"rgba(255, 255, 255, 0.2)"}),(0,a.jsx)(z.W,{dataKey:"purpose",tick:{fontSize:10,fill:"white"}}),(0,a.jsx)(I.h,{tick:{fontSize:10,fill:"white"}}),(0,a.jsx)(R.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none",fontSize:"12px",color:"white"}}),(0,a.jsx)(O.s,{wrapperStyle:{color:"white",fontSize:"14px"}}),(0,a.jsx)(G.y,{dataKey:"visits",fill:"#1a202c"})]})}),(0,a.jsx)(L.u,{width:"100%",height:300,className:"hidden md:block",children:(0,a.jsxs)(_.E,{data:t,children:[(0,a.jsx)(P.d,{strokeDasharray:"3 3",stroke:"rgba(255, 255, 255, 0.2)"}),(0,a.jsx)(z.W,{dataKey:"purpose",tick:{fill:"white"}}),(0,a.jsx)(I.h,{tick:{fill:"white"}}),(0,a.jsx)(R.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none",color:"white"}}),(0,a.jsx)(O.s,{wrapperStyle:{color:"white",fontSize:"14px"}}),(0,a.jsx)(G.y,{dataKey:"visits",fill:"#1a202c"})]})})]})]})},$=e=>{let{visits:t,onViewDetails:s,currentPage:l,onPageChange:n}=e,[i,h]=(0,r.useState)("desc"),[p,x]=(0,r.useState)("date"),[g,y]=(0,r.useState)(null),[j,v]=(0,r.useState)(10),b=(0,r.useRef)(!1),N=e=>e.checkinTime&&e.checkoutTime?{emoji:"✅",status:"Completed"}:e.checkoutTime?{emoji:"⏱️",status:"Checked Out"}:e.checkinTime?{emoji:"\uD83D\uDD70️",status:"On Going"}:{emoji:"\uD83D\uDCC5",status:"Assigned"},w=e=>{e===p?h("asc"===i?"desc":"asc"):(x(e),h("desc")),y(e)},k=[...t].sort((e,t)=>{let s=e[p],a=t[p];return null==s?1:null==a?-1:"string"==typeof s&&"string"==typeof a?"asc"===i?s.localeCompare(a):a.localeCompare(s):s<a?"asc"===i?-1:1:s>a?"asc"===i?1:-1:0}).filter(e=>"Completed"===N(e).status),S=j>0?Math.ceil(k.length/j):0,E=0===S?1:S;(0,r.useEffect)(()=>{l>E&&E>0&&!b.current&&(b.current=!0,n(E)),l<=E&&(b.current=!1)},[l,E,n]);let M=(l-1)*j,L=M+j,_=k.slice(M,L);return(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(d.ZB,{className:"text-base md:text-lg",children:"Recent Completed Visits"})}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsxs)("div",{className:"md:hidden space-y-3",children:[_.map(e=>{let{emoji:t,status:r}=N(e);return(0,a.jsx)(d.Zp,{className:"border-l-4 border-l-primary",children:(0,a.jsxs)(d.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm truncate",children:e.customer}),(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[t," ",r]})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,o.GP)((0,Z.H)(e.date),"dd MMM ''yy")," • ",e.purpose]})]}),(0,a.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id),children:(0,a.jsx)(A.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"capitalize truncate max-w-[150px]",children:e.employeeState||"N/A"})]}),(0,a.jsx)(c.$,{variant:"link",className:"px-0 h-auto text-xs",onClick:()=>s(e.id),children:"View"})]})]})},e.id)}),0===_.length&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"No completed visits available"})]}),(0,a.jsx)("div",{className:"hidden md:block overflow-x-auto -mx-4 px-4 md:mx-0 md:px-0",children:(0,a.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("customer"),children:["Store","customer"===g&&("asc"===i?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(C.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("date"),children:["Date","date"===g&&("asc"===i?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(C.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("purpose"),children:["Purpose","purpose"===g&&("asc"===i?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(C.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>w("employeeState"),children:["City","employeeState"===g&&("asc"===i?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(C.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Status"}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[_.map(e=>{let{emoji:t,status:r}=N(e);return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.customer}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm whitespace-nowrap",children:(0,o.GP)((0,Z.H)(e.date),"dd MMM ''yy")}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.purpose}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm capitalize",children:e.employeeState||"N/A"}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs whitespace-nowrap",children:[t," ",r]})}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2",children:(0,a.jsx)("button",{className:"text-blue-500 hover:text-blue-700 text-xs md:text-sm",onClick:()=>s(e.id),children:"View"})})]},e.id)}),0===_.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm text-center",colSpan:6,children:"No visits available"})})]})]})})]}),k.length>0&&(0,a.jsxs)("div",{className:"mt-4 border-t pt-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(V.J,{htmlFor:"employee-detail-rows",className:"text-muted-foreground",children:"Rows per page:"}),(0,a.jsxs)(m.l6,{value:j.toString(),onValueChange:e=>{v(Number(e)),n(1)},children:[(0,a.jsx)(m.bq,{id:"employee-detail-rows",className:"w-[90px]",children:(0,a.jsx)(m.yv,{})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"10",children:"10"}),(0,a.jsx)(m.eb,{value:"25",children:"25"}),(0,a.jsx)(m.eb,{value:"50",children:"50"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>n(Math.max(1,l-1)),disabled:l<=1,children:[(0,a.jsx)(T.A,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",Math.min(l,E)," of ",E]}),(0,a.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>n(Math.min(E,l+1)),disabled:l>=E,children:["Next",(0,a.jsx)(A.A,{className:"h-4 w-4"})]})]})]})]})};function K(e){var t,s,l;let{employee:n,dateRange:i}=e,[c,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0),[p,x]=(0,r.useState)(null),[g,f]=(0,r.useState)(1),y=(0,B.useRouter)(),j="dashboard.employeeDetail.state.v1",v=(0,r.useRef)(!1),[b,N]=(0,r.useState)([]),[w,k]=(0,r.useState)(new Date),[S,E]=(0,r.useState)(new Date),[M,A]=(0,r.useState)(null),[D,C]=(0,r.useState)(new Date().getFullYear()),[T,L]=(0,r.useState)(new Date().getMonth()+1),[_,P]=(0,r.useState)([]),[z,I]=(0,r.useState)(new Date),[R,O]=(0,r.useState)(new Date),G=localStorage.getItem("authToken");(0,r.useEffect)(()=>{if(!v.current)try{let e=sessionStorage.getItem(j);if(!e){v.current=!0;return}let t=JSON.parse(e);if((null==t?void 0:t.employeeId)!==n.id){v.current=!0;return}let s=(0,o.GP)(i.start,"yyyy-MM-dd"),a=(0,o.GP)(i.end,"yyyy-MM-dd"),r="string"==typeof t.startKey?t.startKey:null,l="string"==typeof t.endKey?t.endKey:null,c="number"==typeof t.currentPage?t.currentPage:null;null!=c&&r===s&&l===a&&f(c),t.expenseStartDate&&"string"==typeof t.expenseStartDate&&k(new Date(t.expenseStartDate)),t.expenseEndDate&&"string"==typeof t.expenseEndDate&&E(new Date(t.expenseEndDate)),"number"==typeof t.selectedYear&&C(t.selectedYear),"number"==typeof t.selectedMonth&&L(t.selectedMonth),t.pricingStartDate&&"string"==typeof t.pricingStartDate&&I(new Date(t.pricingStartDate)),t.pricingEndDate&&"string"==typeof t.pricingEndDate&&O(new Date(t.pricingEndDate)),v.current=!0}catch(e){v.current=!0}},[n.id,i.start,i.end]),(0,r.useEffect)(()=>{try{sessionStorage.setItem(j,JSON.stringify({employeeId:n.id,currentPage:g,startKey:(0,o.GP)(i.start,"yyyy-MM-dd"),endKey:(0,o.GP)(i.end,"yyyy-MM-dd"),expenseStartDate:w,expenseEndDate:S,selectedYear:D,selectedMonth:T,pricingStartDate:z,pricingEndDate:R}))}catch(e){}},[n.id,g,i.start,i.end,w,S,D,T,z,R]),(0,r.useEffect)(()=>{(async()=>{h(!0),x(null);try{let e=(0,o.GP)(i.start,"yyyy-MM-dd"),t=(0,o.GP)(i.end,"yyyy-MM-dd"),s=await F.n.getEmployeeStatsWithVisits(n.id,e,t);u(s)}catch(e){x((null==e?void 0:e.message)||"Failed to load employee details")}finally{h(!1)}})()},[n.id,i.start,i.end]),(0,r.useEffect)(()=>{(async()=>{if(G)try{let e=w?(0,o.GP)(w,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=S?(0,o.GP)(S,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/expense/getByEmployeeAndDate?start=".concat(e,"&end=").concat(t,"&id=").concat(n.id),{headers:{Authorization:"Bearer ".concat(G)}}),a=await s.json();N(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching expenses:",e)}})()},[G,n.id,w,S]),(0,r.useEffect)(()=>{(async()=>{if(G)try{let e="".concat(D,"-").concat(String(T).padStart(2,"0"),"-01"),t=await fetch("https://api.gajkesaristeels.in/attendance-log/monthlyVisits?date=".concat(e,"&employeeId=").concat(n.id),{headers:{Authorization:"Bearer ".concat(G)}}),s=await t.json();A(s)}catch(e){console.error("Error fetching attendance stats:",e)}})()},[G,n.id,D,T]),(0,r.useEffect)(()=>{(async()=>{if(G)try{let e=z?(0,o.GP)(z,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=R?(0,o.GP)(R,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/brand/getByDateRangeForEmployee?start=".concat(e,"&end=").concat(t,"&id=").concat(n.id),{headers:{Authorization:"Bearer ".concat(G)}}),a=await s.json();P(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching daily pricing:",e)}})()},[G,n.id,z,R]);let Z=(0,r.useMemo)(()=>c&&c.visitDto?Object.entries(c.visitDto.filter(e=>e.checkinTime&&e.checkoutTime).reduce((e,t)=>{let s=t.purpose?t.purpose.trim().toLowerCase():"unknown";return e[s]||(e[s]=0),e[s]++,e},{})).map(e=>{let[t,s]=e;return{purpose:t.charAt(0).toUpperCase()+t.slice(1),visits:Number(s)}}):[],[c]);if(p)return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded p-3",children:p})});if(m)return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(U.E,{className:"h-8 w-48"}),(0,a.jsx)(U.E,{className:"h-4 w-32 mt-2"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(U.E,{className:"h-4 w-28"})}),(0,a.jsx)(d.Wu,{className:"pt-0",children:(0,a.jsx)(U.E,{className:"h-8 w-16"})})]},t))}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(U.E,{className:"h-6 w-56"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 p-3 border rounded",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)(U.E,{className:"h-4 w-40"}),(0,a.jsx)(U.E,{className:"h-3 w-56 mt-2"})]}),(0,a.jsx)(U.E,{className:"h-5 w-16"})]},t))})})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsx)(d.aR,{children:(0,a.jsx)(U.E,{className:"h-6 w-40"})}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(U.E,{className:"h-64 w-full"})})]})]});let V=((null==c?void 0:c.visitDto)||[]).map(e=>({id:e.id,date:e.visit_date,customer:e.storeName,purpose:e.purpose||"—",status:"completed",duration:"-",checkinTime:e.checkinTime,checkoutTime:e.checkoutTime,employeeState:e.state})),K=V.filter(e=>e.checkinTime&&e.checkoutTime).length;return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold capitalize",children:n.name}),(0,a.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:n.position})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6 md:mb-8",children:[(0,a.jsx)(W,{title:"Total Completed Visits",value:K}),(0,a.jsx)(W,{title:"Full Days",value:(null==c||null==(t=c.statsDto)?void 0:t.fullDays)||0}),(0,a.jsx)(W,{title:"Half Days",value:(null==c||null==(s=c.statsDto)?void 0:s.halfDays)||0}),(0,a.jsx)(W,{title:"Absences",value:(null==c||null==(l=c.statsDto)?void 0:l.absences)||0})]}),(0,a.jsx)($,{visits:V,onViewDetails:e=>{try{sessionStorage.setItem("dashboard.view.state.v1",JSON.stringify({view:"employeeDetail",selectedEmployee:{id:n.id,name:n.name,position:n.position,avatar:n.avatar,location:n.location}}))}catch(e){}y.push("/dashboard/visits/".concat(e))},currentPage:g,onPageChange:f}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(J,{data:Z})}),(0,a.jsx)("div",{className:"mt-6 md:mt-8 space-y-3 md:space-y-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:b.map((e,t)=>(0,a.jsx)(d.Zp,{children:(0,a.jsxs)(d.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm font-medium",children:String(e.type||"N/A")}),(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:String(e.employeeName||"N/A")}),(0,a.jsxs)("div",{className:"mt-2 text-sm md:text-base",children:["Amount: ₹",Number(e.amount||0).toFixed(2)]}),(0,a.jsx)("div",{className:"text-xs md:text-sm",children:String(e.approvalStatus||"N/A")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.expenseDate&&"string"==typeof e.expenseDate?(0,o.GP)(new Date(e.expenseDate),"MMM d, yyyy"):""})]})},String(e.id)||t))})}),(0,a.jsx)("div",{className:"mt-8 space-y-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:_.map((e,t)=>(0,a.jsx)(d.Zp,{children:(0,a.jsxs)(d.Wu,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-medium",children:String(e.brandName||"N/A")}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:String(e.city||"N/A")})]}),(0,a.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:["₹",Number(e.price||0).toFixed(2)]})]})},String(e.id)||t))})})]})}function Y(e){let{employee:t,dateRange:s}=e;return(0,a.jsx)(K,{employee:t,dateRange:s})}var H=s(82466),q=s(54679);let X={brandName:"Gajkesari",price:"",city:""},Q=e=>{let{open:t,onOpenChange:s,onCreateSuccess:l}=e,{token:n,userData:i}=(0,H.A)(),[o,d]=(0,r.useState)(X),[u,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t||d(X)},[t]);let h=(0,r.useMemo)(()=>{var e;return null!=(e=null==i?void 0:i.employeeId)?e:86},[null==i?void 0:i.employeeId]),p=async()=>{if(n){m(!0);try{let e=Number(o.price);if(Number.isNaN(e))return void m(!1);let t={brandName:o.brandName.trim(),price:e,city:o.city.trim(),state:"",district:"",subDistrict:"",employeeDto:{id:h}};if(!(await fetch("https://api.gajkesaristeels.in/brand/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(t)})).ok)throw Error("API Error");null==l||l(),s(!1)}catch(e){console.error("Error creating pricing:",e)}finally{m(!1)}}};return(0,a.jsx)(q.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(q.Cf,{className:"sm:max-w-[425px] p-6",children:[(0,a.jsxs)(q.c7,{children:[(0,a.jsx)(q.L3,{children:"Set Today's Pricing"}),(0,a.jsx)(q.rr,{children:"No Gajkesari pricing was found for today. Please enter the latest details."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(V.J,{htmlFor:"brandName",children:"Name"}),(0,a.jsx)(v.p,{id:"brandName",value:o.brandName,onChange:e=>d(t=>({...t,brandName:e.target.value})),className:"col-span-3",placeholder:"Enter brand name"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(V.J,{htmlFor:"price",children:"Pricing"}),(0,a.jsx)(v.p,{id:"price",type:"number",value:o.price,onChange:e=>d(t=>({...t,price:e.target.value})),className:"col-span-3",placeholder:"Enter price"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(V.J,{htmlFor:"city",children:"City"}),(0,a.jsx)(v.p,{id:"city",value:o.city,onChange:e=>d(t=>({...t,city:e.target.value})),className:"col-span-3",placeholder:"Enter city"})]})]}),(0,a.jsxs)(q.Es,{className:"gap-2",children:[(0,a.jsx)(c.$,{variant:"outline",type:"button",onClick:()=>{s(!1)},children:"Close"}),(0,a.jsx)(c.$,{onClick:p,disabled:u||!o.brandName.trim()||!o.price.trim()||Number.isNaN(Number(o.price))||!o.city.trim(),type:"button",children:u?"Creating...":"Create"})]})]})})};var ee=s(97450),et=s(60028),es=s(68209);let ea=[22.5726,88.3639],er={Mumbai:[19.076,72.8777],Bangalore:[12.9716,77.5946],Chennai:[13.0827,80.2707],Hyderabad:[17.385,78.4867],Kolkata:[22.5726,88.3639],Delhi:[28.6139,77.209]},el=["bg-blue-500","bg-green-500","bg-yellow-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500"],en=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"thisWeek",label:"This Week"},{value:"thisMonth",label:"This Month"},{value:"custom",label:"Custom Range"}];function ei(){let{userRole:e,userData:t,currentUser:s,token:j}=(0,H.A)(),[v,N]=(0,r.useState)("today"),[w,k]=(0,r.useState)(void 0),[E,A]=(0,r.useState)(void 0),[D,C]=(0,r.useState)(!1),[T,L]=(0,r.useState)(!1),[_,P]=(0,r.useState)(!1),[z,I]=(0,r.useState)("dashboard"),[R,O]=(0,r.useState)(null),[G,Z]=(0,r.useState)(null),[B,V]=(0,r.useState)(ea),[W,J]=(0,r.useState)(5),[$,K]=(0,r.useState)(null),[q,X]=(0,r.useState)([]),[ei,eo]=(0,r.useState)([]),[ec,ed]=(0,r.useState)([]),[eu,em]=(0,r.useState)({totalVisits:0,activeEmployees:0,liveLocations:0}),[eh,ep]=(0,r.useState)(new Map),[ex,eg]=(0,r.useState)([]),[ef,ey]=(0,r.useState)([]),[ej,ev]=(0,r.useState)(null),[eb,eN]=(0,r.useState)(!1),[ew,ek]=(0,r.useState)(!1),[eS,eE]=(0,r.useState)(null),[eM,eA]=(0,r.useState)(!0),[eD,eC]=(0,r.useState)(!1),[eT,eL]=(0,r.useState)(!1),[e_,eP]=(0,r.useState)(!1),[ez,eI]=(0,r.useState)(!1),[eR,eO]=(0,r.useState)(!1),eG="dashboard.view.state.v1",eZ="pricingModalDismissed";(0,r.useEffect)(()=>{try{let e=sessionStorage.getItem(eG);if(e){let t=JSON.parse(e);(null==t?void 0:t.selectedState)&&O(t.selectedState),(null==t?void 0:t.view)==="employeeDetail"&&(null==t?void 0:t.selectedEmployee)?(Z(t.selectedEmployee),I("employeeDetail")):(null==t?void 0:t.view)==="state"&&(null==t?void 0:t.selectedState)&&I("state")}}catch(e){}(async()=>{if(j)try{let e=await fetch("https://api.gajkesaristeels.in/user/manage/current-user",{headers:{Authorization:"Bearer ".concat(j),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("Dashboard - Current user data:",t);let s=t.authorities||[],a=s.length>0?s[0].authority:null,r=(0,es.N4)(a);eN(r),eE(a),console.log("Dashboard - Role from API:",a),console.log("Dashboard - isManager:",r),console.log("Dashboard - currentUserRole set to:",a),ek(!0)}else console.error("Dashboard - Failed to fetch current user data"),eE(null),ek(!0)}catch(e){console.error("Dashboard - Error fetching current user:",e),eE(null),ek(!0)}})()},[j]),(0,r.useEffect)(()=>{eO("true"===sessionStorage.getItem(eZ))},[]);let eU=(0,r.useCallback)(()=>{eP(!1),eR||(eO(!0),sessionStorage.setItem(eZ,"true"))},[eR]);(0,r.useEffect)(()=>{if(console.log("Pricing check useEffect triggered:",{token:j?"present":"missing",isPricingDismissed:eR,hasCheckedPricing:ez,isRoleDetermined:ew,currentUserRole:eS}),!j||eR||ez||!ew)return;let e=(null!=eS?eS:"").toUpperCase(),t=e.includes("ADMIN");if(console.log("User role check:",{normalizedRole:e,isAdmin:t}),!t){console.log("User is not admin, skipping pricing check"),eI(!0);return}(async()=>{try{let e=new Date().toISOString().split("T")[0];console.log("Checking pricing for today:",e);let t=await fetch("https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(j)}});if(!t.ok){console.log("Pricing API response not ok:",t.status,t.statusText),eI(!0);return}let s=await t.json();console.log("Pricing API response data:",s);let a=s.some(e=>"string"==typeof e.brandName&&"gajkesari"===e.brandName.toLowerCase());console.log("Has Gajkesari pricing:",a),a?console.log("Gajkesari pricing found, not showing modal"):(console.log("No Gajkesari pricing found, showing modal"),eP(!0)),eI(!0)}catch(e){console.error("Dashboard - Error checking Gajkesari pricing:",e),eI(!0)}})()},[j,eS,eR,ez,ew]),(0,r.useEffect)(()=>{try{sessionStorage.setItem(eG,JSON.stringify({view:z,selectedState:R,selectedEmployee:G}))}catch(e){}},[z,R,G]),(0,r.useEffect)(()=>{let e=async()=>{if(eb&&(null==t?void 0:t.employeeId))try{let e=(await F.n.getTeamByEmployee(t.employeeId)).flatMap(e=>e.fieldOfficers.map(e=>e.id)),s=q.filter(t=>e.includes(t.id));eo(s)}catch(e){console.error("Failed to load team members:",e),ev("Failed to load team members")}};eb&&q.length>0&&e()},[eb,null==t?void 0:t.employeeId,q]),(0,r.useEffect)(()=>{(async()=>{if(ew)try{eA(!0);let e=(await F.n.getAllEmployees()||[]).map(e=>({id:e.id,name:[e.firstName,e.lastName].filter(Boolean).join(" ")||String(e.id),position:e.role||"Employee",avatar:"/placeholder.svg?height=40&width=40",lastUpdated:new Date().toISOString(),status:"active",location:[e.city,e.state].filter(Boolean).join(", ")}));X(e)}catch(e){ev((null==e?void 0:e.message)||"Failed to load employees")}finally{eA(!1)}})()},[ew]);let eB=(0,r.useMemo)(()=>eb&&ei.length>0?ei:q,[eb,ei,q]),eF=(0,r.useMemo)(()=>{let e=new Date;if("custom"===v&&w&&E)return{start:w,end:E};switch(v){case"today":default:return{start:e,end:e};case"yesterday":{let t=(0,l.e)(e,1);return{start:t,end:t}}case"thisWeek":return{start:(0,n.k)(e),end:e};case"thisMonth":return{start:(0,i.w)(e),end:e}}},[v,w,E]);(0,r.useEffect)(()=>{(async()=>{if(ew)try{eC(!0);let e=(0,o.GP)(eF.start,"yyyy-MM-dd"),t=(0,o.GP)(eF.end,"yyyy-MM-dd"),s=await F.n.getReportCounts(e,t),a=eb?s.filter(e=>eB.some(t=>t.id===e.employeeId)):s,r=(a||[]).reduce((e,t)=>{var s,a;return e+(null!=(a=null==(s=t.statsDto)?void 0:s.visitCount)?a:0)},0),l=(a||[]).filter(e=>{var t,s;return(null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)>0}).length,n=new Map;a.forEach(e=>{var t,s;return n.set(e.employeeId,null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)}),ep(n),em(e=>({...e,totalVisits:r,activeEmployees:l}))}catch(e){console.error("Error fetching KPIs:",e)}finally{eC(!1)}})()},[eF.start,eF.end,eb,eB,ew]),(0,r.useEffect)(()=>{let e=!1;return(async()=>{if(ew)try{let t=await F.n.getAllEmployeeLocations(),s=[];t.forEach(e=>{if(null!=e.latitude&&null!=e.longitude&&0!==e.latitude&&0!==e.longitude&&0!==e.latitude&&0!==e.longitude){let t=!0;if(eb&&(t=ei.some(t=>t.id===e.empId)),!t)return void console.log("Skipping employee ".concat(e.empName," (ID: ").concat(e.empId,") - not in team"));let a=String(e.updatedTime).split(".")[0],r=new Date("".concat(e.updatedAt,"T").concat(a)),l=r.toISOString().split("T")[0],n=eF.start.toISOString().split("T")[0],i=eF.end.toISOString().split("T")[0];console.log("Location date check for ".concat(e.empName,":"),{locationDate:l,startDateStr:n,endDateStr:i,inRange:l>=n&&l<=i}),l>=n&&l<=i&&s.push({id:e.empId,name:e.empName,lat:e.latitude,lng:e.longitude,subtitle:"".concat((0,o.GP)(r,"dd MMM ''yy")," ").concat(a).trim(),type:"live",employeeId:e.empId,tooltipLines:["Employee: ".concat(e.empName),"Last updated: ".concat((0,o.GP)(r,"dd MMM ''yy, hh:mm a"))]})}}),e||(s.sort((e,t)=>(e.name||"").localeCompare(t.name||"")),eg(s))}catch(t){e||eg([])}})(),()=>{e=!0}},[eb,ei,ew,eF.start,eF.end]),(0,r.useEffect)(()=>{em(e=>({...e,liveLocations:ex.length}))},[ex.length]),(0,r.useEffect)(()=>{if(!q.length)return;let e=new Map;q.forEach(t=>{var s;let a=null!=(s=eh.get(t.id))?s:0,r=t.location.split(", ")[1]||"Unknown";a>0&&e.set(r,(e.get(r)||0)+1)}),ed(Array.from(e.entries()).map((e,t)=>{let[s,a]=e;return{id:t+1,name:s,employeeCount:a,color:el[t%el.length]}}))},[q,eh]);let eV=(0,r.useMemo)(()=>{let e=new Map;ex.forEach(t=>{e.set(Number(t.id),{lat:t.lat,lng:t.lng,subtitle:t.subtitle})});let t=eB.filter(t=>e.has(t.id)).map(t=>{var s,a;return{...t,listId:String(t.id),visits:null!=(a=eh.get(t.id))?a:0,formattedLastUpdated:(null==(s=e.get(t.id))?void 0:s.subtitle)||""}});return t.sort((e,t)=>e.name.localeCompare(t.name)),t},[eB,eh,ex]),eW=(0,r.useMemo)(()=>R?eB.filter(e=>{var t;return e.location.includes(R.name)&&(null!=(t=eh.get(e.id))?t:0)>0}):[],[R,eB,eh]),eJ=(0,r.useCallback)(()=>{if("employeeDetail"===z){I("state"),Z(null);return}"state"===z&&(I("dashboard"),O(null),K(null),V(ea),J(5))},[z]),e$=(0,r.useCallback)(e=>{e&&(O({id:e.id,name:e.name,employeeCount:e.employeeCount,color:e.color||el[0]}),I("state"))},[]),eK=(0,r.useCallback)(async e=>{console.log("=== EMPLOYEE SELECTION (AUTO-JOURNEY) ==="),console.log("Selected employee:",e);let t=ex.find(t=>Number(t.id)===e.id);ey([]),K(e),eL(!0);try{var s;let a=await F.n.getEmployeeById(e.id),r=[];if(a&&null!=a.houseLatitude&&null!=a.houseLongitude&&!isNaN(Number(a.houseLatitude))&&!isNaN(Number(a.houseLongitude))){let t=Number(a.houseLatitude),s=Number(a.houseLongitude);if(0!==t&&0!==s&&0!==t&&0!==s){let l=[a.city,a.state,a.country].filter(Boolean).join(", ");r.push({id:"house-".concat(a.id),name:"".concat(e.name,"'s Home"),lat:t,lng:s,subtitle:l,type:"house",employeeId:a.id,tooltipLines:[]})}}let l=(0,o.GP)(eF.start,"yyyy-MM-dd"),n=(0,o.GP)(eF.end,"yyyy-MM-dd"),i=await F.n.getEmployeeStatsByDateRange(e.id,l,n),c=null!=(s=null==i?void 0:i.visitDto)?s:[],d=(e,t)=>{if(!e)return"Not available";let s=t?t.split(".")[0]:null,a=s&&8===s.length?s:s?"".concat(s):"00:00:00",r=new Date("".concat(e,"T").concat(null!=a?a:"00:00:00"));return Number.isNaN(r.getTime())?e:(0,o.GP)(r,"dd MMM yyyy, hh:mm a")},u=[];[...c].sort((e,t)=>{let s=e.checkinDate||e.visit_date||e.createdAt||"",a=(e.checkinTime||e.createdTime||"00:00:00").split(".")[0],r=t.checkinDate||t.visit_date||t.createdAt||"",l=(t.checkinTime||t.createdTime||"00:00:00").split(".")[0],n=new Date("".concat(s,"T").concat(a||"00:00:00")),i=new Date("".concat(r,"T").concat(l||"00:00:00"));return n.getTime()-i.getTime()}).forEach((t,s)=>{var a,r,l,n;let i=null!=(r=null!=(a=t.checkinLatitude)?a:t.visitLatitude)?r:t.storeLatitude,o=null!=(n=null!=(l=t.checkinLongitude)?l:t.visitLongitude)?n:t.storeLongitude;if(null==i||null==o||0===i||0===o||0===i||0===o)return;let c=d(t.checkinDate,t.checkinTime),m=t.checkoutDate||t.checkoutTime?d(t.checkoutDate,t.checkoutTime):"Not recorded",h=[t.city,t.state,t.country].filter(Boolean).join(", ");u.push({id:"visit-".concat(t.id),name:t.storeName||"Visit",lat:Number(i),lng:Number(o),subtitle:"".concat(t.storeName||"Visit"," - ").concat(t.purpose||"Visit"),type:"visit",employeeId:t.employeeId,order:s+1,tooltipLines:["Store: ".concat(t.storeName||"N/A"),"Employee: ".concat(t.employeeName||e.name),"Check-in: ".concat(c),"Check-out: ".concat(m),...h?["Address: ".concat(h)]:[]]})});let m=[...r,...u];ey(m);let h=[...m];if(t&&h.push(t),h.length>0){let e=h.map(e=>e.lat),t=h.map(e=>e.lng),s=Math.min(...e),a=Math.max(...e),r=Math.min(...t),l=Math.max(...t),n=Math.max(a-s,l-r),i=11;i=n>1?8:n>.5?9:n>.1?10:12,V([(s+a)/2,(r+l)/2]),J(i)}else if(t)V([t.lat,t.lng]),J(13);else{let t=(e=>{let t=Object.entries(er).find(t=>{let[s]=t;return e.includes(s)});return t?t[1]:ea})(e.location);V(t),J(10)}}catch(e){console.error("Failed to load employee journey:",e)}},[ex,eF.start,eF.end]),eY=(0,r.useCallback)(e=>{Z(e),I("employeeDetail")},[]),eH=(0,r.useCallback)(async()=>{if($)try{var e;let t=(0,o.GP)(eF.start,"yyyy-MM-dd"),s=(0,o.GP)(eF.end,"yyyy-MM-dd");console.log("=== VISIT LOCATIONS DEBUG ==="),console.log("Fetching visit stats for employee:",$.id),console.log("Date range:",{start:t,end:s});let a=await F.n.getEmployeeStatsByDateRange($.id,t,s);console.log("Visit stats response:",a);let r=[],l=(e,t)=>{if(!e)return"Not available";let s=t?t.split(".")[0]:null,a=s&&8===s.length?s:s?"".concat(s):"00:00:00",r=new Date("".concat(e,"T").concat(null!=a?a:"00:00:00"));return Number.isNaN(r.getTime())?e:(0,o.GP)(r,"dd MMM yyyy, hh:mm a")},n=null!=(e=null==a?void 0:a.visitDto)?e:[];console.log("Processing visits:",n.length,"visits found"),n.forEach((e,t)=>{var s,a,n,i;let o=null!=(a=null!=(s=e.checkinLatitude)?s:e.visitLatitude)?a:e.storeLatitude,c=null!=(i=null!=(n=e.checkinLongitude)?n:e.visitLongitude)?i:e.storeLongitude;if(console.log("Visit ".concat(t+1,":"),{visitId:e.id,storeName:e.storeName,checkinLat:e.checkinLatitude,checkinLng:e.checkinLongitude,visitLat:e.visitLatitude,visitLng:e.visitLongitude,storeLat:e.storeLatitude,storeLng:e.storeLongitude,finalLat:o,finalLng:c}),null==o||null==c||0===o||0===c||0===o||0===c)return void console.log("Visit ".concat(t+1," skipped: No valid coordinates"),{lat:o,lng:c,storeName:e.storeName});let d=l(e.checkinDate,e.checkinTime),u=e.checkoutDate||e.checkoutTime?l(e.checkoutDate,e.checkoutTime):"Not recorded",m=[e.city,e.state,e.country].filter(Boolean).join(", "),h=["Store: ".concat(e.storeName||"N/A"),"Employee: ".concat(e.employeeName||$.name),"Check-in: ".concat(d),"Check-out: ".concat(u),e.purpose?"Purpose: ".concat(e.purpose):null,m?"Address: ".concat(m):null].filter(Boolean),p={id:"visit-".concat(e.id),name:e.storeName||"Visit",lat:Number(o),lng:Number(c),subtitle:"".concat(e.storeName||"Visit"," - ").concat(e.purpose||"Visit"),type:"visit",employeeId:e.employeeId,tooltipLines:h};r.push(p),console.log("Added visit marker ".concat(t+1,":"),p)}),console.log("Total visit markers created:",r.length);let i=[...ef,...r];console.log("Updated markers (existing + visits):",i),ey(i),eL(!0);let c=ex.find(e=>Number(e.id)===$.id),d=[...i];if(c&&d.push(c),d.length>0){let e=d.map(e=>e.lat),t=d.map(e=>e.lng),s=Math.min(...e),a=Math.max(...e),r=Math.min(...t),l=Math.max(...t),n=Math.max(a-s,l-r),i=11;i=n>1?8:n>.5?9:n>.1?10:12,V([(s+a)/2,(r+l)/2]),J(i)}}catch(e){console.error("Failed to load visit locations:",e)}},[$,eF.start,eF.end,ex,ef]),eq=(0,r.useCallback)(async e=>{if("live"===e.type){let t=Number(e.id),s=eV.find(e=>e.id===t);s&&await eK(s)}},[eV,eK]);return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(b.DZ,{as:"h1",size:"3xl",weight:"bold",children:"dashboard"===z?"Dashboard":"state"===z&&R?R.name:"Employee Details"}),ew&&(0,a.jsx)(u.E,{variant:eb?"secondary":"default",className:"text-xs",children:eb?"Manager View":"Admin View"})]}),(0,a.jsx)(b.EY,{tone:"muted",children:"dashboard"===z?eb?"Overview of your team's activities and performance.":"Overview of sales and employee activities.":R?"Details for ".concat(R.name):"Deep dive into employee performance."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:["dashboard"!==z&&(0,a.jsxs)(c.$,{variant:"outline",onClick:eJ,className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Back"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(m.l6,{value:v,onValueChange:e=>{N(e),"custom"===e?C(!0):(C(!1),k(void 0),A(void 0))},children:[(0,a.jsx)(m.bq,{className:"w-[180px]",children:(0,a.jsx)(m.yv,{placeholder:"Select date range"})}),(0,a.jsx)(m.gC,{children:en.map(e=>(0,a.jsx)(m.eb,{value:e.value,children:e.label},e.value))})]}),D&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(ee.AM,{open:T,onOpenChange:L,children:[(0,a.jsx)(ee.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),w?(0,o.GP)(w,"MMM dd, yyyy"):"Start date"]})}),(0,a.jsx)(ee.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(et.R,{mode:"single",selected:w,onSelect:e=>{k(e),L(!1)},disabled:e=>e>new Date||e<new Date("1900-01-01")||!!E&&e>E,initialFocus:!0})})]}),(0,a.jsxs)(ee.AM,{open:_,onOpenChange:P,children:[(0,a.jsx)(ee.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),E?(0,o.GP)(E,"MMM dd, yyyy"):"End date"]})}),(0,a.jsx)(ee.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(et.R,{mode:"single",selected:E,onSelect:e=>{A(e),P(!1)},disabled:e=>e>new Date||e<new Date("1900-01-01")||!!w&&e<w,initialFocus:!0})})]}),(0,a.jsx)(c.$,{onClick:()=>{w&&E&&(C(!1),eC(!0))},disabled:!w||!E,size:"sm",children:"Apply"})]}),eD&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Loading..."})]})]})]})]}),!ew||eM?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Total Visits"}),(0,a.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(U.E,{className:"h-8 w-16"}),(0,a.jsx)(U.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Active Employees"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(U.E,{className:"h-8 w-16"}),(0,a.jsx)(U.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(d.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(U.E,{className:"h-8 w-16"}),(0,a.jsx)(U.E,{className:"h-4 w-24 mt-2"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(U.E,{className:"h-8 w-64"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(U.E,{className:"h-6 w-20"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(d.Wu,{children:[(0,a.jsx)(U.E,{className:"h-8 w-12"}),(0,a.jsx)(U.E,{className:"h-4 w-32 mt-2"})]})]},t))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(U.E,{className:"h-8 w-64"}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(d.Zp,{className:"h-[600px] overflow-hidden rounded-xl",children:(0,a.jsx)(U.E,{className:"h-full w-full"})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(d.Zp,{className:"flex h-[600px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsx)(d.aR,{className:"border-b",children:(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsx)(U.E,{className:"h-6 w-12 ml-auto"})]})}),(0,a.jsx)(d.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"w-full p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(U.E,{className:"h-10 w-10 rounded-xl"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(U.E,{className:"h-4 w-24"}),(0,a.jsx)(U.E,{className:"h-3 w-16 mt-1"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)(U.E,{className:"h-3 w-16"}),(0,a.jsx)(U.E,{className:"h-3 w-20 mt-1"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)(U.E,{className:"h-5 w-16"}),(0,a.jsx)(U.E,{className:"h-5 w-20"})]})]},t))})})]})})]})]})]}):(0,a.jsxs)(a.Fragment,{children:["dashboard"===z&&(0,a.jsx)(S,{kpis:eu,states:ec,onStateSelect:e$,markers:ex,highlightedEmployee:$,selectedEmployeeMarkers:ef,onResetView:()=>{V(ea),J(5),K(null),ey([]),eL(!1)},mapCenter:B,mapZoom:W,onMarkerClick:eq,onEmployeeSelect:eK,employeeList:eV,showVisitLocations:eT,onShowVisitLocations:eH}),"state"===z&&R&&(0,a.jsx)(M,{selectedState:R,stateEmployees:eW,onEmployeeDetailSelect:eY}),"employeeDetail"===z&&G&&(0,a.jsx)(Y,{employee:G,dateRange:eF})]}),(0,a.jsx)(Q,{open:e_,onOpenChange:e=>{e?eP(!0):eU()},onCreateSuccess:eU})]})}},67812:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var a=s(95155);s(12115);var r=s(32467),l=s(83101),n=s(25016);let i=(0,l.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,asChild:l=!1,...o}=e,c=l?r.DX:"span";return(0,a.jsx)(c,{"data-slot":"badge",className:(0,n.cn)(i({variant:s}),t),...o})}},67909:(e,t,s)=>{"use strict";s.d(t,{default:()=>r.a});var a=s(86278),r=s.n(a)},68122:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var a=s(95155),r=s(25016);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...s})}},68209:(e,t,s)=>{"use strict";s.d(t,{N4:()=>c,Xb:()=>o,co:()=>d,y1:()=>m});let a="https://api.gajkesaristeels.in",r="".concat(a,"/user/token"),l="".concat(a,"/user/logout"),n="".concat(a,"/user/manage/get"),i="".concat(a,"/user/manage/current-user"),o=e=>e?e.trim().replace(/\s+/g," ").toUpperCase():null,c=e=>{let t=o(e);return"MANAGER"===t||"ROLE MANAGER"===t||"ROLE_MANAGER"===t||"OFFICE MANAGER"===t||"OFFICE_MANAGER"===t||"ROLE OFFICE MANAGER"===t||"ROLE_OFFICE MANAGER"===t||"ROLE_OFFICE_MANAGER"===t},d=(e,t)=>{var s;return!!c(e)||(null!=(s=null==t?void 0:t.authorities)?s:[]).some(e=>c(e.authority))},u={getToken:()=>localStorage.getItem("authToken"),setToken:e=>{{localStorage.setItem("authToken",e);let t="localhost"===window.location.hostname?"authToken=".concat(e,"; path=/; max-age=86400; samesite=strict"):"authToken=".concat(e,"; path=/; max-age=86400; secure; samesite=strict");document.cookie=t}},removeToken:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("currentUser"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getAuthHeader:()=>{let e=u.getToken();return e?"Bearer ".concat(e):null},setUserRole:e=>{localStorage.setItem("userRole",e.roles),localStorage.setItem("userData",JSON.stringify(e))},getUserRole:()=>localStorage.getItem("userRole"),getUserData:()=>{{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}},setCurrentUser:e=>{localStorage.setItem("currentUser",JSON.stringify(e))},getCurrentUser:()=>{{let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}}},m={login:async e=>{try{let t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Login failed: ".concat(t.status," ").concat(e))}let s=await t.text(),{role:a,token:l}=(e=>{let t=e.trim();if(!t)throw Error("Empty response received from login endpoint");try{let e=JSON.parse(t);if("string"==typeof e.token){var s;return{token:e.token.trim(),role:null!=(s=e.role)?s:"USER"}}}catch(e){}let a=t.split(/\s+/);if(a.length<2)throw Error('Unexpected login response: "'.concat(t,'"'));let r=a[0],l=a[a.length-1];if("bearer"===l.toLowerCase()&&a.length>=3&&(l=a[a.length-1]),!(l=l.replace(/^"(.*)"$/,"$1")).includes("."))throw Error('Parsed token looks invalid: "'.concat(l,'"'));return{token:l,role:r||"USER"}})(s);u.setToken(l);try{console.log("Fetching role for username:",e.username),console.log("Raw token response:",s),console.log("Token being used:",l);let t=await fetch("".concat(n,"?username=").concat(e.username),{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(l),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();u.setUserRole(e),console.log("User role data stored:",e)}else{console.warn("Failed to fetch user role data:",t.status,t.statusText);let e=await t.text();console.warn("Error response:",e)}}catch(e){console.warn("Error fetching user role data:",e)}try{let e=await fetch(i,{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(l),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();u.setCurrentUser(t),console.log("Current user data stored:",t)}else console.warn("Failed to fetch current user data:",e.status)}catch(e){console.warn("Error fetching current user data:",e)}return{token:l,role:a||"USER"}}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{let e=u.getToken();if(!e)return void u.removeToken();let t=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});u.removeToken(),t.ok||console.warn("Logout request failed, but token was cleared locally")}catch(e){console.error("Logout error:",e),u.removeToken()}},isAuthenticated:()=>!!u.getToken(),getStoredToken:()=>u.getToken(),getUserRole:()=>u.getUserRole(),getUserData:()=>u.getUserData(),getCurrentUser:()=>u.getCurrentUser()}},71871:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},82466:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>o});var a=s(95155),r=s(12115),l=s(68209),n=s(20063);let i=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null),[x,g]=(0,r.useState)(null),[f,y]=(0,r.useState)(null),j=(0,r.useRef)(null),v=(0,n.useRouter)(),b=e=>{if(!e)return null;let t=e.split(".");if(t.length<2)return null;try{let e=t[1].replace(/-/g,"+").replace(/_/g,"/");if("function"!=typeof atob)return null;let s=atob(e),a=JSON.parse(s);if("number"==typeof a.exp)return a.exp;return null}catch(e){return null}};(0,r.useEffect)(()=>{let e=l.y1.getStoredToken(),t=l.y1.getUserRole(),s=l.y1.getUserData(),a=l.y1.getCurrentUser();if(e){let r=b(e),n=Math.floor(Date.now()/1e3);r&&r<=n?l.y1.logout().finally(()=>{d(null),o(!1),p(null),g(null),y(null),v.replace("/login")}):(d(e),o(!0),p(t),g(s),y(a))}m(!1)},[]);let N=async(e,t)=>{m(!0);try{let s=await l.y1.login({username:e,password:t});d(s.token),o(!0);let a=l.y1.getUserRole(),r=l.y1.getUserData(),n=l.y1.getCurrentUser();p(a),g(r),y(n)}catch(e){throw e}finally{m(!1)}},w=async()=>{try{await l.y1.logout(),d(null),o(!1),p(null),g(null),y(null),sessionStorage.removeItem("pricingModalDismissed"),v.replace("/login")}catch(e){throw d(null),o(!1),p(null),g(null),sessionStorage.removeItem("pricingModalDismissed"),e}};return(0,r.useEffect)(()=>{if(j.current&&(clearTimeout(j.current),j.current=null),!c)return;let e=b(c);if(!e)return;let t=1e3*e-Date.now();return t<=0?void w():(j.current=setTimeout(()=>{w()},t),()=>{j.current&&(clearTimeout(j.current),j.current=null)})},[c]),(0,a.jsx)(i.Provider,{value:{isAuthenticated:s,token:c,login:N,logout:w,isLoading:u,userRole:h,userData:x,currentUser:f},children:t})}function c(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},86278:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let a=s(28140)._(s(1150));function r(e,t){var s;let r={};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,a.default)({...l,modules:null==(s=l.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},86651:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>n});var a=s(95155);s(12115);var r=s(10489),l=s(25016);function n(e){let{className:t,...s}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}},91169:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},91585:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(95155),r=s(83209),l=s(21873),n=s(26983),i=s(20508),o=s(71163);function c(e){let{employee:t,onClick:s}=e;return(0,a.jsx)(r.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:s,children:(0,a.jsxs)(r.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-10 h-10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.position})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(l.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:t.location})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Last updated: ",(0,o.GP)(new Date(t.lastUpdated),"h:mm a")]})]}),void 0!==t.totalVisits&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(i.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Visits: ",t.totalVisits]})]})]})]})})}},97450:(e,t,s)=>{"use strict";s.d(t,{AM:()=>n,Wv:()=>i,hl:()=>o});var a=s(95155);s(12115);var r=s(82286),l=s(25016);function n(e){let{...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"popover",...t})}function i(e){let{...t}=e;return(0,a.jsx)(r.l9,{"data-slot":"popover-trigger",...t})}function o(e){let{className:t,align:s="center",sideOffset:n=4,...i}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsx)(r.UC,{"data-slot":"popover-content",align:s,sideOffset:n,className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...i})})}}},e=>{e.O(0,[9358,9,1052,1691,7715,9140,9687,8441,1255,7358],()=>e(e.s=59845)),_N_E=e.O()}]);