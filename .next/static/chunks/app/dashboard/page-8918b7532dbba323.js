(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{1150:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let a=s(95155),l=s(12115),i=s(24437);function r(e){return{default:e&&"default"in e?e.default:e}}s(36552);let n={loader:()=>Promise.resolve(r(()=>null)),loading:null,ssr:!0},d=function(e){let t={...n,...e},s=(0,l.lazy)(()=>t.loader().then(r)),d=t.loading;function c(e){let r=d?(0,a.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,n=!t.ssr||!!t.loading,c=n?l.Suspense:l.Fragment,o=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(s,{...e})]}):(0,a.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(s,{...e})});return(0,a.jsx)(c,{...n?{fallback:r}:{},children:o})}return c.displayName="LoadableComponent",c}},8567:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=s(17828)},17828:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,s(64054).createAsyncLocalStorage)()},20508:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21873:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},24437:(e,t,s)=>{"use strict";function a(e){let{reason:t,children:s}=e;return s}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),s(24553)},36552:(e,t,s)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),s(95155),s(47650),s(8567),s(77278)},37772:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>m,eb:()=>u,gC:()=>x,l6:()=>c,yv:()=>o});var a=s(95155);s(12115);var l=s(98229),i=s(24033),r=s(5917),n=s(12108),d=s(25016);function c(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"select",...t})}function o(e){let{...t}=e;return(0,a.jsx)(l.WT,{"data-slot":"select-value",...t})}function m(e){let{className:t,size:s="default",children:r,...n}=e;return(0,a.jsxs)(l.l9,{"data-slot":"select-trigger","data-size":s,className:(0,d.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function x(e){let{className:t,children:s,position:i="popper",...r}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{"data-slot":"select-content",className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,a.jsx)(h,{}),(0,a.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,a.jsx)(p,{})]})})}function u(e){let{className:t,children:s,...i}=e;return(0,a.jsxs)(l.q7,{"data-slot":"select-item",className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(r.A,{className:"size-4"})})}),(0,a.jsx)(l.p4,{children:s})]})}function h(e){let{className:t,...s}=e;return(0,a.jsx)(l.PP,{"data-slot":"select-scroll-up-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(n.A,{className:"size-4"})})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(l.wn,{"data-slot":"select-scroll-down-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,a.jsx)(i.A,{className:"size-4"})})}},51631:(e,t,s)=>{"use strict";s.d(t,{Eb:()=>h,Iu:()=>m,M_:()=>y,WA:()=>p,cU:()=>x,dK:()=>o,n$:()=>u});var a=s(95155),l=s(12115),i=s(90368),r=s(27937),n=s(37772),d=s(25016),c=s(97003);let o=e=>{let{className:t,...s}=e;return(0,a.jsx)("nav",{role:"navigation","aria-label":"pagination",className:(0,d.cn)("mx-auto flex w-full justify-center",t),...s})};o.displayName="Pagination";let m=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("ul",{ref:t,className:(0,d.cn)("flex flex-row items-center gap-1",s),...l})});m.displayName="PaginationContent";let x=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("li",{ref:t,className:(0,d.cn)("",s),...l})});x.displayName="PaginationItem";let u=e=>{let{className:t,isActive:s,size:l="icon",...i}=e;return(0,a.jsx)("a",{"aria-current":s?"page":void 0,className:(0,d.cn)((0,c.r)({variant:s?"outline":"ghost",size:l}),t),...i})};u.displayName="PaginationLink";let h=e=>{let{className:t,...s}=e;return(0,a.jsxs)(u,{"aria-label":"Go to previous page",size:"default",className:(0,d.cn)("gap-1 pl-2.5",t),...s,children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Previous"})]})};h.displayName="PaginationPrevious";let p=e=>{let{className:t,...s}=e;return(0,a.jsxs)(u,{"aria-label":"Go to next page",size:"default",className:(0,d.cn)("gap-1 pr-2.5",t),...s,children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(r.A,{className:"h-4 w-4"})]})};p.displayName="PaginationNext";let y=e=>{let{className:t,...s}=e;return(0,a.jsxs)("span",{"aria-hidden":!0,className:(0,d.cn)("flex h-9 w-9 items-center justify-center",t),...s,children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"More pages"})]})};y.displayName="PaginationEllipsis"},59845:(e,t,s)=>{Promise.resolve().then(s.bind(s,90003))},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{bindSnapshot:function(){return r},createAsyncLocalStorage:function(){return i},createSnapshot:function(){return n}});let s=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw s}getStore(){}run(){throw s}exit(){throw s}enterWith(){throw s}static bind(e){return e}}let l="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function i(){return l?new l:new a}function r(e){return l?l.bind(e):a.bind(e)}function n(){return l?l.snapshot():function(e,...t){return e(...t)}}},67812:(e,t,s)=>{"use strict";s.d(t,{E:()=>d});var a=s(95155);s(12115);var l=s(32467),i=s(83101),r=s(25016);let n=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:s,asChild:i=!1,...d}=e,c=i?l.DX:"span";return(0,a.jsx)(c,{"data-slot":"badge",className:(0,r.cn)(n({variant:s}),t),...d})}},67909:(e,t,s)=>{"use strict";s.d(t,{default:()=>l.a});var a=s(86278),l=s.n(a)},68122:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var a=s(95155),l=s(25016);function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,l.cn)("bg-accent animate-pulse rounded-md",t),...s})}},71871:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},86278:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let a=s(28140)._(s(1150));function l(e,t){var s;let l={};"function"==typeof e&&(l.loader=e);let i={...l,...t};return(0,a.default)({...i,modules:null==(s=i.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},90003:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>et});var a=s(95155),l=s(12115),i=s(79956),r=s(82192),n=s(51321),d=s(78674),c=s(88901),o=s(71163),m=s(97003),x=s(83209),u=s(67812),h=s(47507),p=s(35626),y=s(16485),j=s(91169),f=s(21873),g=s(71871),v=s(67909),N=s(73344);let b=(0,v.default)(()=>Promise.all([s.e(4804),s.e(1761),s.e(9564)]).then(s.bind(s,79564)),{loadableGenerated:{webpack:()=>[79564]},ssr:!1});function w(e){let{kpis:t,states:s,onStateSelect:l,markers:i,highlightedEmployee:r,selectedEmployeeMarkers:n,onResetView:d,mapCenter:c,mapZoom:o,onMarkerClick:h,onEmployeeSelect:p,employeeList:v}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Total Visits"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(N.DZ,{as:"p",size:"2xl",weight:"bold",children:t.totalVisits}),(0,a.jsx)(N.EY,{size:"xs",tone:"muted",children:"+12% from last period"})]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Active Employees"}),(0,a.jsx)(j.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(N.DZ,{as:"p",size:"2xl",weight:"bold",children:t.activeEmployees}),(0,a.jsx)(N.EY,{size:"xs",tone:"muted",children:"+3% from last period"})]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(N.DZ,{as:"p",size:"2xl",weight:"bold",children:t.liveLocations}),(0,a.jsx)(N.EY,{size:"xs",tone:"muted",children:"+8% from last period"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(N.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"State-wise Employee Distribution"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.map(e=>(0,a.jsxs)(x.Zp,{className:"cursor-pointer transition-shadow hover:shadow-md",onClick:()=>l(e),children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:e.name}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(N.DZ,{as:"p",size:"xl",weight:"bold",children:e.employeeCount}),(0,a.jsx)(N.EY,{size:"xs",tone:"muted",children:"Employees working today"})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(N.DZ,{as:"h2",size:"2xl",weight:"semibold",children:"Live Employee Locations"}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between gap-4 lg:flex-row",children:[(0,a.jsxs)(N.EY,{tone:"muted",children:["Click on an employee to zoom to their location",r&&(0,a.jsxs)("span",{className:"ml-2 text-sm font-medium text-primary",children:["• Showing ",i.filter(e=>Number(e.id)===r.id).length+n.length," locations",n.filter(e=>"visit"===e.type).length>0&&(0,a.jsxs)("span",{className:"ml-1",children:["(",n.filter(e=>"visit"===e.type).length," visits)"]})]})]}),(0,a.jsx)(m.$,{variant:"outline",size:"sm",onClick:d,children:"Reset View"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(x.Zp,{className:"h-[600px] overflow-hidden rounded-xl",children:(0,a.jsx)(b,{center:c,zoom:o,highlightedEmployee:r,markers:[...i,...n],onMarkerClick:h})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(x.Zp,{className:"flex h-[600px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsx)(x.aR,{className:"border-b",children:(0,a.jsxs)(x.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(j.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsxs)(u.E,{variant:"secondary",className:"ml-auto",children:[v.length," online"]})]})}),(0,a.jsx)(x.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:v.map(e=>(0,a.jsxs)("button",{type:"button",className:"w-full p-4 text-left transition-colors ".concat((null==r?void 0:r.listId)===e.listId?"border-l-4 border-primary bg-accent":"hover:bg-accent/50"),onClick:()=>p(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-xl border-2 border-dashed bg-muted"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-card bg-green-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(N.DZ,{as:"p",size:"md",className:"text-foreground",children:String(e.name)}),(0,a.jsx)(N.EY,{size:"sm",tone:"muted",children:String(e.position)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:String(e.location).split(",")[0]})]}),(0,a.jsx)(N.EY,{as:"div",size:"xs",tone:"muted",className:"mt-1",children:String(e.formattedLastUpdated)})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)(u.E,{variant:"secondary",className:"text-xs capitalize",children:String(e.status)}),(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[String(e.visitsToday)," visits today"]})]})]},String(e.listId)))})})]})})]})]})]})}var M=s(91585);function k(e){let{selectedState:t,stateEmployees:s,onEmployeeDetailSelect:l}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(N.DZ,{as:"h2",size:"2xl",weight:"bold",children:[t.name," - Employee Details"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>(0,a.jsx)(M.A,{employee:e,onClick:()=>l(e)},String(e.id)))})]})}var S=s(51631),E=s(27937),D=s(12108),A=s(24033),P=s(26265),C=s(24813),z=s(68425),Z=s(47734),L=s(73697),G=s(99919),T=s(50892),_=s(37665),I=s(26467),O=s(68122),W=s(20063),R=s(37621),V=s(97450),B=s(55725);let F=e=>{let{title:t,value:s}=e;return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(x.ZB,{className:"text-xs md:text-sm font-medium",children:t})}),(0,a.jsx)(x.Wu,{className:"pt-0",children:(0,a.jsx)("p",{className:"text-2xl md:text-4xl font-bold",children:s})})]})},Y=e=>{let{data:t}=e;return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{className:"text-base md:text-lg",children:"Visits by Purpose"})}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(P.u,{width:"100%",height:250,className:"md:hidden",children:(0,a.jsxs)(C.E,{data:t,children:[(0,a.jsx)(z.d,{strokeDasharray:"3 3"}),(0,a.jsx)(Z.W,{dataKey:"purpose",tick:{fontSize:10}}),(0,a.jsx)(L.h,{tick:{fontSize:10}}),(0,a.jsx)(G.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none",fontSize:"12px"}}),(0,a.jsx)(T.y,{dataKey:"visits",fill:"#1a202c"})]})}),(0,a.jsx)(P.u,{width:"100%",height:300,className:"hidden md:block",children:(0,a.jsxs)(C.E,{data:t,children:[(0,a.jsx)(z.d,{strokeDasharray:"3 3"}),(0,a.jsx)(Z.W,{dataKey:"purpose"}),(0,a.jsx)(L.h,{}),(0,a.jsx)(G.m,{contentStyle:{backgroundColor:"rgba(0, 0, 0, 0.8)",border:"none"}}),(0,a.jsx)(_.s,{}),(0,a.jsx)(T.y,{dataKey:"visits",fill:"#1a202c"})]})})]})]})},$=e=>{let{visits:t,onViewDetails:s,currentPage:i,onPageChange:r}=e,[n,d]=(0,l.useState)("desc"),[c,h]=(0,l.useState)("date"),[p,y]=(0,l.useState)(null),j=e=>e.checkinTime&&e.checkoutTime?{emoji:"✅",status:"Completed"}:e.checkoutTime?{emoji:"⏱️",status:"Checked Out"}:e.checkinTime?{emoji:"\uD83D\uDD70️",status:"On Going"}:{emoji:"\uD83D\uDCC5",status:"Assigned"},g=e=>{e===c?d("asc"===n?"desc":"asc"):(h(e),d("desc")),y(e)},v=Math.ceil(t.length/10),N=[...t].sort((e,t)=>{let s=e[c],a=t[c];return null==s?1:null==a?-1:"string"==typeof s&&"string"==typeof a?"asc"===n?s.localeCompare(a):a.localeCompare(s):s<a?"asc"===n?-1:1:s>a?"asc"===n?1:-1:0}),b=(i-1)*10,w=N.slice(b,b+10);return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{className:"text-base md:text-lg",children:"Recent Completed Visits"})}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsxs)("div",{className:"md:hidden space-y-3",children:[w.map(e=>{let{emoji:t,status:l}=j(e);return"Completed"!==l?null:(0,a.jsx)(x.Zp,{className:"border-l-4 border-l-primary",children:(0,a.jsxs)(x.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm truncate",children:e.customer}),(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[t," ",l]})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,o.GP)((0,I.H)(e.date),"dd MMM ''yy")," • ",e.purpose]})]}),(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id),children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"capitalize truncate max-w-[150px]",children:e.employeeState||"N/A"})]}),(0,a.jsx)(m.$,{variant:"link",className:"px-0 h-auto text-xs",onClick:()=>s(e.id),children:"View"})]})]})},e.id)}),0===w.filter(e=>"Completed"===j(e).status).length&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"No completed visits available"})]}),(0,a.jsx)("div",{className:"hidden md:block overflow-x-auto -mx-4 px-4 md:mx-0 md:px-0",children:(0,a.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>g("customer"),children:["Store","customer"===p&&("asc"===n?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(A.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>g("date"),children:["Date","date"===p&&("asc"===n?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(A.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>g("purpose"),children:["Purpose","purpose"===p&&("asc"===n?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(A.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsxs)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm cursor-pointer",onClick:()=>g("employeeState"),children:["City","employeeState"===p&&("asc"===n?(0,a.jsx)(D.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}):(0,a.jsx)(A.A,{className:"w-3 h-3 md:w-4 md:h-4 inline-block ml-1"}))]}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Status"}),(0,a.jsx)("th",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[w.map(e=>{let{emoji:t,status:l}=j(e);return"Completed"!==l?null:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.customer}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm whitespace-nowrap",children:(0,o.GP)((0,I.H)(e.date),"dd MMM ''yy")}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.purpose}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm capitalize",children:e.employeeState||"N/A"}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:(0,a.jsxs)(u.E,{variant:"outline",className:"text-xs whitespace-nowrap",children:[t," ",l]})}),(0,a.jsx)("td",{className:"px-2 md:px-4 py-2",children:(0,a.jsx)("button",{className:"text-blue-500 hover:text-blue-700 text-xs md:text-sm",onClick:()=>s(e.id),children:"View"})})]},e.id)}),0===w.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-2 md:px-4 py-2 text-xs md:text-sm text-center",colSpan:6,children:"No visits available"})})]})]})})]}),v>1&&w.length>0&&(0,a.jsx)(S.dK,{children:(0,a.jsxs)(S.Iu,{children:[(0,a.jsx)(S.cU,{children:(0,a.jsx)(S.n$,{size:"default",onClick:()=>r(i-1),className:1===i?"pointer-events-none opacity-50":"",children:"Previous"})}),Array.from({length:v},(e,t)=>(0,a.jsx)(S.cU,{children:(0,a.jsx)(S.n$,{size:"default",onClick:()=>r(t+1),className:i===t+1?"bg-gray-300":"",children:t+1})},t)),(0,a.jsx)(S.cU,{children:(0,a.jsx)(S.n$,{size:"default",onClick:()=>r(i+1),className:i===v?"pointer-events-none opacity-50":"",children:"Next"})})]})})]})};function U(e){var t,s,i,r,n,d,c,u,p;let{employee:y,dateRange:j}=e,[f,g]=(0,l.useState)(null),[v,N]=(0,l.useState)(!0),[b,w]=(0,l.useState)(null),[M,k]=(0,l.useState)(1),S=(0,W.useRouter)(),E="dashboard.employeeDetail.state.v1",[D,A]=(0,l.useState)("today"),[P,C]=(0,l.useState)([]),[z,Z]=(0,l.useState)(new Date),[L,G]=(0,l.useState)(new Date),[T,_]=(0,l.useState)(null),[I,U]=(0,l.useState)(new Date().getFullYear()),[q,H]=(0,l.useState)(new Date().getMonth()+1),[J,K]=(0,l.useState)([]),[X,Q]=(0,l.useState)(new Date),[ee,et]=(0,l.useState)(new Date),es=localStorage.getItem("authToken");(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(E);if(!e)return;let t=JSON.parse(e);if((null==t?void 0:t.employeeId)!==y.id)return;"string"==typeof t.visitFilter&&A(t.visitFilter),"number"==typeof t.currentPage&&k(t.currentPage),t.expenseStartDate&&"string"==typeof t.expenseStartDate&&Z(new Date(t.expenseStartDate)),t.expenseEndDate&&"string"==typeof t.expenseEndDate&&G(new Date(t.expenseEndDate)),"number"==typeof t.selectedYear&&U(t.selectedYear),"number"==typeof t.selectedMonth&&H(t.selectedMonth),t.pricingStartDate&&"string"==typeof t.pricingStartDate&&Q(new Date(t.pricingStartDate)),t.pricingEndDate&&"string"==typeof t.pricingEndDate&&et(new Date(t.pricingEndDate))}catch(e){}},[y.id]),(0,l.useEffect)(()=>{try{sessionStorage.setItem(E,JSON.stringify({employeeId:y.id,visitFilter:D,currentPage:M,expenseStartDate:z,expenseEndDate:L,selectedYear:I,selectedMonth:q,pricingStartDate:X,pricingEndDate:ee}))}catch(e){}},[y.id,D,M,z,L,I,q,X,ee]),(0,l.useEffect)(()=>{(async()=>{N(!0),w(null);try{let e,t,s=new Date;if("today"===D)e=(0,o.GP)(s,"yyyy-MM-dd"),t=(0,o.GP)(s,"yyyy-MM-dd");else if("yesterday"===D){let a=new Date(s);a.setDate(a.getDate()-1),e=(0,o.GP)(a,"yyyy-MM-dd"),t=(0,o.GP)(a,"yyyy-MM-dd")}else if("last-2-days"===D){let a=new Date(s);a.setDate(a.getDate()-2),e=(0,o.GP)(a,"yyyy-MM-dd"),t=(0,o.GP)(s,"yyyy-MM-dd")}else if("this-month"===D){let a=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0);e=(0,o.GP)(a,"yyyy-MM-dd"),t=(0,o.GP)(l,"yyyy-MM-dd")}else if("last-month"===D){let a=new Date(s.getFullYear(),s.getMonth()-1,1),l=new Date(s.getFullYear(),s.getMonth(),0);e=(0,o.GP)(a,"yyyy-MM-dd"),t=(0,o.GP)(l,"yyyy-MM-dd")}else e=(0,o.GP)(j.start,"yyyy-MM-dd"),t=(0,o.GP)(j.end,"yyyy-MM-dd");let a=await R.n.getEmployeeStatsWithVisits(y.id,e,t);g(a)}catch(e){w((null==e?void 0:e.message)||"Failed to load employee details")}finally{N(!1)}})()},[y.id,D,j.start,j.end]),(0,l.useEffect)(()=>{(async()=>{if(es)try{let e=z?(0,o.GP)(z,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=L?(0,o.GP)(L,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/expense/getByEmployeeAndDate?start=".concat(e,"&end=").concat(t,"&id=").concat(y.id),{headers:{Authorization:"Bearer ".concat(es)}}),a=await s.json();C(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching expenses:",e)}})()},[es,y.id,z,L]),(0,l.useEffect)(()=>{(async()=>{if(es)try{let e="".concat(I,"-").concat(String(q).padStart(2,"0"),"-01"),t=await fetch("https://api.gajkesaristeels.in/attendance-log/monthlyVisits?date=".concat(e,"&employeeId=").concat(y.id),{headers:{Authorization:"Bearer ".concat(es)}}),s=await t.json();_(s)}catch(e){console.error("Error fetching attendance stats:",e)}})()},[es,y.id,I,q]),(0,l.useEffect)(()=>{(async()=>{if(es)try{let e=X?(0,o.GP)(X,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-01"),t=ee?(0,o.GP)(ee,"yyyy-MM-dd"):(0,o.GP)(new Date,"yyyy-MM-30"),s=await fetch("https://api.gajkesaristeels.in/brand/getByDateRangeForEmployee?start=".concat(e,"&end=").concat(t,"&id=").concat(y.id),{headers:{Authorization:"Bearer ".concat(es)}}),a=await s.json();K(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching daily pricing:",e)}})()},[es,y.id,X,ee]);let ea=(0,l.useMemo)(()=>f&&f.visitDto?Object.entries(f.visitDto.filter(e=>e.checkinTime&&e.checkoutTime).reduce((e,t)=>{let s=t.purpose?t.purpose.trim().toLowerCase():"unknown";return e[s]||(e[s]=0),e[s]++,e},{})).map(e=>{let[t,s]=e;return{purpose:t.charAt(0).toUpperCase()+t.slice(1),visits:Number(s)}}):[],[f]);if(b)return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded p-3",children:b})});if(v)return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(O.E,{className:"h-8 w-48"}),(0,a.jsx)(O.E,{className:"h-4 w-32 mt-2"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{className:"pb-2 md:pb-4",children:(0,a.jsx)(O.E,{className:"h-4 w-28"})}),(0,a.jsx)(x.Wu,{className:"pt-0",children:(0,a.jsx)(O.E,{className:"h-8 w-16"})})]},t))}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(O.E,{className:"h-6 w-56"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 p-3 border rounded",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)(O.E,{className:"h-4 w-40"}),(0,a.jsx)(O.E,{className:"h-3 w-56 mt-2"})]}),(0,a.jsx)(O.E,{className:"h-5 w-16"})]},t))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(O.E,{className:"h-6 w-40"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)(O.E,{className:"h-64 w-full"})})]})]});let el=((null==f?void 0:f.visitDto)||[]).map(e=>({id:e.id,date:e.visit_date,customer:e.storeName,purpose:e.purpose||"—",status:"completed",duration:"-",checkinTime:e.checkinTime,checkoutTime:e.checkoutTime,employeeState:e.state})),ei=el.filter(e=>e.checkinTime&&e.checkoutTime).length;return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 pb-20 md:pb-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold capitalize",children:y.name}),(0,a.jsx)("p",{className:"text-sm md:text-base text-muted-foreground",children:y.position})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("div",{className:"space-y-2 w-full sm:w-auto",children:(0,a.jsxs)(h.l6,{value:D,onValueChange:A,children:[(0,a.jsx)(h.bq,{className:"w-full sm:w-[180px] text-xs md:text-sm",children:(0,a.jsx)(h.yv,{placeholder:"Select Filter"})}),(0,a.jsxs)(h.gC,{children:[(0,a.jsx)(h.eb,{value:"today",className:"text-xs md:text-sm",children:"Today"}),(0,a.jsx)(h.eb,{value:"yesterday",className:"text-xs md:text-sm",children:"Yesterday"}),(0,a.jsx)(h.eb,{value:"last-2-days",className:"text-xs md:text-sm",children:"Last 2 Days"}),(0,a.jsx)(h.eb,{value:"this-month",className:"text-xs md:text-sm",children:"This Month"}),(0,a.jsx)(h.eb,{value:"last-month",className:"text-xs md:text-sm",children:"Last Month"})]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6 md:mb-8",children:[(0,a.jsx)(F,{title:"Total Completed Visits",value:ei}),(0,a.jsx)(F,{title:"Full Days",value:(null==f||null==(t=f.statsDto)?void 0:t.fullDays)||0}),(0,a.jsx)(F,{title:"Half Days",value:(null==f||null==(s=f.statsDto)?void 0:s.halfDays)||0}),(0,a.jsx)(F,{title:"Absences",value:(null==f||null==(i=f.statsDto)?void 0:i.absences)||0})]}),(0,a.jsx)($,{visits:el,onViewDetails:e=>{try{sessionStorage.setItem("dashboard.view.state.v1",JSON.stringify({view:"employeeDetail",selectedEmployee:{id:y.id,name:y.name,position:y.position,avatar:y.avatar,location:y.location}}))}catch(e){}S.push("/dashboard/visits/".concat(e))},currentPage:M,onPageChange:k}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(Y,{data:ea})}),(0,a.jsxs)("div",{className:"mt-6 md:mt-8 space-y-3 md:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 md:gap-4",children:[(0,a.jsxs)(h.l6,{value:I.toString(),onValueChange:e=>U(parseInt(e)),children:[(0,a.jsx)(h.bq,{className:"w-full sm:w-[120px] text-xs md:text-sm",children:(0,a.jsx)(h.yv,{placeholder:"Year"})}),(0,a.jsx)(h.gC,{children:Array.from({length:5},(e,t)=>new Date().getFullYear()-t).map(e=>(0,a.jsx)(h.eb,{value:e.toString(),className:"text-xs md:text-sm",children:e},e))})]}),(0,a.jsxs)(h.l6,{value:q.toString(),onValueChange:e=>H(parseInt(e)),children:[(0,a.jsx)(h.bq,{className:"w-full sm:w-[140px] text-xs md:text-sm",children:(0,a.jsx)(h.yv,{placeholder:"Month"})}),(0,a.jsx)(h.gC,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((e,t)=>(0,a.jsx)(h.eb,{value:(t+1).toString(),className:"text-xs md:text-sm",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 md:gap-4",children:[(0,a.jsx)(x.Zp,{children:(0,a.jsxs)(x.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Full Day"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(c=null==T||null==(r=T.statsDto)?void 0:r.fullDays)?c:0})]})}),(0,a.jsx)(x.Zp,{children:(0,a.jsxs)(x.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Half Day"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(u=null==T||null==(n=T.statsDto)?void 0:n.halfDays)?u:0})]})}),(0,a.jsx)(x.Zp,{children:(0,a.jsxs)(x.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:"Absent"}),(0,a.jsx)("div",{className:"text-xl md:text-2xl font-semibold",children:null!=(p=null==T||null==(d=T.statsDto)?void 0:d.absences)?p:0})]})})]})]}),(0,a.jsxs)("div",{className:"mt-6 md:mt-8 space-y-3 md:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 md:gap-4",children:[(0,a.jsxs)(V.AM,{children:[(0,a.jsx)(V.Wv,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"outline",className:"w-full sm:w-auto text-xs md:text-sm justify-start",children:["Start: ",z?(0,o.GP)(z,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(V.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:z,onSelect:Z})})]}),(0,a.jsxs)(V.AM,{children:[(0,a.jsx)(V.Wv,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"outline",className:"w-full sm:w-auto text-xs md:text-sm justify-start",children:["End: ",L?(0,o.GP)(L,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(V.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:L,onSelect:G})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:P.map((e,t)=>(0,a.jsx)(x.Zp,{children:(0,a.jsxs)(x.Wu,{className:"pt-4 md:pt-6",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm font-medium",children:String(e.type||"N/A")}),(0,a.jsx)("div",{className:"text-xs md:text-sm text-muted-foreground",children:String(e.employeeName||"N/A")}),(0,a.jsxs)("div",{className:"mt-2 text-sm md:text-base",children:["Amount: ₹",Number(e.amount||0).toFixed(2)]}),(0,a.jsx)("div",{className:"text-xs md:text-sm",children:String(e.approvalStatus||"N/A")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.expenseDate&&"string"==typeof e.expenseDate?(0,o.GP)(new Date(e.expenseDate),"MMM d, yyyy"):""})]})},String(e.id)||t))})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(V.AM,{children:[(0,a.jsx)(V.Wv,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"outline",children:["Start: ",X?(0,o.GP)(X,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(V.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:X,onSelect:Q})})]}),(0,a.jsxs)(V.AM,{children:[(0,a.jsx)(V.Wv,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"outline",children:["End: ",ee?(0,o.GP)(ee,"MMM d, yyyy"):"Pick"]})}),(0,a.jsx)(V.hl,{className:"w-auto p-0",children:(0,a.jsx)(B.V,{mode:"single",selected:ee,onSelect:et})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:J.map((e,t)=>(0,a.jsx)(x.Zp,{children:(0,a.jsxs)(x.Wu,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-medium",children:String(e.brandName||"N/A")}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:String(e.city||"N/A")})]}),(0,a.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:["₹",Number(e.price||0).toFixed(2)]})]})},String(e.id)||t))})]})]})}function q(e){let{employee:t,dateRange:s}=e;return(0,a.jsx)(U,{employee:t,dateRange:s})}var H=s(56069);let J=[22.5726,88.3639],K={Mumbai:[19.076,72.8777],Bangalore:[12.9716,77.5946],Chennai:[13.0827,80.2707],Hyderabad:[17.385,78.4867],Kolkata:[22.5726,88.3639],Delhi:[28.6139,77.209]},X=e=>{let t=Object.entries(K).find(t=>{let[s]=t;return e.includes(s)});return t?t[1]:J},Q=["bg-blue-500","bg-green-500","bg-yellow-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500"],ee=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"thisWeek",label:"This Week"},{value:"thisMonth",label:"This Month"}];function et(){let{userRole:e,userData:t,currentUser:s,token:v}=(0,H.A)(),[b,M]=(0,l.useState)("today"),[S,E]=(0,l.useState)("dashboard"),[D,A]=(0,l.useState)(null),[P,C]=(0,l.useState)(null),[z,Z]=(0,l.useState)(J),[L,G]=(0,l.useState)(5),[T,_]=(0,l.useState)(null),[I,W]=(0,l.useState)([]),[V,B]=(0,l.useState)([]),[F,Y]=(0,l.useState)([]),[$,U]=(0,l.useState)({totalVisits:0,activeEmployees:0,liveLocations:0}),[K,et]=(0,l.useState)(new Map),[es,ea]=(0,l.useState)([]),[el,ei]=(0,l.useState)([]),[er,en]=(0,l.useState)(null),[ed,ec]=(0,l.useState)(!1),[eo,em]=(0,l.useState)(!1),[ex,eu]=(0,l.useState)(!0),eh="dashboard.view.state.v1";(0,l.useEffect)(()=>{try{let e=sessionStorage.getItem(eh);if(e){let t=JSON.parse(e);(null==t?void 0:t.selectedState)&&A(t.selectedState),(null==t?void 0:t.view)==="employeeDetail"&&(null==t?void 0:t.selectedEmployee)?(C(t.selectedEmployee),E("employeeDetail")):(null==t?void 0:t.view)==="state"&&(null==t?void 0:t.selectedState)&&E("state")}}catch(e){}(async()=>{if(v)try{let e=await fetch("https://api.gajkesaristeels.in/user/manage/current-user",{headers:{Authorization:"Bearer ".concat(v),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("Dashboard - Current user data:",t);let s=t.authorities||[],a=s.length>0?s[0].authority:null,l="ROLE_MANAGER"===a;ec(l),console.log("Dashboard - Role from API:",a),console.log("Dashboard - isManager:",l),em(!0)}else console.error("Dashboard - Failed to fetch current user data"),em(!0)}catch(e){console.error("Dashboard - Error fetching current user:",e),em(!0)}})()},[v]),(0,l.useEffect)(()=>{try{sessionStorage.setItem(eh,JSON.stringify({view:S,selectedState:D,selectedEmployee:P}))}catch(e){}},[S,D,P]),(0,l.useEffect)(()=>{let e=async()=>{if(ed&&(null==t?void 0:t.employeeId))try{let e=(await R.n.getTeamByEmployee(t.employeeId)).flatMap(e=>e.fieldOfficers.map(e=>e.id)),s=I.filter(t=>e.includes(t.id));B(s)}catch(e){console.error("Failed to load team members:",e),en("Failed to load team members")}};ed&&I.length>0&&e()},[ed,null==t?void 0:t.employeeId,I]),(0,l.useEffect)(()=>{(async()=>{if(eo)try{eu(!0);let e=(await R.n.getAllEmployees()||[]).map(e=>({id:e.id,name:[e.firstName,e.lastName].filter(Boolean).join(" ")||String(e.id),position:e.role||"Employee",avatar:"/placeholder.svg?height=40&width=40",lastUpdated:new Date().toISOString(),status:"active",location:[e.city,e.state].filter(Boolean).join(", ")}));W(e)}catch(e){en((null==e?void 0:e.message)||"Failed to load employees")}finally{eu(!1)}})()},[eo]);let ep=(0,l.useMemo)(()=>ed&&V.length>0?V:I,[ed,V,I]),ey=(0,l.useMemo)(()=>{let e=new Date;switch(b){case"today":default:return{start:e,end:e};case"yesterday":{let t=(0,i.e)(e,1);return{start:t,end:t}}case"thisWeek":return{start:(0,r.k)(e),end:(0,n.$)(e)};case"thisMonth":return{start:(0,d.w)(e),end:(0,c.p)(e)}}},[b]);(0,l.useEffect)(()=>{(async()=>{if(eo)try{let e=(0,o.GP)(ey.start,"yyyy-MM-dd"),t=(0,o.GP)(ey.end,"yyyy-MM-dd"),s=await R.n.getReportCounts(e,t),a=ed?s.filter(e=>ep.some(t=>t.id===e.employeeId)):s,l=(a||[]).reduce((e,t)=>{var s,a;return e+(null!=(a=null==(s=t.statsDto)?void 0:s.visitCount)?a:0)},0),i=(a||[]).filter(e=>{var t,s;return(null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)>0}).length,r=new Map;a.forEach(e=>{var t,s;return r.set(e.employeeId,null!=(s=null==(t=e.statsDto)?void 0:t.visitCount)?s:0)}),et(r),U(e=>({...e,totalVisits:l,activeEmployees:i}))}catch(e){console.error("Error fetching KPIs:",e)}})()},[ey.start,ey.end,ed,ep,eo]),(0,l.useEffect)(()=>{let e=!1;return(async()=>{if(eo)try{let t=await R.n.getAllEmployeeLocations(),s=new Date,a=[];t.forEach(e=>{if(null!=e.latitude&&null!=e.longitude){let t=!0;if(ed&&(t=V.some(t=>t.id===e.empId)),!t)return;let l=String(e.updatedTime).split(".")[0],i=new Date("".concat(e.updatedAt,"T").concat(l));(s.getTime()-i.getTime())/6e4<=60&&a.push({id:e.empId,name:e.empName,lat:e.latitude,lng:e.longitude,subtitle:"".concat((0,o.GP)(i,"dd MMM ''yy")," ").concat(l).trim(),type:"live",employeeId:e.empId,tooltipLines:["Employee: ".concat(e.empName),"Last updated: ".concat((0,o.GP)(i,"dd MMM ''yy, hh:mm a"))]})}}),e||(a.sort((e,t)=>(e.name||"").localeCompare(t.name||"")),ea(a))}catch(t){e||ea([])}})(),()=>{e=!0}},[ed,V,eo]),(0,l.useEffect)(()=>{U(e=>({...e,liveLocations:es.length}))},[es.length]),(0,l.useEffect)(()=>{if(!I.length)return;let e=new Map;I.forEach(t=>{var s;let a=null!=(s=K.get(t.id))?s:0,l=t.location.split(", ")[1]||"Unknown";a>0&&e.set(l,(e.get(l)||0)+1)}),Y(Array.from(e.entries()).map((e,t)=>{let[s,a]=e;return{id:t+1,name:s,employeeCount:a,color:Q[t%Q.length]}}))},[I,K]);let ej=(0,l.useMemo)(()=>{let e=new Map;es.forEach(t=>{e.set(Number(t.id),{lat:t.lat,lng:t.lng,subtitle:t.subtitle})});let t=ep.filter(t=>e.has(t.id)).map(t=>{var s,a;return{...t,listId:String(t.id),visitsToday:null!=(a=K.get(t.id))?a:0,formattedLastUpdated:(null==(s=e.get(t.id))?void 0:s.subtitle)||""}});return t.sort((e,t)=>e.name.localeCompare(t.name)),t},[ep,K,es]),ef=(0,l.useMemo)(()=>D?ep.filter(e=>{var t;return e.location.includes(D.name)&&(null!=(t=K.get(e.id))?t:0)>0}):[],[D,ep,K]),eg=(0,l.useCallback)(()=>{if("employeeDetail"===S){E("state"),C(null);return}"state"===S&&(E("dashboard"),A(null),_(null),Z(J),G(5))},[S]),ev=(0,l.useCallback)(e=>{e&&(A({id:e.id,name:e.name,employeeCount:e.employeeCount,color:e.color||Q[0]}),E("state"))},[]),eN=(0,l.useCallback)(async e=>{let t=es.find(t=>Number(t.id)===e.id);ei([]),_(e);try{let s=await R.n.getEmployeeById(e.id);if(s&&null!=s.houseLatitude&&null!=s.houseLongitude){let a=[s.city,s.state,s.country].filter(Boolean).join(", "),l={id:"house-".concat(s.id),name:"".concat(e.name,"'s Home"),lat:Number(s.houseLatitude),lng:Number(s.houseLongitude),subtitle:a,type:"house",employeeId:s.id,tooltipLines:[]};if(ei([l]),t){let e=(t.lat+Number(s.houseLatitude))/2,a=(t.lng+Number(s.houseLongitude))/2;Z([e,a]),G(12)}else Z([Number(s.houseLatitude),Number(s.houseLongitude)]),G(13)}else t?(Z([t.lat,t.lng]),G(13)):(Z(X(e.location)),G(10))}catch(s){console.error("Failed to fetch employee house location:",s),t?(Z([t.lat,t.lng]),G(13)):(Z(X(e.location)),G(10))}},[es]),eb=(0,l.useCallback)(e=>{C(e),E("employeeDetail")},[]),ew=(0,l.useCallback)(async e=>{if("live"===e.type){let t=Number(e.id),s=ej.find(e=>e.id===t);s&&(_(s),Z([e.lat,e.lng]),G(13))}},[ej]);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{if(!T||!v)return ei([]);try{var t;let s=(0,o.GP)(ey.start,"yyyy-MM-dd"),a=(0,o.GP)(ey.end,"yyyy-MM-dd"),[l,i]=await Promise.all([R.n.getEmployeeById(T.id),R.n.getEmployeeStatsByDateRange(T.id,s,a)]),r=[],n=(e,t)=>{if(!e)return"Not available";let s=t?t.split(".")[0]:null,a=s&&8===s.length?s:s?"".concat(s):"00:00:00",l=new Date("".concat(e,"T").concat(null!=a?a:"00:00:00"));return Number.isNaN(l.getTime())?e:(0,o.GP)(l,"dd MMM yyyy, hh:mm a")};(null!=(t=null==i?void 0:i.visitDto)?t:[]).forEach(e=>{var t,s,a,l;let i=null!=(s=null!=(t=e.checkinLatitude)?t:e.visitLatitude)?s:e.storeLatitude,d=null!=(l=null!=(a=e.checkinLongitude)?a:e.visitLongitude)?l:e.storeLongitude;if(null==i||null==d)return;let c=n(e.checkinDate,e.checkinTime),o=e.checkoutDate||e.checkoutTime?n(e.checkoutDate,e.checkoutTime):"Not recorded",m=[e.city,e.state,e.country].filter(Boolean).join(", "),x=["Store: ".concat(e.storeName||"N/A"),"Employee: ".concat(e.employeeName||T.name),"Check-in: ".concat(c),"Check-out: ".concat(o),e.purpose?"Purpose: ".concat(e.purpose):null,m?"Address: ".concat(m):null].filter(Boolean);r.push({id:"visit-".concat(e.id),name:e.storeName||"Visit",lat:Number(i),lng:Number(d),subtitle:"".concat(e.storeName||"Visit"," - ").concat(e.purpose||"Visit"),type:"visit",employeeId:e.employeeId,tooltipLines:x})}),e||ei(e=>[...e,...r])}catch(t){console.error("Failed to load selected employee map data:",t),e||ei([])}})(),()=>{e=!0}},[null==T?void 0:T.id,null==T?void 0:T.name,ey.start,ey.end,v]),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(N.DZ,{as:"h1",size:"3xl",weight:"bold",children:"dashboard"===S?"Dashboard":"state"===S&&D?D.name:"Employee Details"}),eo&&(0,a.jsx)(u.E,{variant:ed?"secondary":"default",className:"text-xs",children:ed?"Manager View":"Admin View"})]}),(0,a.jsx)(N.EY,{tone:"muted",children:"dashboard"===S?ed?"Overview of your team's activities and performance.":"Overview of sales and employee activities.":D?"Details for ".concat(D.name):"Deep dive into employee performance."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:["dashboard"!==S&&(0,a.jsxs)(m.$,{variant:"outline",onClick:eg,className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),"Back"]}),(0,a.jsxs)(h.l6,{value:b,onValueChange:M,children:[(0,a.jsx)(h.bq,{className:"w-[180px]",children:(0,a.jsx)(h.yv,{placeholder:"Select date range"})}),(0,a.jsx)(h.gC,{children:ee.map(e=>(0,a.jsx)(h.eb,{value:e.value,children:e.label},e.value))})]})]})]}),!eo||ex?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Total Visits"}),(0,a.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(O.E,{className:"h-8 w-16"}),(0,a.jsx)(O.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Active Employees"}),(0,a.jsx)(j.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(O.E,{className:"h-8 w-16"}),(0,a.jsx)(O.E,{className:"h-4 w-24 mt-2"})]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.ZB,{children:"Live Locations"}),(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(O.E,{className:"h-8 w-16"}),(0,a.jsx)(O.E,{className:"h-4 w-24 mt-2"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(O.E,{className:"h-8 w-64"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(O.E,{className:"h-6 w-20"}),(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsx)(O.E,{className:"h-8 w-12"}),(0,a.jsx)(O.E,{className:"h-4 w-32 mt-2"})]})]},t))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(O.E,{className:"h-8 w-64"}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(x.Zp,{className:"h-[600px] overflow-hidden rounded-xl",children:(0,a.jsx)(O.E,{className:"h-full w-full"})})}),(0,a.jsx)("div",{className:"w-full lg:w-96",children:(0,a.jsxs)(x.Zp,{className:"flex h-[600px] flex-col overflow-hidden rounded-xl",children:[(0,a.jsx)(x.aR,{className:"border-b",children:(0,a.jsxs)(x.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(j.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Active Employees"}),(0,a.jsx)(O.E,{className:"h-6 w-12 ml-auto"})]})}),(0,a.jsx)(x.Wu,{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsx)("div",{className:"divide-y",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"w-full p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(O.E,{className:"h-10 w-10 rounded-xl"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.E,{className:"h-4 w-24"}),(0,a.jsx)(O.E,{className:"h-3 w-16 mt-1"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)(O.E,{className:"h-3 w-16"}),(0,a.jsx)(O.E,{className:"h-3 w-20 mt-1"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)(O.E,{className:"h-5 w-16"}),(0,a.jsx)(O.E,{className:"h-5 w-20"})]})]},t))})})]})})]})]})]}):(0,a.jsxs)(a.Fragment,{children:["dashboard"===S&&(0,a.jsx)(w,{kpis:$,states:F,onStateSelect:ev,markers:es,highlightedEmployee:T,selectedEmployeeMarkers:el,onResetView:()=>{Z(J),G(5),_(null),ei([])},mapCenter:z,mapZoom:L,onMarkerClick:ew,onEmployeeSelect:eN,employeeList:ej}),"state"===S&&D&&(0,a.jsx)(k,{selectedState:D,stateEmployees:ef,onEmployeeDetailSelect:eb}),"employeeDetail"===S&&P&&(0,a.jsx)(q,{employee:P,dateRange:ey})]})]})}},91169:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},91585:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(95155),l=s(83209),i=s(21873),r=s(26983),n=s(20508),d=s(71163);function c(e){let{employee:t,onClick:s}=e;return(0,a.jsx)(l.Zp,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:s,children:(0,a.jsxs)(l.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"bg-gray-200 border-2 border-dashed rounded-xl w-10 h-10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:t.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.position})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(i.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:t.location})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(r.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Last updated: ",(0,d.GP)(new Date(t.lastUpdated),"h:mm a")]})]}),void 0!==t.totalVisits&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(n.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["Visits: ",t.totalVisits]})]})]})]})})}},97450:(e,t,s)=>{"use strict";s.d(t,{AM:()=>r,Wv:()=>n,hl:()=>d});var a=s(95155);s(12115);var l=s(82286),i=s(25016);function r(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"popover",...t})}function n(e){let{...t}=e;return(0,a.jsx)(l.l9,{"data-slot":"popover-trigger",...t})}function d(e){let{className:t,align:s="center",sideOffset:r=4,...n}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsx)(l.UC,{"data-slot":"popover-content",align:s,sideOffset:r,className:(0,i.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}}},e=>{e.O(0,[9358,9,1052,4627,1029,9687,6454,8441,1255,7358],()=>e(e.s=59845)),_N_E=e.O()}]);