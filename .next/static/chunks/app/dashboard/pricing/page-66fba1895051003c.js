(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6560],{1788:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>D});var r=t(95155),s=t(12115),l=t(71163),n=t(56069),c=t(97003),i=t(83209),o=t(90235),d=t(47507),m=t(96633),h=t(26265),u=t(24813),j=t(68425),x=t(47734),p=t(73697),y=t(99919),f=t(37665),g=t(50892),b=t(16485),N=t(42348),v=t(37621),w=t(97450),A=t(60028);let D=()=>{let[e,a]=(0,s.useState)([]),[t,D]=(0,s.useState)([]),[P,k]=(0,s.useState)(""),[C,M]=(0,s.useState)((0,l.GP)(new Date,"yyyy-MM-dd")),[E,S]=(0,s.useState)([]),[I,R]=(0,s.useState)(0),[F,B]=(0,s.useState)(!1),[O,L]=(0,s.useState)(!1),[G,_]=(0,s.useState)([]),[T,Z]=(0,s.useState)("all"),[W,z]=(0,s.useState)(null),[H,q]=(0,s.useState)([]),[J,K]=(0,s.useState)(!1),[V,X]=(0,s.useState)(null),{token:U,userRole:$,currentUser:Q,userData:Y}=(0,n.A)(),[ee,ea]=(0,s.useState)(!1),[et,er]=(0,s.useState)(!1),[es,el]=(0,s.useState)(!1),[en,ec]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{if(U)try{let e=await fetch("https://api.gajkesaristeels.in/user/manage/current-user",{headers:{Authorization:"Bearer ".concat(U),"Content-Type":"application/json"}});if(e.ok){let a=await e.json();console.log("Current user data:",a);let t=a.authorities||[],r=t.length>0?t[0].authority:null;ec(r),ea("ROLE_MANAGER"===r),er("ROLE_ADMIN"===r),el("ROLE_FIELD OFFICER"===r),console.log("Role from API:",r),console.log("isManager:","ROLE_MANAGER"===r),console.log("isAdmin:","ROLE_ADMIN"===r),console.log("isFieldOfficer:","ROLE_FIELD OFFICER"===r)}else console.error("Failed to fetch current user data")}catch(e){console.error("Error fetching current user:",e)}})()},[U]),(0,s.useEffect)(()=>{(async()=>{if((ee||es)&&(null==Y?void 0:Y.employeeId)){K(!0),X(null);try{let e=await v.n.getTeamByEmployee(Y.employeeId);q(e),e.length>0?z(e[0].id):(X("No team data found for this user"),z(51))}catch(e){console.error("Failed to load team data:",e),X("Failed to load team data"),z(51)}finally{K(!1)}}})()},[ee,es,null==Y?void 0:Y.employeeId]),(0,s.useEffect)(()=>{ei()},[P,C,W]);let ei=async()=>{B(!0),await Promise.all([eo(),ed()]),B(!1)},eo=(0,s.useCallback)(async()=>{if(U&&(!ee&&!es||null!=W))try{let r,s=(0,l.GP)(new Date(C),"yyyy-MM-dd"),n=(0,l.GP)(new Date(C),"yyyy-MM-dd");console.log("fetchBrandData - isManager:",ee,"teamId:",W),ee&&null!==W?(r="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(W,"&start=").concat(s,"&end=").concat(n),console.log("Manager API call:",r)):et?(r="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(s,"&end=").concat(n),console.log("Admin API call:",r)):es?(r="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(W,"&start=").concat(s,"&end=").concat(n),console.log("Field Officer API call:",r)):(r="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(s,"&end=").concat(n),console.log("Default (Admin) API call:",r));let c=await fetch(r,{headers:{Authorization:"Bearer ".concat(U)}}),i=await c.json();a(i);let o=Array.from(new Set(i.map(e=>{var a;return"gajkesari"===e.brandName.toLowerCase()?e.city:null==(a=e.employeeDto)?void 0:a.city}).filter(e=>e&&""!==e.trim())));S(o),!P&&o.length>0&&k(o[0]);let d=Array.from(new Set(i.map(e=>e.employeeDto?"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName):"").filter(e=>e&&""!==e.trim())));_(d);let m=i.find(e=>"gajkesari"===e.brandName.toLowerCase());if(m){var e,t;R(m.price),L((null==(e=m.employeeDto)?void 0:e.firstName)==="Test"&&(null==(t=m.employeeDto)?void 0:t.lastName)==="1")}else R(0),L(!1)}catch(e){console.error("Error fetching brand data:",e),a([]),R(0),L(!1)}},[C,U,P,ee,W]),ed=(0,s.useCallback)(async()=>{if(!U||(ee||es)&&null==W)return;let e=(0,l.GP)(new Date(new Date(C).getTime()-864e5),"yyyy-MM-dd");try{let a;ee&&null!==W?(a="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(W,"&start=").concat(e,"&end=").concat(e),console.log("Manager Previous Day API call:",a)):et?(a="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),console.log("Admin Previous Day API call:",a)):es?(a="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(W,"&start=").concat(e,"&end=").concat(e),console.log("Field Officer Previous Day API call:",a)):(a="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),console.log("Default (Admin) Previous Day API call:",a));let t=await fetch(a,{headers:{Authorization:"Bearer ".concat(U)}}),r=await t.json();D(r)}catch(e){console.error("Error fetching previous day data:",e),D([])}},[C,U,ee,W]),em=e.filter(e=>{var a;let t="all"===P||("gajkesari"===e.brandName.toLowerCase()?e.city===P:(null==(a=e.employeeDto)?void 0:a.city)===P),r="all"===T||!!e.employeeDto&&"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName)===T;return t&&r}),eh=Object.values(em.reduce((e,a)=>("gajkesari"===a.brandName.toLowerCase()?e.Gajkesari?(e.Gajkesari.count+=1,0===I&&(e.Gajkesari.ourPrice=a.price)):e.Gajkesari={brand:"Gajkesari",ourPrice:I>0?I:a.price,competitorPrice:0,count:1}:e[a.brandName]?(e[a.brandName].count+=1,e[a.brandName].competitorPrice=(e[a.brandName].competitorPrice*(e[a.brandName].count-1)+a.price)/e[a.brandName].count):e[a.brandName]={brand:a.brandName,ourPrice:0,competitorPrice:a.price,count:1},e),{})).map(e=>({brand:e.brand,ourPrice:e.ourPrice,competitorPrice:e.competitorPrice})).sort((e,a)=>"gajkesari"===e.brand.toLowerCase()?-1:"gajkesari"===a.brand.toLowerCase()?1:e.brand.localeCompare(a.brand));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(i.Zp,{children:[(0,r.jsx)(i.aR,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(i.ZB,{children:"Pricing Report"}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(ee||es)&&(0,r.jsx)("p",{children:J?"Loading team data...":V?"Error: ".concat(V," (Using fallback Team ID: ").concat(W,")"):W?"Team-based view (Team ID: ".concat(W,")"):"No team data available"})})]}),O&&I>0&&(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("h2",{className:"text-2xl",children:["Gajkesari Rate: ",(0,r.jsxs)("span",{className:"font-bold",children:["â‚¹",I,"/ton"]})]})})]})}),(0,r.jsx)(i.Wu,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{children:"City"}),(0,r.jsxs)(d.l6,{value:P,onValueChange:k,children:[(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"Select city"})}),(0,r.jsxs)(d.gC,{children:[(0,r.jsx)(d.eb,{value:"all",children:"All Cities"}),E.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{children:"Date"}),(0,r.jsxs)(w.AM,{children:[(0,r.jsx)(w.Wv,{asChild:!0,children:(0,r.jsxs)(c.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!C&&"text-muted-foreground"),children:[(0,r.jsx)(b.A,{className:"mr-2 h-4 w-4"}),C?(0,l.GP)(new Date(C),"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(w.hl,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(A.R,{initialFocus:!0,mode:"single",defaultMonth:new Date(C),selected:new Date(C),onSelect:e=>{e&&M((0,l.GP)(e,"yyyy-MM-dd"))}})})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(o.J,{children:"Field Officer"}),(0,r.jsxs)(d.l6,{value:T,onValueChange:Z,children:[(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"Select field officer"})}),(0,r.jsxs)(d.gC,{children:[(0,r.jsx)(d.eb,{value:"all",children:"All Field Officers"}),G.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))]})]})]})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(i.Zp,{className:"lg:col-span-2",children:[(0,r.jsx)(i.aR,{children:(0,r.jsx)(i.ZB,{children:"Competitor Pricing"})}),(0,r.jsx)(i.Wu,{children:F?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)(N.A,{className:"w-8 h-8 animate-spin text-primary"})}):(0,r.jsx)("div",{className:"rounded-md border overflow-hidden",children:(0,r.jsxs)(m.XI,{children:[(0,r.jsx)(m.A0,{children:(0,r.jsxs)(m.Hj,{children:[(0,r.jsx)(m.nd,{children:"Competitor"}),(0,r.jsx)(m.nd,{children:"Price (â‚¹/ton)"}),(0,r.jsx)(m.nd,{children:"City"}),(0,r.jsx)(m.nd,{children:"Field Officer"})]})}),(0,r.jsx)(m.BF,{children:em.length>0?em.map(e=>(0,r.jsxs)(m.Hj,{children:[(0,r.jsx)(m.nA,{className:"font-medium",children:e.brandName}),(0,r.jsxs)(m.nA,{children:["â‚¹",e.price.toFixed(2)]}),(0,r.jsx)(m.nA,{children:e.city}),(0,r.jsx)(m.nA,{children:"gajkesari"===e.brandName.toLowerCase()?e.city:e.employeeDto?"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName):"N/A"})]},e.id)):(0,r.jsx)(m.Hj,{children:(0,r.jsx)(m.nA,{colSpan:4,className:"h-24 text-center",children:"No pricing data found matching the selected filters"})})})]})})})]}),(0,r.jsxs)(i.Zp,{className:"lg:col-span-2",children:[(0,r.jsx)(i.aR,{children:(0,r.jsx)(i.ZB,{children:"Price Comparison by Brand"})}),(0,r.jsx)(i.Wu,{children:F?(0,r.jsx)("div",{className:"flex justify-center items-center h-80",children:(0,r.jsx)(N.A,{className:"w-8 h-8 animate-spin text-primary"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(h.u,{width:"100%",height:"100%",children:(0,r.jsxs)(u.E,{data:eh,margin:{top:20,right:30,left:20,bottom:60},children:[(0,r.jsx)(j.d,{strokeDasharray:"3 3"}),(0,r.jsx)(x.W,{dataKey:"brand",angle:-45,textAnchor:"end",height:60}),(0,r.jsx)(p.h,{}),(0,r.jsx)(y.m,{formatter:e=>["â‚¹".concat(e),"Price"],labelFormatter:e=>"Brand: ".concat(e)}),(0,r.jsx)(f.s,{}),(0,r.jsx)(g.y,{dataKey:"ourPrice",name:"Our Price",fill:"#3b82f6"}),(0,r.jsx)(g.y,{dataKey:"competitorPrice",name:"Competitor Price",fill:"#10b981"})]})})}),(0,r.jsx)("div",{className:"mt-4 text-sm text-muted-foreground",children:(0,r.jsx)("p",{children:"Comparison of prices by brand between our products and competitors"})})]})})]})]})]})}},10489:(e,a,t)=>{"use strict";t.d(a,{b:()=>c});var r=t(12115),s=t(97602),l=t(95155),n=r.forwardRef((e,a)=>(0,l.jsx)(s.sG.label,{...e,ref:a,onMouseDown:a=>{var t;a.target.closest("button, input, select, textarea")||(null==(t=e.onMouseDown)||t.call(e,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));n.displayName="Label";var c=n},42348:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},62004:(e,a,t)=>{Promise.resolve().then(t.bind(t,1788))},96633:(e,a,t)=>{"use strict";t.d(a,{A0:()=>n,BF:()=>c,Hj:()=>i,XI:()=>l,nA:()=>d,nd:()=>o,r6:()=>m});var r=t(95155);t(12115);var s=t(25016);function l(e){let{className:a,...t}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",a),...t})})}function n(e){let{className:a,...t}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",a),...t})}function c(e){let{className:a,...t}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",a),...t})}function i(e){let{className:a,...t}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...t})}function o(e){let{className:a,...t}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})}function d(e){let{className:a,...t}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})}function m(e){let{className:a,...t}=e;return(0,r.jsx)("caption",{"data-slot":"table-caption",className:(0,s.cn)("text-muted-foreground mt-4 text-sm",a),...t})}}},e=>{e.O(0,[9358,9,1052,4627,1029,9687,8237,8441,1255,7358],()=>e(e.s=62004)),_N_E=e.O()}]);