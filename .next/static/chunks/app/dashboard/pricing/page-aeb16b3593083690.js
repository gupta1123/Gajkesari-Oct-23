(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6560],{1788:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var n=a(95155),r=a(12115),s=a(71163),l=a(82466),i=a(68209),c=a(97003),o=a(83209),d=a(90235),u=a(47507),m=a(96633),h=a(26265),p=a(24813),j=a(68425),f=a(47734),x=a(73697),y=a(99919),g=a(37665),N=a(50892),b=a(16485),v=a(42348),w=a(37621),A=a(97450),P=a(60028);let D=()=>{let[e,t]=(0,r.useState)([]),[a,D]=(0,r.useState)([]),[k,M]=(0,r.useState)(""),[C,I]=(0,r.useState)((0,s.GP)(new Date,"yyyy-MM-dd")),[O,S]=(0,r.useState)([]),[E,T]=(0,r.useState)(0),[F,R]=(0,r.useState)(!1),[B,L]=(0,r.useState)(!1),[_,G]=(0,r.useState)([]),[U,W]=(0,r.useState)("all"),[Z,z]=(0,r.useState)(null),[H,q]=(0,r.useState)([]),[J,K]=(0,r.useState)(!1),[V,X]=(0,r.useState)(null),{token:$,userRole:Q,currentUser:Y,userData:ee}=(0,l.A)(),[et,ea]=(0,r.useState)(!1),[en,er]=(0,r.useState)(!1),[es,el]=(0,r.useState)(!1),[ei,ec]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if($)try{let e=await fetch("https://api.gajkesaristeels.in/user/manage/current-user",{headers:{Authorization:"Bearer ".concat($),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("Current user data:",t);let a=t.authorities||[],n=a.length>0?a[0].authority:null;ec(n);let r=(0,i.Xb)(n),s=(0,i.N4)(n),l="ROLE_ADMIN"===r||"ADMIN"===r,c="ROLE_FIELD OFFICER"===r||"FIELD OFFICER"===r;ea(s),er(l),el(c),console.log("Role from API:",n),console.log("isManager:",s),console.log("isAdmin:",l),console.log("isFieldOfficer:",c)}else console.error("Failed to fetch current user data")}catch(e){console.error("Error fetching current user:",e)}})()},[$]),(0,r.useEffect)(()=>{(async()=>{if((et||es)&&(null==ee?void 0:ee.employeeId)){K(!0),X(null);try{let e=await w.n.getTeamByEmployee(ee.employeeId);q(e),e.length>0?z(e[0].id):(X("No team data found for this user"),z(51))}catch(e){console.error("Failed to load team data:",e),X("Failed to load team data"),z(51)}finally{K(!1)}}})()},[et,es,null==ee?void 0:ee.employeeId]),(0,r.useEffect)(()=>{eo()},[k,C,Z]);let eo=async()=>{R(!0),await Promise.all([ed(),eu()]),R(!1)},ed=(0,r.useCallback)(async()=>{if($&&(!et&&!es||null!=Z))try{let n,r=(0,s.GP)(new Date(C),"yyyy-MM-dd"),l=(0,s.GP)(new Date(C),"yyyy-MM-dd");console.log("fetchBrandData - isManager:",et,"teamId:",Z),et&&null!==Z?(n="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(Z,"&start=").concat(r,"&end=").concat(l),console.log("Manager API call:",n)):en?(n="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(r,"&end=").concat(l),console.log("Admin API call:",n)):es?(n="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(Z,"&start=").concat(r,"&end=").concat(l),console.log("Field Officer API call:",n)):(n="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(r,"&end=").concat(l),console.log("Default (Admin) API call:",n));let i=await fetch(n,{headers:{Authorization:"Bearer ".concat($)}}),c=await i.json();t(c);let o=Array.from(new Set(c.map(e=>{var t;return"gajkesari"===e.brandName.toLowerCase()?e.city:null==(t=e.employeeDto)?void 0:t.city}).filter(e=>e&&""!==e.trim())));S(o),!k&&o.length>0&&M(o[0]);let d=Array.from(new Set(c.map(e=>e.employeeDto?"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName):"").filter(e=>e&&""!==e.trim())));G(d);let u=c.find(e=>"gajkesari"===e.brandName.toLowerCase());if(u){var e,a;T(u.price),L((null==(e=u.employeeDto)?void 0:e.firstName)==="Test"&&(null==(a=u.employeeDto)?void 0:a.lastName)==="1")}else T(0),L(!1)}catch(e){console.error("Error fetching brand data:",e),t([]),T(0),L(!1)}},[C,$,k,et,Z]),eu=(0,r.useCallback)(async()=>{if(!$||(et||es)&&null==Z)return;let e=(0,s.GP)(new Date(new Date(C).getTime()-864e5),"yyyy-MM-dd");try{let t;et&&null!==Z?(t="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(Z,"&start=").concat(e,"&end=").concat(e),console.log("Manager Previous Day API call:",t)):en?(t="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),console.log("Admin Previous Day API call:",t)):es?(t="https://api.gajkesaristeels.in/brand/getByTeamAndDate?id=".concat(Z,"&start=").concat(e,"&end=").concat(e),console.log("Field Officer Previous Day API call:",t)):(t="https://api.gajkesaristeels.in/brand/getByDateRange?start=".concat(e,"&end=").concat(e),console.log("Default (Admin) Previous Day API call:",t));let a=await fetch(t,{headers:{Authorization:"Bearer ".concat($)}}),n=await a.json();D(n)}catch(e){console.error("Error fetching previous day data:",e),D([])}},[C,$,et,Z]),em=e.filter(e=>{var t;let a="all"===k||("gajkesari"===e.brandName.toLowerCase()?e.city===k:(null==(t=e.employeeDto)?void 0:t.city)===k),n="all"===U||!!e.employeeDto&&"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName)===U;return a&&n}),eh=Object.values(em.reduce((e,t)=>("gajkesari"===t.brandName.toLowerCase()?e.Gajkesari?(e.Gajkesari.count+=1,0===E&&(e.Gajkesari.ourPrice=t.price)):e.Gajkesari={brand:"Gajkesari",ourPrice:E>0?E:t.price,competitorPrice:0,count:1}:e[t.brandName]?(e[t.brandName].count+=1,e[t.brandName].competitorPrice=(e[t.brandName].competitorPrice*(e[t.brandName].count-1)+t.price)/e[t.brandName].count):e[t.brandName]={brand:t.brandName,ourPrice:0,competitorPrice:t.price,count:1},e),{})).map(e=>({brand:e.brand,ourPrice:e.ourPrice,competitorPrice:e.competitorPrice})).sort((e,t)=>"gajkesari"===e.brand.toLowerCase()?-1:"gajkesari"===t.brand.toLowerCase()?1:e.brand.localeCompare(t.brand));return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(o.Zp,{children:[(0,n.jsx)(o.aR,{children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(o.ZB,{children:"Pricing Report"}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(et||es)&&(0,n.jsx)("p",{children:J?"Loading team data...":V?"Error: ".concat(V," (Using fallback Team ID: ").concat(Z,")"):Z?"Team-based view (Team ID: ".concat(Z,")"):"No team data available"})})]}),B&&E>0&&(0,n.jsx)("div",{className:"text-right",children:(0,n.jsxs)("h2",{className:"text-2xl",children:["Gajkesari Rate: ",(0,n.jsxs)("span",{className:"font-bold",children:["₹",E,"/ton"]})]})})]})}),(0,n.jsx)(o.Wu,{children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d.J,{children:"City"}),(0,n.jsxs)(u.l6,{value:k,onValueChange:M,children:[(0,n.jsx)(u.bq,{children:(0,n.jsx)(u.yv,{placeholder:"Select city"})}),(0,n.jsxs)(u.gC,{children:[(0,n.jsx)(u.eb,{value:"all",children:"All Cities"}),O.map(e=>(0,n.jsx)(u.eb,{value:e,children:e},e))]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d.J,{children:"Date"}),(0,n.jsxs)(A.AM,{children:[(0,n.jsx)(A.Wv,{asChild:!0,children:(0,n.jsxs)(c.$,{variant:"outline",className:"w-full justify-start text-left font-normal ".concat(!C&&"text-muted-foreground"),children:[(0,n.jsx)(b.A,{className:"mr-2 h-4 w-4"}),C?(0,s.GP)(new Date(C),"PPP"):(0,n.jsx)("span",{children:"Pick a date"})]})}),(0,n.jsx)(A.hl,{className:"w-auto p-0",align:"start",children:(0,n.jsx)(P.R,{initialFocus:!0,mode:"single",defaultMonth:new Date(C),selected:new Date(C),onSelect:e=>{e&&I((0,s.GP)(e,"yyyy-MM-dd"))}})})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(d.J,{children:"Field Officer"}),(0,n.jsxs)(u.l6,{value:U,onValueChange:W,children:[(0,n.jsx)(u.bq,{children:(0,n.jsx)(u.yv,{placeholder:"Select field officer"})}),(0,n.jsxs)(u.gC,{children:[(0,n.jsx)(u.eb,{value:"all",children:"All Field Officers"}),_.map(e=>(0,n.jsx)(u.eb,{value:e,children:e},e))]})]})]})]})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)(o.Zp,{className:"lg:col-span-2",children:[(0,n.jsx)(o.aR,{children:(0,n.jsx)(o.ZB,{children:"Competitor Pricing"})}),(0,n.jsx)(o.Wu,{children:F?(0,n.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,n.jsx)(v.A,{className:"w-8 h-8 animate-spin text-primary"})}):(0,n.jsx)("div",{className:"rounded-md border overflow-hidden",children:(0,n.jsxs)(m.XI,{children:[(0,n.jsx)(m.A0,{children:(0,n.jsxs)(m.Hj,{children:[(0,n.jsx)(m.nd,{children:"Competitor"}),(0,n.jsx)(m.nd,{children:"Price (₹/ton)"}),(0,n.jsx)(m.nd,{children:"City"}),(0,n.jsx)(m.nd,{children:"Field Officer"})]})}),(0,n.jsx)(m.BF,{children:em.length>0?em.map(e=>(0,n.jsxs)(m.Hj,{children:[(0,n.jsx)(m.nA,{className:"font-medium",children:e.brandName}),(0,n.jsxs)(m.nA,{children:["₹",e.price.toFixed(2)]}),(0,n.jsx)(m.nA,{children:e.city}),(0,n.jsx)(m.nA,{children:"gajkesari"===e.brandName.toLowerCase()?e.city:e.employeeDto?"".concat(e.employeeDto.firstName," ").concat(e.employeeDto.lastName):"N/A"})]},e.id)):(0,n.jsx)(m.Hj,{children:(0,n.jsx)(m.nA,{colSpan:4,className:"h-24 text-center",children:"No pricing data found matching the selected filters"})})})]})})})]}),(0,n.jsxs)(o.Zp,{className:"lg:col-span-2",children:[(0,n.jsx)(o.aR,{children:(0,n.jsx)(o.ZB,{children:"Price Comparison by Brand"})}),(0,n.jsx)(o.Wu,{children:F?(0,n.jsx)("div",{className:"flex justify-center items-center h-80",children:(0,n.jsx)(v.A,{className:"w-8 h-8 animate-spin text-primary"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-80",children:(0,n.jsx)(h.u,{width:"100%",height:"100%",children:(0,n.jsxs)(p.E,{data:eh,margin:{top:20,right:30,left:20,bottom:60},children:[(0,n.jsx)(j.d,{strokeDasharray:"3 3"}),(0,n.jsx)(f.W,{dataKey:"brand",angle:-45,textAnchor:"end",height:60}),(0,n.jsx)(x.h,{}),(0,n.jsx)(y.m,{formatter:e=>["₹".concat(e),"Price"],labelFormatter:e=>"Brand: ".concat(e)}),(0,n.jsx)(g.s,{}),(0,n.jsx)(N.y,{dataKey:"ourPrice",name:"Our Price",fill:"#3b82f6"}),(0,n.jsx)(N.y,{dataKey:"competitorPrice",name:"Competitor Price",fill:"#10b981"})]})})}),(0,n.jsx)("div",{className:"mt-4 text-sm text-muted-foreground",children:(0,n.jsx)("p",{children:"Comparison of prices by brand between our products and competitors"})})]})})]})]})]})}},42348:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(71847).A)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},62004:(e,t,a)=>{Promise.resolve().then(a.bind(a,1788))},76842:(e,t,a)=>{"use strict";a.d(t,{C:()=>l});var n=a(12115),r=a(94446),s=a(4129),l=e=>{let{present:t,children:a}=e,l=function(e){var t,a;let[r,l]=n.useState(),c=n.useRef(null),o=n.useRef(e),d=n.useRef("none"),[u,m]=(t=e?"mounted":"unmounted",a={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},n.useReducer((e,t)=>{let n=a[e][t];return null!=n?n:e},t));return n.useEffect(()=>{let e=i(c.current);d.current="mounted"===u?e:"none"},[u]),(0,s.N)(()=>{let t=c.current,a=o.current;if(a!==e){let n=d.current,r=i(t);e?m("MOUNT"):"none"===r||(null==t?void 0:t.display)==="none"?m("UNMOUNT"):a&&n!==r?m("ANIMATION_OUT"):m("UNMOUNT"),o.current=e}},[e,m]),(0,s.N)(()=>{if(r){var e;let t,a=null!=(e=r.ownerDocument.defaultView)?e:window,n=e=>{let n=i(c.current).includes(CSS.escape(e.animationName));if(e.target===r&&n&&(m("ANIMATION_END"),!o.current)){let e=r.style.animationFillMode;r.style.animationFillMode="forwards",t=a.setTimeout(()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=e)})}},s=e=>{e.target===r&&(d.current=i(c.current))};return r.addEventListener("animationstart",s),r.addEventListener("animationcancel",n),r.addEventListener("animationend",n),()=>{a.clearTimeout(t),r.removeEventListener("animationstart",s),r.removeEventListener("animationcancel",n),r.removeEventListener("animationend",n)}}m("ANIMATION_END")},[r,m]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:n.useCallback(e=>{c.current=e?getComputedStyle(e):null,l(e)},[])}}(t),c="function"==typeof a?a({present:l.isPresent}):n.Children.only(a),o=(0,r.s)(l.ref,function(e){var t,a;let n=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=n&&"isReactWarning"in n&&n.isReactWarning;return r?e.ref:(r=(n=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get)&&"isReactWarning"in n&&n.isReactWarning)?e.props.ref:e.props.ref||e.ref}(c));return"function"==typeof a||l.isPresent?n.cloneElement(c,{ref:o}):null};function i(e){return(null==e?void 0:e.animationName)||"none"}l.displayName="Presence"},96633:(e,t,a)=>{"use strict";a.d(t,{A0:()=>l,BF:()=>i,Hj:()=>c,XI:()=>s,nA:()=>d,nd:()=>o,r6:()=>u});var n=a(95155);a(12115);var r=a(25016);function s(e){let{className:t,...a}=e;return(0,n.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,n.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,n.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,n.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...a})}function c(e){let{className:t,...a}=e;return(0,n.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function o(e){let{className:t,...a}=e;return(0,n.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,n.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function u(e){let{className:t,...a}=e;return(0,n.jsx)("caption",{"data-slot":"table-caption",className:(0,r.cn)("text-muted-foreground mt-4 text-sm",t),...a})}}},e=>{e.O(0,[9358,9,1052,7715,9140,9687,9480,8441,1255,7358],()=>e(e.s=62004)),_N_E=e.O()}]);