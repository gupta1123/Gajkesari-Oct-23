(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9682],{10489:(e,t,a)=>{"use strict";a.d(t,{b:()=>o});var s=a(12115),r=a(97602),n=a(95155),l=s.forwardRef((e,t)=>(0,n.jsx)(r.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var o=l},20063:(e,t,a)=>{"use strict";var s=a(47260);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},20508:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},25214:(e,t,a)=>{Promise.resolve().then(a.bind(a,98089))},26983:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},30814:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},39867:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},56069:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>p,A:()=>x});var s=a(95155),r=a(12115);let n="https://api.gajkesaristeels.in",l="".concat(n,"/user/token"),o="".concat(n,"/user/logout"),i="".concat(n,"/user/manage/get"),c="".concat(n,"/user/manage/current-user"),d={getToken:()=>localStorage.getItem("authToken"),setToken:e=>{{localStorage.setItem("authToken",e);let t="localhost"===window.location.hostname?"authToken=".concat(e,"; path=/; max-age=86400; samesite=strict"):"authToken=".concat(e,"; path=/; max-age=86400; secure; samesite=strict");document.cookie=t}},removeToken:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("currentUser"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getAuthHeader:()=>{let e=d.getToken();return e?"Bearer ".concat(e):null},setUserRole:e=>{localStorage.setItem("userRole",e.roles),localStorage.setItem("userData",JSON.stringify(e))},getUserRole:()=>localStorage.getItem("userRole"),getUserData:()=>{{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}},setCurrentUser:e=>{localStorage.setItem("currentUser",JSON.stringify(e))},getCurrentUser:()=>{{let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}}},u={login:async e=>{try{let t=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Login failed: ".concat(t.status," ").concat(e))}let[a,s]=(await t.text()).split(" ");if(!s)throw Error("Invalid response format from server");d.setToken(s);try{console.log("Fetching role for username:",e.username),console.log("Token being used:",s);let t=await fetch("".concat(i,"?username=").concat(e.username),{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();d.setUserRole(e),console.log("User role data stored:",e)}else{console.warn("Failed to fetch user role data:",t.status,t.statusText);let e=await t.text();console.warn("Error response:",e)}}catch(e){console.warn("Error fetching user role data:",e)}try{let e=await fetch(c,{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();d.setCurrentUser(t),console.log("Current user data stored:",t)}else console.warn("Failed to fetch current user data:",e.status)}catch(e){console.warn("Error fetching current user data:",e)}return{token:s,role:a||"USER"}}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{let e=d.getToken();if(!e)return void d.removeToken();let t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});d.removeToken(),t.ok||console.warn("Logout request failed, but token was cleared locally")}catch(e){console.error("Logout error:",e),d.removeToken()}},getStoredToken:()=>d.getToken(),getUserRole:()=>d.getUserRole(),getUserData:()=>d.getUserData(),getCurrentUser:()=>d.getCurrentUser()};var m=a(20063);let h=(0,r.createContext)(void 0);function p(e){let{children:t}=e,[a,n]=(0,r.useState)(!1),[l,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0),[d,p]=(0,r.useState)(null),[x,g]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),y=(0,r.useRef)(null),j=(0,m.useRouter)(),w=e=>{if(!e)return null;let t=e.split(".");if(t.length<2)return null;try{let e=t[1].replace(/-/g,"+").replace(/_/g,"/");if("function"!=typeof atob)return null;let a=atob(e),s=JSON.parse(a);if("number"==typeof s.exp)return s.exp;return null}catch(e){return null}};(0,r.useEffect)(()=>{let e=u.getStoredToken(),t=u.getUserRole(),a=u.getUserData(),s=u.getCurrentUser();if(e){let r=w(e),l=Math.floor(Date.now()/1e3);r&&r<=l?u.logout().finally(()=>{o(null),n(!1),p(null),g(null),v(null),j.replace("/login")}):(o(e),n(!0),p(t),g(a),v(s))}c(!1)},[]);let N=async(e,t)=>{c(!0);try{let a=await u.login({username:e,password:t});o(a.token),n(!0);let s=u.getUserRole(),r=u.getUserData(),l=u.getCurrentUser();p(s),g(r),v(l)}catch(e){throw e}finally{c(!1)}},b=async()=>{try{await u.logout(),o(null),n(!1),p(null),g(null),v(null),j.replace("/login")}catch(e){throw o(null),n(!1),p(null),g(null),e}};return(0,r.useEffect)(()=>{if(y.current&&(clearTimeout(y.current),y.current=null),!l)return;let e=w(l);if(!e)return;let t=1e3*e-Date.now();return t<=0?void b():(y.current=setTimeout(()=>{b()},t),()=>{y.current&&(clearTimeout(y.current),y.current=null)})},[l]),(0,s.jsx)(h.Provider,{value:{isAuthenticated:a,token:l,login:N,logout:b,isLoading:i,userRole:d,userData:x,currentUser:f},children:t})}function x(){let e=(0,r.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},60028:(e,t,a)=>{"use strict";a.d(t,{R:()=>x});var s=a(3648),r=a(95155),n=a(12115),l=a(90368),o=a(27937),i=a(24033),c=a(74854),d=a(51352),u=a(25016),m=a(97003);function h(){let e=(0,s._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return h=function(){return e},e}function p(){let e=(0,s._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return p=function(){return e},e}function x(e){let{className:t,classNames:a,showOutsideDays:s=!0,captionLayout:n="label",buttonVariant:x="ghost",formatters:f,components:v,...y}=e,j=(0,c.a)();return(0,r.jsx)(d.h,{showOutsideDays:s,className:(0,u.cn)("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(h()),String.raw(p()),t),captionLayout:n,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...f},classNames:{root:(0,u.cn)("w-fit",j.root),months:(0,u.cn)("flex gap-4 flex-col md:flex-row relative",j.months),month:(0,u.cn)("flex flex-col w-full gap-4",j.month),nav:(0,u.cn)("flex items-center gap-2 w-full absolute top-0 inset-x-0 justify-between",j.nav),button_previous:(0,u.cn)((0,m.r)({variant:x}),"size-7 aria-disabled:opacity-50 p-0 select-none",j.button_previous),button_next:(0,u.cn)((0,m.r)({variant:x}),"size-7 aria-disabled:opacity-50 p-0 select-none",j.button_next),month_caption:(0,u.cn)("flex items-center justify-center h-7 w-full px-7",j.month_caption),dropdowns:(0,u.cn)("w-full flex items-center text-sm font-medium justify-center h-7 gap-2",j.dropdowns),dropdown_root:(0,u.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",j.dropdown_root),dropdown:(0,u.cn)("absolute bg-popover inset-0 opacity-0",j.dropdown),caption_label:(0,u.cn)("select-none font-medium","label"===n?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",j.caption_label),table:"w-full border-collapse",weekdays:(0,u.cn)("flex",j.weekdays),weekday:(0,u.cn)("text-muted-foreground rounded-md flex-1 font-normal text-xs select-none py-1",j.weekday),week:(0,u.cn)("flex w-full mt-1",j.week),week_number_header:(0,u.cn)("select-none w-7",j.week_number_header),week_number:(0,u.cn)("text-sm select-none text-muted-foreground",j.week_number),day:(0,u.cn)("relative w-full h-full p-0.5 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",j.day),range_start:(0,u.cn)("rounded-l-md bg-accent",j.range_start),range_middle:(0,u.cn)("rounded-none",j.range_middle),range_end:(0,u.cn)("rounded-r-md bg-accent",j.range_end),today:(0,u.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",j.today),outside:(0,u.cn)("text-muted-foreground aria-selected:text-muted-foreground",j.outside),disabled:(0,u.cn)("text-muted-foreground opacity-50",j.disabled),hidden:(0,u.cn)("invisible",j.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...s}=e;return(0,r.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,u.cn)(t),...s})},Chevron:e=>{let{className:t,orientation:a,...s}=e;return"left"===a?(0,r.jsx)(l.A,{className:(0,u.cn)("size-4",t),...s}):"right"===a?(0,r.jsx)(o.A,{className:(0,u.cn)("size-4",t),...s}):(0,r.jsx)(i.A,{className:(0,u.cn)("size-4",t),...s})},DayButton:g,WeekNumber:e=>{let{children:t,...a}=e;return(0,r.jsx)("td",{...a,children:(0,r.jsx)("div",{className:"flex size-7 items-center justify-center text-center",children:t})})},...v},...y})}function g(e){let{className:t,day:a,modifiers:s,...l}=e,o=(0,c.a)(),i=n.useRef(null);return n.useEffect(()=>{var e;s.focused&&(null==(e=i.current)||e.focus())},[s.focused]),(0,r.jsx)(m.$,{ref:i,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":s.selected&&!s.range_start&&!s.range_end&&!s.range_middle,"data-range-start":s.range_start,"data-range-end":s.range_end,"data-range-middle":s.range_middle,className:(0,u.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-7 flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70 h-7 w-7 m-0.5",o.day,t),...l})}},65229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},68122:(e,t,a)=>{"use strict";a.d(t,{E:()=>n});var s=a(95155),r=a(25016);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...a})}},71871:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},74054:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]])},76842:(e,t,a)=>{"use strict";a.d(t,{C:()=>l});var s=a(12115),r=a(94446),n=a(4129),l=e=>{let{present:t,children:a}=e,l=function(e){var t,a;let[r,l]=s.useState(),i=s.useRef(null),c=s.useRef(e),d=s.useRef("none"),[u,m]=(t=e?"mounted":"unmounted",a={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},s.useReducer((e,t)=>{let s=a[e][t];return null!=s?s:e},t));return s.useEffect(()=>{let e=o(i.current);d.current="mounted"===u?e:"none"},[u]),(0,n.N)(()=>{let t=i.current,a=c.current;if(a!==e){let s=d.current,r=o(t);e?m("MOUNT"):"none"===r||(null==t?void 0:t.display)==="none"?m("UNMOUNT"):a&&s!==r?m("ANIMATION_OUT"):m("UNMOUNT"),c.current=e}},[e,m]),(0,n.N)(()=>{if(r){var e;let t,a=null!=(e=r.ownerDocument.defaultView)?e:window,s=e=>{let s=o(i.current).includes(CSS.escape(e.animationName));if(e.target===r&&s&&(m("ANIMATION_END"),!c.current)){let e=r.style.animationFillMode;r.style.animationFillMode="forwards",t=a.setTimeout(()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=e)})}},n=e=>{e.target===r&&(d.current=o(i.current))};return r.addEventListener("animationstart",n),r.addEventListener("animationcancel",s),r.addEventListener("animationend",s),()=>{a.clearTimeout(t),r.removeEventListener("animationstart",n),r.removeEventListener("animationcancel",s),r.removeEventListener("animationend",s)}}m("ANIMATION_END")},[r,m]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:s.useCallback(e=>{i.current=e?getComputedStyle(e):null,l(e)},[])}}(t),i="function"==typeof a?a({present:l.isPresent}):s.Children.only(a),c=(0,r.s)(l.ref,function(e){var t,a;let s=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?e.ref:(r=(s=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get)&&"isReactWarning"in s&&s.isReactWarning)?e.props.ref:e.props.ref||e.ref}(i));return"function"==typeof a||l.isPresent?s.cloneElement(i,{ref:c}):null};function o(e){return(null==e?void 0:e.animationName)||"none"}l.displayName="Presence"},90235:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var s=a(95155);a(12115);var r=a(10489),n=a(25016);function l(e){let{className:t,...a}=e;return(0,s.jsx)(r.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},98089:(e,t,a)=>{"use strict";a.d(t,{default:()=>P});var s=a(95155),r=a(12115),n=a(97003),l=a(33789),o=a(90235),i=a(47507),c=a(96633),d=a(83209),u=a(16485),m=a(35299),h=a(39867),p=a(71871),x=a(12108),g=a(24033),f=a(20508),v=a(30814),y=a(26983),j=a(90368),w=a(27937),N=a(71163),b=a(97450),S=a(60028),k=a(67812),A=a(68122),E=a(20063),T=a(37621),D=a(56069),I=a(25016),M=a(13626);let C="visits.table.state.v1";function P(){let{userRole:e,userData:t,currentUser:a}=(0,D.A)(),P=(0,E.useRouter)(),[U,_]=(0,r.useState)(null),[R,O]=(0,r.useTransition)(),L=(0,r.useRef)(!1),z=(0,r.useRef)(!1),[F,V]=(0,r.useState)(!1),J=new Date,B=new Date;B.setDate(J.getDate()-7);let[G,$]=(0,r.useState)(B),[W,H]=(0,r.useState)(J),[q,Z]=(0,r.useState)("all"),[X,K]=(0,r.useState)("all"),[Q,Y]=(0,r.useState)(""),[ee,et]=(0,r.useState)([]),[ea,es]=(0,r.useState)(!1),[er,en]=(0,r.useState)(null),[el,eo]=(0,r.useState)(0),[ei,ec]=(0,r.useState)(10),[ed,eu]=(0,r.useState)(0),[em,eh]=(0,r.useState)(0),[ep,ex]=(0,r.useState)(!1),[eg,ef]=(0,r.useState)([]),[ev,ey]=(0,r.useState)([]),[ej,ew]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{ew(!0);let t=await T.n.getAllEmployees();if(!e)return;ey(t)}catch(e){console.error("Failed to load employees list:",e)}finally{e&&ew(!1)}})(),()=>{e=!1}},[]);let[eN,eb]=(0,r.useState)(!1),[eS,ek]=(0,r.useState)([]),[eA,eE]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(z.current)return void V(!0);z.current=!0;try{let e=sessionStorage.getItem(C);if(e){let t=JSON.parse(e);if(t.startDate){let e=new Date(t.startDate);Number.isNaN(e.getTime())||$(e)}if(t.endDate){let e=new Date(t.endDate);Number.isNaN(e.getTime())||H(e)}t.selectedPurpose&&Z(t.selectedPurpose),t.selectedExecutive&&K(t.selectedExecutive),"string"==typeof t.customerName&&Y(t.customerName),"number"==typeof t.currentPage&&eo(t.currentPage),"number"==typeof t.pageSize&&t.pageSize>0&&ec(t.pageSize),Array.isArray(t.expandedCards)&&ef(t.expandedCards)}}catch(e){console.error("Failed to restore visit table state:",e)}finally{V(!0)}},[]),(0,r.useEffect)(()=>{if(!F)return;let e={startDate:G?G.toISOString():void 0,endDate:W?W.toISOString():void 0,selectedPurpose:q,selectedExecutive:X,customerName:Q,currentPage:el,pageSize:ei,expandedCards:eg};try{sessionStorage.setItem(C,JSON.stringify(e))}catch(e){console.error("Failed to persist visit table state:",e)}},[F,G,W,q,X,Q,el,ei,eg]);let eT=(0,r.useMemo)(()=>{let e=new Set;return ee.forEach(t=>{t.purpose&&e.add(t.purpose)}),Array.from(e)},[ee]),eD=(0,r.useMemo)(()=>{let e=ev.map(e=>{var t,a;let s=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),r=null!=(a=null==(t=e.userDto)?void 0:t.employeeId)?a:null,n=s||e.userName||e.email||"Employee ".concat(null!=r?r:e.id),l=null!==r?"".concat(n," (").concat(r,")"):n;return{value:String(e.id),label:l}});return e.sort((e,t)=>e.label.localeCompare(t.label)),[{value:"all",label:"All Executives"},...e]},[ev]);(0,r.useEffect)(()=>{if("all"===X||0===ev.length||eD.some(e=>e.value===X))return;let e=ev.find(e=>{let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=t||e.userName||e.email||"Employee ".concat(e.id);return t===X||a===X});e?K(String(e.id)):K("all")},[X,eD,ev]);let eI=e=>{null!==U||R||(_(e),O(()=>{P.push("/dashboard/visits/".concat(e))}))};(0,r.useEffect)(()=>{R||null===U||_(null)},[R,U]),(0,r.useEffect)(()=>{var t;let s="MANAGER"===e||(null==a||null==(t=a.authorities)?void 0:t.some(e=>"ROLE_MANAGER"===e.authority));console.log("Role detection - userRole:",e),console.log("Role detection - currentUser authorities:",null==a?void 0:a.authorities),console.log("Role detection - isManagerRole:",s),eb(!!s)},[e,a]),(0,r.useEffect)(()=>{let e=async()=>{if(eN&&(null==t?void 0:t.employeeId)){if(0===ev.length)return void console.log("Employee list not available yet, waiting before computing team members");try{console.log("Loading team members for manager employee ID:",t.employeeId);let e=await T.n.getTeamByEmployee(t.employeeId);if(console.log("Team data received:",e),console.log("Team data structure:",JSON.stringify(e,null,2)),e&&e.length>0){let t=e[0];eE(t.id),console.log("Team ID set to:",t.id);let a=e.flatMap(e=>e.fieldOfficers.map(e=>e.id));console.log("Team member IDs from team data:",a),console.log("All employees count:",ev.length),console.log("Sample employees:",ev.slice(0,5).map(e=>({id:e.id,name:"".concat(e.firstName," ").concat(e.lastName)})));let s=ev.filter(e=>a.includes(e.id));console.log("Filtered team members:",s),ek(s)}else console.log("No team data found for manager"),eE(null),ek([])}catch(e){console.error("Failed to load team members:",e),console.error("Error details:",e.message,e.stack),en("Failed to load team members"),eE(null),ek([])}}};eN&&(null==t?void 0:t.employeeId)&&e()},[eN,null==t?void 0:t.employeeId,ev]),(0,r.useEffect)(()=>{if(!F||!G||!W)return;if(eN&&!eA)return void console.log("⏳ Manager detected but no teamId yet - waiting for team data");let s=(0,N.GP)(G,"yyyy-MM-dd"),r=(0,N.GP)(W,"yyyy-MM-dd");(async()=>{es(!0),en(null);try{var n;let l,o=""!==Q.trim()?Q:void 0,i="All Purposes"!==q?q:void 0;console.log("Making API call with filters:",{startDate:s,endDate:r,page:el,size:ei,sort:"visitDate,desc",storeName:o,purpose:i,isManager:eN,teamId:eA,teamMemberCount:eS.length,userRole:e,currentUserAuthorities:null==a?void 0:a.authorities}),console.log("\uD83D\uDD0D API Selection Debug:",{isManager:eN,teamId:eA,userRole:e,currentUserAuthorities:null==a?void 0:a.authorities,userDataEmployeeId:null==t?void 0:t.employeeId,teamMembersCount:eS.length}),eN&&eA?(console.log("\uD83D\uDD35 MANAGER DETECTED - Using team-specific API"),console.log("Team ID:",eA),console.log("API Endpoint: /visit/getForTeam"),l=await T.n.getVisitsForTeam(eA,s,r,el,ei,"visitDate,desc",i,void 0,o)):(console.log("\uD83D\uDFE2 ADMIN DETECTED - Using regular API"),console.log("Reason:",eN?"No teamId":"Not a manager"),console.log("API Endpoint: /visit/getByDateSorted"),l=await T.n.getVisitsByDateSorted(s,r,el,ei,"visitDate,desc",o)),console.log("API Response:",l),console.log("Total elements:",l.totalElements),console.log("Content length:",null==(n=l.content)?void 0:n.length);let c=(l.content||[]).map(e=>{var t,a,s,r,n,l,o,i,c,d,u;return{id:e.id,customerName:e.storeName,executive:e.employeeName,employeeId:e.employeeId,date:e.visit_date,status:e.checkinTime?"Completed":"Scheduled",purpose:null!=(t=e.purpose)?t:void 0,visitStart:null!=(a=e.checkinTime)?a:void 0,visitEnd:null!=(s=e.checkoutTime)?s:void 0,intent:null!=(r=e.intent)?r:void 0,lastUpdated:e.updatedAt?"".concat(e.updatedAt," ").concat(e.updatedTime||""):void 0,priority:null!=(n=e.priority)?n:void 0,outcome:null!=(l=e.outcome)?l:void 0,feedback:null!=(o=e.feedback)?o:void 0,city:null!=(i=e.city)?i:void 0,state:null!=(c=e.state)?c:void 0,checkinTime:null!=(d=e.checkinTime)?d:void 0,checkoutTime:null!=(u=e.checkoutTime)?u:void 0}});et(c);let d=l.totalPages&&l.totalPages>0?l.totalPages:1;if(eu(d),eh(l.totalElements||0),el>=d){let e=Math.max(d-1,0);e!==el&&eo(e)}}catch(e){en((null==e?void 0:e.message)||"Failed to load visits")}finally{es(!1)}})()},[F,G,W,q,Q,el,ei,eN,eA]),(0,r.useEffect)(()=>{if(F){if(!L.current){L.current=!0;return}eo(0)}},[F,G,W,q,X,Q]);let eM=ee.filter(e=>{var t;return("all"===q||e.purpose===q)&&("all"===X||String(null!=(t=e.employeeId)?t:"")===X)}),eC=e=>{if(null==e)return"";let t=String(e);return t.includes('"')&&(t=t.replace(/"/g,'""')),/[",\n]/.test(t)&&(t='"'.concat(t,'"')),t},eP=async()=>{try{if(ex(!0),!G||!W)return;let e=(0,N.GP)(G,"yyyy-MM-dd"),t=(0,N.GP)(W,"yyyy-MM-dd"),a=0,s=[],r=""!==Q.trim()?Q:void 0,n=await T.n.getVisitsByDateSorted(e,t,a,200,"visitDate,desc",r);s=s.concat(n.content||[]);let l=n.totalPages||1;for(a=1;a<l;a++){let n=await T.n.getVisitsByDateSorted(e,t,a,200,"visitDate,desc",r);s=s.concat(n.content||[])}if(eN&&eS.length>0){let e=eS.map(e=>e.id);s=s.filter(t=>e.includes(t.employeeId))}let o=s.map(e=>{var t,a,s,r,n,l,o,i,c,d,u;return{id:e.id,customerName:e.storeName,executive:e.employeeName,employeeId:e.employeeId,date:e.visit_date,status:e.checkinTime?"Completed":"Scheduled",purpose:null!=(t=e.purpose)?t:void 0,visitStart:null!=(a=e.checkinTime)?a:void 0,visitEnd:null!=(s=e.checkoutTime)?s:void 0,intent:null!=(r=e.intent)?r:void 0,lastUpdated:e.updatedAt?"".concat(e.updatedAt," ").concat(e.updatedTime||""):void 0,priority:null!=(n=e.priority)?n:void 0,outcome:null!=(l=e.outcome)?l:void 0,feedback:null!=(o=e.feedback)?o:void 0,city:null!=(i=e.city)?i:void 0,state:null!=(c=e.state)?c:void 0,checkinTime:null!=(d=e.checkinTime)?d:void 0,checkoutTime:null!=(u=e.checkoutTime)?u:void 0}}).filter(e=>{var t;return("all"===q||e.purpose===q)&&("all"===X||String(null!=(t=e.employeeId)?t:"")===X)});(e=>{let t=[["Customer Name","Executive","Date","Status","Purpose","Visit Start","Visit End","Intent","Last Updated","City","State"].map(eC).join(",")];for(let c of e){var a,s,r,n,l,o,i;let e=c.checkinTime?"Completed":"Scheduled",d=null!=(a=c.lastUpdated)?a:"",u=[c.customerName,c.executive,c.date,e,null!=(s=c.purpose)?s:"",null!=(r=c.visitStart)?r:"",null!=(n=c.visitEnd)?n:"",null!=(l=c.intent)?l:"",d,null!=(o=c.city)?o:"",null!=(i=c.state)?i:""].map(eC).join(",");t.push(u)}let c=new Blob([t.join("\n")],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),u=document.createElement("a");u.href=d,u.download="visits.csv",u.click(),URL.revokeObjectURL(d)})(o)}catch(e){console.error("Export failed",e),alert("Failed to export CSV")}finally{ex(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.Zp,{className:"w-full",children:[(0,s.jsx)(d.aR,{children:(0,s.jsx)("div",{className:"flex items-center justify-end",children:e&&(0,s.jsx)(k.E,{variant:eN?"secondary":"default",className:"text-xs",children:eN?"Manager View":"Admin View"})})}),(0,s.jsxs)(d.Wu,{className:"w-full",children:[er&&(0,s.jsx)("div",{className:"mb-4 text-sm text-red-700 bg-red-50 border border-red-200 rounded p-3",children:er}),G&&W?ea?(0,s.jsx)("div",{className:"mb-4 text-sm text-yellow-700 bg-yellow-50 border border-yellow-200 rounded p-3",children:"Loading visits data..."}):eN&&!eA?(0,s.jsx)("div",{className:"mb-4 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded p-3",children:"\uD83D\uDD35 Manager detected - Loading team data..."}):null:(0,s.jsx)("div",{className:"mb-4 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded p-3",children:"Please select both start and end dates to load visits data."}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"Start Date"}),(0,s.jsxs)(b.AM,{children:[(0,s.jsx)(b.Wv,{asChild:!0,children:(0,s.jsxs)(n.$,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),G?(0,N.GP)(G,"LLL dd, y"):(0,s.jsx)("span",{children:"Select start date"})]})}),(0,s.jsx)(b.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(S.R,{initialFocus:!0,mode:"single",defaultMonth:G,selected:G,onSelect:$})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"End Date"}),(0,s.jsxs)(b.AM,{children:[(0,s.jsx)(b.Wv,{asChild:!0,children:(0,s.jsxs)(n.$,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),W?(0,N.GP)(W,"LLL dd, y"):(0,s.jsx)("span",{children:"Select end date"})]})}),(0,s.jsx)(b.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(S.R,{initialFocus:!0,mode:"single",defaultMonth:W,selected:W,onSelect:H})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"Purpose"}),(0,s.jsxs)(i.l6,{value:q,onValueChange:Z,children:[(0,s.jsx)(i.bq,{children:(0,s.jsx)(i.yv,{placeholder:"Select purpose"})}),(0,s.jsxs)(i.gC,{children:[(0,s.jsx)(i.eb,{value:"all",children:"All Purposes"}),eT.map(e=>(0,s.jsx)(i.eb,{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"Customer Name"}),(0,s.jsx)(l.p,{placeholder:"Search customer",value:Q,onChange:e=>Y(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"Executive"}),(0,s.jsx)(M.Z,{options:eD,value:X,onSelect:e=>{e&&"all"!==e.value?K(e.value):K("all")},placeholder:"Select executive",loading:ej,triggerClassName:"w-full justify-between h-11",contentClassName:"w-[var(--radix-popover-trigger-width)]",searchPlaceholder:"Search executives..."})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)(n.$,{onClick:eP,className:"w-full",disabled:ep,children:ep?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Exporting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Export CSV"]})})})]}),(0,s.jsx)("div",{className:"hidden md:block rounded-md border overflow-hidden w-full",children:(0,s.jsx)("div",{className:"overflow-x-auto w-full",children:(0,s.jsxs)(c.XI,{className:"min-w-full",children:[(0,s.jsx)(c.A0,{children:(0,s.jsxs)(c.Hj,{children:[(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Customer Name"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Executive"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Date"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Status"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Purpose"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Visit Start"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Visit End"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Intent"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Last Updated"}),(0,s.jsx)(c.nd,{className:"whitespace-nowrap",children:"Actions"})]})}),(0,s.jsx)(c.BF,{children:G&&W?ea?(0,s.jsx)(c.Hj,{children:(0,s.jsx)(c.nA,{colSpan:10,className:"h-24 text-center",children:"Loading visits…"})}):eM.length>0?eM.map(e=>{var t,a;return(0,s.jsxs)(c.Hj,{children:[(0,s.jsx)(c.nA,{className:"font-medium whitespace-nowrap",children:e.customerName}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:e.executive}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:(0,I.V5)(e.date)}),(0,s.jsx)(c.nA,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs whitespace-nowrap ".concat("Completed"===e.status?"bg-green-100 text-green-800":"Scheduled"===e.status?"bg-blue-100 text-blue-800":"In Progress"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:null!=(t=e.status)?t:"—"})}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:null!=(a=e.purpose)?a:"—"}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:e.visitStart?(0,I.$)(e.visitStart):"—"}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:e.visitEnd?(0,I.$)(e.visitEnd):"—"}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:e.intent}),(0,s.jsx)(c.nA,{className:"whitespace-nowrap",children:e.lastUpdated?(0,I.hI)(e.lastUpdated):"—"}),(0,s.jsx)(c.nA,{children:(0,s.jsx)(n.$,{variant:"outline",size:"sm",onClick:()=>eI(e.id),disabled:null!==U,children:U===e.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Opening…"]}):"View Details"})})]},e.id)}):(0,s.jsx)(c.Hj,{children:(0,s.jsx)(c.nA,{colSpan:10,className:"h-24 text-center",children:"No visits found matching the selected filters"})}):(0,s.jsx)(c.Hj,{children:(0,s.jsx)(c.nA,{colSpan:10,className:"h-24 text-center text-gray-500",children:"Select both start and end dates to view visits"})})})]})})}),(0,s.jsx)("div",{className:"md:hidden space-y-4",children:G&&W?ea?(0,s.jsxs)("div",{className:"text-center py-10",children:[(0,s.jsx)(m.A,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-lg",children:"Loading visits…"})]}):eM.length>0?eM.map(e=>{var t;return(0,s.jsxs)(d.Zp,{className:"overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300",children:[(0,s.jsx)(d.aR,{className:"pb-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"h-12 w-12 bg-primary rounded-full flex items-center justify-center",children:(0,s.jsx)(p.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.ZB,{className:"text-lg font-bold",children:e.customerName}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,I.V5)(e.date)})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-semibold ".concat("Completed"===e.status?"bg-green-100 text-green-800":"Scheduled"===e.status?"bg-blue-100 text-blue-800":"In Progress"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:null!=(t=e.status)?t:"—"}),(0,s.jsx)(n.$,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void ef(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},children:eg.includes(e.id)?(0,s.jsx)(x.A,{className:"h-4 w-4"}):(0,s.jsx)(g.A,{className:"h-4 w-4"})})]})]})}),(0,s.jsxs)(d.Wu,{className:"pt-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(f.A,{className:"text-blue-500 h-4 w-4"}),(0,s.jsx)("span",{className:"text-base font-medium",children:"Executive:"}),(0,s.jsx)("span",{className:"text-base",children:e.executive})]})}),eg.includes(e.id)&&(0,s.jsxs)("div",{className:"mt-4 space-y-3 text-base",children:[e.purpose&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(v.A,{className:"text-purple-500 h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Purpose:"}),(0,s.jsx)("span",{children:e.purpose})]}),e.visitStart&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(y.A,{className:"text-green-500 h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Visit Start:"}),(0,s.jsx)("span",{children:(0,I.$)(e.visitStart)})]}),e.visitEnd&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(y.A,{className:"text-red-500 h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Visit End:"}),(0,s.jsx)("span",{children:(0,I.$)(e.visitEnd)})]}),e.intent&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(v.A,{className:"text-orange-500 h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Intent:"}),(0,s.jsx)("span",{children:e.intent})]}),e.lastUpdated&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(u.A,{className:"text-indigo-500 h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Last Updated:"}),(0,s.jsx)("span",{children:(0,I.hI)(e.lastUpdated)})]})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)(n.$,{variant:"outline",size:"sm",className:"text-base px-4 py-2",onClick:()=>eI(e.id),disabled:null!==U,children:U===e.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Opening…"]}):"View Details"})})]})]},e.id)}):(0,s.jsx)("div",{className:"text-center py-10",children:(0,s.jsx)("p",{className:"text-lg",children:"No visits found matching the selected filters"})}):(0,s.jsx)("div",{className:"text-center py-10",children:(0,s.jsx)("p",{className:"text-lg text-gray-500",children:"Select both start and end dates to view visits"})})}),G&&W&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.J,{htmlFor:"pageSize",children:"Rows per page:"}),(0,s.jsxs)(i.l6,{value:ei.toString(),onValueChange:e=>ec(parseInt(e)),children:[(0,s.jsx)(i.bq,{className:"w-20",children:(0,s.jsx)(i.yv,{})}),(0,s.jsxs)(i.gC,{children:[(0,s.jsx)(i.eb,{value:"10",children:"10"}),(0,s.jsx)(i.eb,{value:"25",children:"25"}),(0,s.jsx)(i.eb,{value:"50",children:"50"}),(0,s.jsx)(i.eb,{value:"100",children:"100"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>eo(Math.max(0,el-1)),disabled:0===el,children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),"Previous"]}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",el+1," of ",ed]}),(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>eo(Math.min(ed-1,el+1)),disabled:el>=ed-1,children:["Next",(0,s.jsx)(w.A,{className:"h-4 w-4"})]})]})]})]})]}),null!==U&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur",children:(0,s.jsxs)("div",{className:"w-full max-w-3xl space-y-6 rounded-2xl border border-border/40 bg-card/95 p-8 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(A.E,{className:"h-4 w-36"}),(0,s.jsx)(A.E,{className:"h-8 w-64"})]}),(0,s.jsx)(m.A,{className:"h-10 w-10 animate-spin text-primary"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)(A.E,{className:"h-20 w-full rounded-xl"},t))}),(0,s.jsx)(A.E,{className:"h-32 w-full rounded-xl"}),(0,s.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Preparing visit details…"})]})})]})}}},e=>{e.O(0,[9358,9,1052,4627,2632,9687,5941,8441,1255,7358],()=>e(e.s=25214)),_N_E=e.O()}]);