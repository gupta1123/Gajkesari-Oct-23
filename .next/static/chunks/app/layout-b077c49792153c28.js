(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{1188:(e,t,r)=>{Promise.resolve().then(r.bind(r,82466)),Promise.resolve().then(r.bind(r,81901)),Promise.resolve().then(r.t.bind(r,54587,23)),Promise.resolve().then(r.t.bind(r,24705,23)),Promise.resolve().then(r.t.bind(r,41290,23)),Promise.resolve().then(r.t.bind(r,22043,23))},20063:(e,t,r)=>{"use strict";var o=r(47260);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},22043:()=>{},24705:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},41290:()=>{},54587:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},68209:(e,t,r)=>{"use strict";r.d(t,{N4:()=>c,Xb:()=>u,co:()=>i,y1:()=>h});let o="https://api.gajkesaristeels.in",a="".concat(o,"/user/token"),n="".concat(o,"/user/logout"),l="".concat(o,"/user/manage/get"),s="".concat(o,"/user/manage/current-user"),u=e=>e?e.trim().replace(/\s+/g," ").toUpperCase():null,c=e=>{let t=u(e);return"MANAGER"===t||"ROLE MANAGER"===t||"ROLE_MANAGER"===t||"OFFICE MANAGER"===t||"OFFICE_MANAGER"===t||"ROLE OFFICE MANAGER"===t||"ROLE_OFFICE MANAGER"===t||"ROLE_OFFICE_MANAGER"===t},i=(e,t)=>{var r;return!!c(e)||(null!=(r=null==t?void 0:t.authorities)?r:[]).some(e=>c(e.authority))},m={getToken:()=>localStorage.getItem("authToken"),setToken:e=>{{localStorage.setItem("authToken",e);let t="localhost"===window.location.hostname?"authToken=".concat(e,"; path=/; max-age=86400; samesite=strict"):"authToken=".concat(e,"; path=/; max-age=86400; secure; samesite=strict");document.cookie=t}},removeToken:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("currentUser"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getAuthHeader:()=>{let e=m.getToken();return e?"Bearer ".concat(e):null},setUserRole:e=>{localStorage.setItem("userRole",e.roles),localStorage.setItem("userData",JSON.stringify(e))},getUserRole:()=>localStorage.getItem("userRole"),getUserData:()=>{{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}},setCurrentUser:e=>{localStorage.setItem("currentUser",JSON.stringify(e))},getCurrentUser:()=>{{let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}}},h={login:async e=>{try{let t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Login failed: ".concat(t.status," ").concat(e))}let r=await t.text(),{role:o,token:n}=(e=>{let t=e.trim();if(!t)throw Error("Empty response received from login endpoint");try{let e=JSON.parse(t);if("string"==typeof e.token){var r;return{token:e.token.trim(),role:null!=(r=e.role)?r:"USER"}}}catch(e){}let o=t.split(/\s+/);if(o.length<2)throw Error('Unexpected login response: "'.concat(t,'"'));let a=o[0],n=o[o.length-1];if("bearer"===n.toLowerCase()&&o.length>=3&&(n=o[o.length-1]),!(n=n.replace(/^"(.*)"$/,"$1")).includes("."))throw Error('Parsed token looks invalid: "'.concat(n,'"'));return{token:n,role:a||"USER"}})(r);m.setToken(n);try{console.log("Fetching role for username:",e.username),console.log("Raw token response:",r),console.log("Token being used:",n);let t=await fetch("".concat(l,"?username=").concat(e.username),{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();m.setUserRole(e),console.log("User role data stored:",e)}else{console.warn("Failed to fetch user role data:",t.status,t.statusText);let e=await t.text();console.warn("Error response:",e)}}catch(e){console.warn("Error fetching user role data:",e)}try{let e=await fetch(s,{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();m.setCurrentUser(t),console.log("Current user data stored:",t)}else console.warn("Failed to fetch current user data:",e.status)}catch(e){console.warn("Error fetching current user data:",e)}return{token:n,role:o||"USER"}}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{let e=m.getToken();if(!e)return void m.removeToken();let t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});m.removeToken(),t.ok||console.warn("Logout request failed, but token was cleared locally")}catch(e){console.error("Logout error:",e),m.removeToken()}},isAuthenticated:()=>!!m.getToken(),getStoredToken:()=>m.getToken(),getUserRole:()=>m.getUserRole(),getUserData:()=>m.getUserData(),getCurrentUser:()=>m.getCurrentUser()}},81901:(e,t,r)=>{"use strict";r.d(t,{D:()=>s,ThemeProvider:()=>l});var o=r(95155),a=r(12115);let n=(0,a.createContext)({theme:"system",setTheme:()=>null});function l(e){let{children:t,defaultTheme:r="system",storageKey:l="ui-theme",...s}=e,[u,c]=(0,a.useState)(localStorage.getItem(l)||r);return(0,a.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove("light","dark"),"system"===u){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.classList.add(t);return}e.classList.add(u)},[u]),(0,o.jsx)(n.Provider,{...s,value:{theme:u,setTheme:e=>{localStorage.setItem(l,e),c(e)}},children:t})}let s=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},82466:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>u});var o=r(95155),a=r(12115),n=r(68209),l=r(20063);let s=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(!1),[c,i]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),[g,d]=(0,a.useState)(null),[f,p]=(0,a.useState)(null),[y,k]=(0,a.useState)(null),v=(0,a.useRef)(null),E=(0,l.useRouter)(),S=e=>{if(!e)return null;let t=e.split(".");if(t.length<2)return null;try{let e=t[1].replace(/-/g,"+").replace(/_/g,"/");if("function"!=typeof atob)return null;let r=atob(e),o=JSON.parse(r);if("number"==typeof o.exp)return o.exp;return null}catch(e){return null}};(0,a.useEffect)(()=>{let e=n.y1.getStoredToken(),t=n.y1.getUserRole(),r=n.y1.getUserData(),o=n.y1.getCurrentUser();if(e){let a=S(e),l=Math.floor(Date.now()/1e3);a&&a<=l?n.y1.logout().finally(()=>{i(null),u(!1),d(null),p(null),k(null),E.replace("/login")}):(i(e),u(!0),d(t),p(r),k(o))}h(!1)},[]);let w=async(e,t)=>{h(!0);try{let r=await n.y1.login({username:e,password:t});i(r.token),u(!0);let o=n.y1.getUserRole(),a=n.y1.getUserData(),l=n.y1.getCurrentUser();d(o),p(a),k(l)}catch(e){throw e}finally{h(!1)}},T=async()=>{try{await n.y1.logout(),i(null),u(!1),d(null),p(null),k(null),sessionStorage.removeItem("pricingModalDismissed"),E.replace("/login")}catch(e){throw i(null),u(!1),d(null),p(null),sessionStorage.removeItem("pricingModalDismissed"),e}};return(0,a.useEffect)(()=>{if(v.current&&(clearTimeout(v.current),v.current=null),!c)return;let e=S(c);if(!e)return;let t=1e3*e-Date.now();return t<=0?void T():(v.current=setTimeout(()=>{T()},t),()=>{v.current&&(clearTimeout(v.current),v.current=null)})},[c]),(0,o.jsx)(s.Provider,{value:{isAuthenticated:r,token:c,login:w,logout:T,isLoading:m,userRole:g,userData:f,currentUser:y},children:t})}function c(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[834,8441,1255,7358],()=>e(e.s=1188)),_N_E=e.O()}]);