(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{1188:(e,t,r)=>{Promise.resolve().then(r.bind(r,56069)),Promise.resolve().then(r.bind(r,81901)),Promise.resolve().then(r.t.bind(r,54587,23)),Promise.resolve().then(r.t.bind(r,24705,23)),Promise.resolve().then(r.t.bind(r,41290,23)),Promise.resolve().then(r.t.bind(r,22043,23))},20063:(e,t,r)=>{"use strict";var o=r(47260);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},22043:()=>{},24705:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},41290:()=>{},54587:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}},56069:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>d,A:()=>f});var o=r(95155),a=r(12115);let n="https://api.gajkesaristeels.in",l="".concat(n,"/user/token"),s="".concat(n,"/user/logout"),u="".concat(n,"/user/manage/get"),c="".concat(n,"/user/manage/current-user"),i={getToken:()=>localStorage.getItem("authToken"),setToken:e=>{{localStorage.setItem("authToken",e);let t="localhost"===window.location.hostname?"authToken=".concat(e,"; path=/; max-age=86400; samesite=strict"):"authToken=".concat(e,"; path=/; max-age=86400; secure; samesite=strict");document.cookie=t}},removeToken:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),localStorage.removeItem("currentUser"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getAuthHeader:()=>{let e=i.getToken();return e?"Bearer ".concat(e):null},setUserRole:e=>{localStorage.setItem("userRole",e.roles),localStorage.setItem("userData",JSON.stringify(e))},getUserRole:()=>localStorage.getItem("userRole"),getUserData:()=>{{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}},setCurrentUser:e=>{localStorage.setItem("currentUser",JSON.stringify(e))},getCurrentUser:()=>{{let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}}},m={login:async e=>{try{let t=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("Login failed: ".concat(t.status," ").concat(e))}let[r,o]=(await t.text()).split(" ");if(!o)throw Error("Invalid response format from server");i.setToken(o);try{console.log("Fetching role for username:",e.username),console.log("Token being used:",o);let t=await fetch("".concat(u,"?username=").concat(e.username),{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();i.setUserRole(e),console.log("User role data stored:",e)}else{console.warn("Failed to fetch user role data:",t.status,t.statusText);let e=await t.text();console.warn("Error response:",e)}}catch(e){console.warn("Error fetching user role data:",e)}try{let e=await fetch(c,{credentials:"include",method:"GET",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();i.setCurrentUser(t),console.log("Current user data stored:",t)}else console.warn("Failed to fetch current user data:",e.status)}catch(e){console.warn("Error fetching current user data:",e)}return{token:o,role:r||"USER"}}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{let e=i.getToken();if(!e)return void i.removeToken();let t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});i.removeToken(),t.ok||console.warn("Logout request failed, but token was cleared locally")}catch(e){console.error("Logout error:",e),i.removeToken()}},getStoredToken:()=>i.getToken(),getUserRole:()=>i.getUserRole(),getUserData:()=>i.getUserData(),getCurrentUser:()=>i.getCurrentUser()};var h=r(20063);let g=(0,a.createContext)(void 0);function d(e){let{children:t}=e,[r,n]=(0,a.useState)(!1),[l,s]=(0,a.useState)(null),[u,c]=(0,a.useState)(!0),[i,d]=(0,a.useState)(null),[f,p]=(0,a.useState)(null),[k,v]=(0,a.useState)(null),T=(0,a.useRef)(null),w=(0,h.useRouter)(),S=e=>{if(!e)return null;let t=e.split(".");if(t.length<2)return null;try{let e=t[1].replace(/-/g,"+").replace(/_/g,"/");if("function"!=typeof atob)return null;let r=atob(e),o=JSON.parse(r);if("number"==typeof o.exp)return o.exp;return null}catch(e){return null}};(0,a.useEffect)(()=>{let e=m.getStoredToken(),t=m.getUserRole(),r=m.getUserData(),o=m.getCurrentUser();if(e){let a=S(e),l=Math.floor(Date.now()/1e3);a&&a<=l?m.logout().finally(()=>{s(null),n(!1),d(null),p(null),v(null),w.replace("/login")}):(s(e),n(!0),d(t),p(r),v(o))}c(!1)},[]);let y=async(e,t)=>{c(!0);try{let r=await m.login({username:e,password:t});s(r.token),n(!0);let o=m.getUserRole(),a=m.getUserData(),l=m.getCurrentUser();d(o),p(a),v(l)}catch(e){throw e}finally{c(!1)}},U=async()=>{try{await m.logout(),s(null),n(!1),d(null),p(null),v(null),w.replace("/login")}catch(e){throw s(null),n(!1),d(null),p(null),e}};return(0,a.useEffect)(()=>{if(T.current&&(clearTimeout(T.current),T.current=null),!l)return;let e=S(l);if(!e)return;let t=1e3*e-Date.now();return t<=0?void U():(T.current=setTimeout(()=>{U()},t),()=>{T.current&&(clearTimeout(T.current),T.current=null)})},[l]),(0,o.jsx)(g.Provider,{value:{isAuthenticated:r,token:l,login:y,logout:U,isLoading:u,userRole:i,userData:f,currentUser:k},children:t})}function f(){let e=(0,a.useContext)(g);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},81901:(e,t,r)=>{"use strict";r.d(t,{D:()=>s,ThemeProvider:()=>l});var o=r(95155),a=r(12115);let n=(0,a.createContext)({theme:"system",setTheme:()=>null});function l(e){let{children:t,defaultTheme:r="system",storageKey:l="ui-theme",...s}=e,[u,c]=(0,a.useState)(localStorage.getItem(l)||r);return(0,a.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove("light","dark"),"system"===u){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.classList.add(t);return}e.classList.add(u)},[u]),(0,o.jsx)(n.Provider,{...s,value:{theme:u,setTheme:e=>{localStorage.setItem(l,e),c(e)}},children:t})}let s=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}}},e=>{e.O(0,[834,8441,1255,7358],()=>e(e.s=1188)),_N_E=e.O()}]);